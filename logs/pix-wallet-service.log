2025-10-15 19:20:14,112 [pool-10-thread-8] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: null
2025-10-15 19:20:14,112 [pool-10-thread-3] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: null
2025-10-15 19:20:14,112 [pool-10-thread-6] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: null
2025-10-15 19:20:14,112 [pool-10-thread-2] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: null
2025-10-15 19:20:14,113 [pool-10-thread-3] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - HikariPool-1 - Connection is not available, request timed out after 30000ms.
2025-10-15 19:20:14,113 [pool-10-thread-2] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - HikariPool-1 - Connection is not available, request timed out after 30000ms.
2025-10-15 19:20:14,112 [pool-10-thread-7] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: null
2025-10-15 19:20:14,112 [pool-10-thread-4] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: null
2025-10-15 19:20:14,112 [pool-10-thread-10] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: null
2025-10-15 19:20:14,113 [pool-10-thread-4] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - HikariPool-1 - Connection is not available, request timed out after 30000ms.
2025-10-15 19:20:14,112 [pool-10-thread-1] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: null
2025-10-15 19:20:14,113 [pool-10-thread-2] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"CannotCreateTransactionException","errorMessage":"Could not open JPA EntityManager for transaction","context":{"duration":"30004","args":"[CONCURRENT-TEST-ab6e7251-91db-45f6-9978-2253e7b1a44d, 473e15f8-de34-4269-a348-f82fefcef54e, dest@example.com, R$ 100,00]","methodName":"initiateTransfer","className":"PixTransferUseCase"},"correlationId":"46f42cd0-97c6-4c46-aa21-00e4dfbd7050","event":"error","operation":"PixTransferUseCase.initiateTransfer","transactionId":"TX-1760570384109-536","timestamp":"2025-10-15T19:20:14.113799105"}
2025-10-15 19:20:14,112 [pool-10-thread-9] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: null
2025-10-15 19:20:14,113 [pool-10-thread-8] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - HikariPool-1 - Connection is not available, request timed out after 30000ms.
2025-10-15 19:20:14,113 [pool-10-thread-9] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - HikariPool-1 - Connection is not available, request timed out after 30000ms.
2025-10-15 19:20:14,112 [pool-10-thread-5] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: null
2025-10-15 19:20:14,113 [pool-10-thread-6] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - HikariPool-1 - Connection is not available, request timed out after 30000ms.
2025-10-15 19:20:14,113 [pool-10-thread-5] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - HikariPool-1 - Connection is not available, request timed out after 30000ms.
2025-10-15 19:20:14,113 [pool-10-thread-7] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - HikariPool-1 - Connection is not available, request timed out after 30000ms.
2025-10-15 19:20:14,113 [pool-10-thread-8] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"CannotCreateTransactionException","errorMessage":"Could not open JPA EntityManager for transaction","context":{"duration":"30004","args":"[CONCURRENT-TEST-ab6e7251-91db-45f6-9978-2253e7b1a44d, 473e15f8-de34-4269-a348-f82fefcef54e, dest@example.com, R$ 100,00]","methodName":"initiateTransfer","className":"PixTransferUseCase"},"correlationId":"8489f877-c2ee-4aa2-9ed0-e822ef21ecb8","event":"error","operation":"PixTransferUseCase.initiateTransfer","transactionId":"TX-1760570384109-542","timestamp":"2025-10-15T19:20:14.113962454"}
2025-10-15 19:20:14,114 [pool-10-thread-6] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"CannotCreateTransactionException","errorMessage":"Could not open JPA EntityManager for transaction","context":{"duration":"30004","args":"[CONCURRENT-TEST-ab6e7251-91db-45f6-9978-2253e7b1a44d, 473e15f8-de34-4269-a348-f82fefcef54e, dest@example.com, R$ 100,00]","methodName":"initiateTransfer","className":"PixTransferUseCase"},"correlationId":"9f29e700-337d-424a-a038-39f90a6c9d61","event":"error","operation":"PixTransferUseCase.initiateTransfer","transactionId":"TX-1760570384109-540","timestamp":"2025-10-15T19:20:14.114010525"}
2025-10-15 19:20:14,114 [pool-10-thread-5] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"CannotCreateTransactionException","errorMessage":"Could not open JPA EntityManager for transaction","context":{"duration":"30005","args":"[CONCURRENT-TEST-ab6e7251-91db-45f6-9978-2253e7b1a44d, 473e15f8-de34-4269-a348-f82fefcef54e, dest@example.com, R$ 100,00]","methodName":"initiateTransfer","className":"PixTransferUseCase"},"correlationId":"36e77680-15d2-439c-8283-a02a8fbe8659","event":"error","operation":"PixTransferUseCase.initiateTransfer","transactionId":"TX-1760570384109-539","timestamp":"2025-10-15T19:20:14.114054548"}
2025-10-15 19:20:14,113 [pool-10-thread-4] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"CannotCreateTransactionException","errorMessage":"Could not open JPA EntityManager for transaction","context":{"duration":"30004","args":"[CONCURRENT-TEST-ab6e7251-91db-45f6-9978-2253e7b1a44d, 473e15f8-de34-4269-a348-f82fefcef54e, dest@example.com, R$ 100,00]","methodName":"initiateTransfer","className":"PixTransferUseCase"},"correlationId":"e0edeb2c-42fe-4342-a75a-93fde1f3ba1e","event":"error","operation":"PixTransferUseCase.initiateTransfer","transactionId":"TX-1760570384109-538","timestamp":"2025-10-15T19:20:14.113808723"}
2025-10-15 19:20:14,114 [pool-10-thread-7] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"CannotCreateTransactionException","errorMessage":"Could not open JPA EntityManager for transaction","context":{"duration":"30005","args":"[CONCURRENT-TEST-ab6e7251-91db-45f6-9978-2253e7b1a44d, 473e15f8-de34-4269-a348-f82fefcef54e, dest@example.com, R$ 100,00]","methodName":"initiateTransfer","className":"PixTransferUseCase"},"correlationId":"faeea4a4-945a-4059-824c-fd25cb4f011c","event":"error","operation":"PixTransferUseCase.initiateTransfer","transactionId":"TX-1760570384109-541","timestamp":"2025-10-15T19:20:14.114123869"}
2025-10-15 19:20:14,113 [pool-10-thread-10] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - HikariPool-1 - Connection is not available, request timed out after 30000ms.
2025-10-15 19:20:14,113 [pool-10-thread-1] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - HikariPool-1 - Connection is not available, request timed out after 30000ms.
2025-10-15 19:20:14,113 [pool-10-thread-3] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"CannotCreateTransactionException","errorMessage":"Could not open JPA EntityManager for transaction","context":{"duration":"30003","args":"[CONCURRENT-TEST-ab6e7251-91db-45f6-9978-2253e7b1a44d, 473e15f8-de34-4269-a348-f82fefcef54e, dest@example.com, R$ 100,00]","methodName":"initiateTransfer","className":"PixTransferUseCase"},"correlationId":"cf708eba-0c03-4929-b3b1-1ed362a66c00","event":"error","operation":"PixTransferUseCase.initiateTransfer","transactionId":"TX-1760570384109-537","timestamp":"2025-10-15T19:20:14.113799185"}
2025-10-15 19:20:14,114 [pool-10-thread-8] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: PixTransferUseCase.initiateTransfer after 30004ms
org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:531)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:610)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.domain.service.AtomicTransferService$$SpringCGLIB$$0.createTransferAtomically(<generated>)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer(PixTransferUseCase.java:65)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase$$SpringCGLIB$$0.initiateTransfer(<generated>)
	at com.finaya.pixwallet.concurrency.PixTransferConcurrencyTest.lambda$shouldHandleConcurrentTransfersWithSameIdempotencyKey$1(PixTransferConcurrencyTest.java:87)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.JDBCConnectionException: Unable to acquire JDBC Connection [HikariPool-1 - Connection is not available, request timed out after 30000ms.] [n/a]
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:51)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:116)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:143)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	... 60 common frames omitted
Caused by: java.sql.SQLTransientConnectionException: HikariPool-1 - Connection is not available, request timed out after 30000ms.
	at com.zaxxer.hikari.pool.HikariPool.createTimeoutException(HikariPool.java:696)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:181)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:146)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:128)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:38)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:113)
	... 63 common frames omitted
2025-10-15 19:20:14,113 [pool-10-thread-2] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: PixTransferUseCase.initiateTransfer after 30004ms
org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:531)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:610)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.domain.service.AtomicTransferService$$SpringCGLIB$$0.createTransferAtomically(<generated>)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer(PixTransferUseCase.java:65)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase$$SpringCGLIB$$0.initiateTransfer(<generated>)
	at com.finaya.pixwallet.concurrency.PixTransferConcurrencyTest.lambda$shouldHandleConcurrentTransfersWithSameIdempotencyKey$1(PixTransferConcurrencyTest.java:87)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.JDBCConnectionException: Unable to acquire JDBC Connection [HikariPool-1 - Connection is not available, request timed out after 30000ms.] [n/a]
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:51)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:116)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:143)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	... 60 common frames omitted
Caused by: java.sql.SQLTransientConnectionException: HikariPool-1 - Connection is not available, request timed out after 30000ms.
	at com.zaxxer.hikari.pool.HikariPool.createTimeoutException(HikariPool.java:696)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:181)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:146)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:128)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:38)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:113)
	... 63 common frames omitted
2025-10-15 19:20:14,114 [pool-10-thread-9] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"CannotCreateTransactionException","errorMessage":"Could not open JPA EntityManager for transaction","context":{"duration":"30004","args":"[CONCURRENT-TEST-ab6e7251-91db-45f6-9978-2253e7b1a44d, 473e15f8-de34-4269-a348-f82fefcef54e, dest@example.com, R$ 100,00]","methodName":"initiateTransfer","className":"PixTransferUseCase"},"correlationId":"e38888de-87cc-49c0-9e87-14cc7bd77fc7","event":"error","operation":"PixTransferUseCase.initiateTransfer","transactionId":"TX-1760570384110-543","timestamp":"2025-10-15T19:20:14.114274494"}
2025-10-15 19:20:14,114 [pool-10-thread-2] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570384109-536 for PixTransferUseCase.initiateTransfer after 30005ms - Could not open JPA EntityManager for transaction
2025-10-15 19:20:14,114 [pool-10-thread-1] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"CannotCreateTransactionException","errorMessage":"Could not open JPA EntityManager for transaction","context":{"duration":"30005","args":"[CONCURRENT-TEST-ab6e7251-91db-45f6-9978-2253e7b1a44d, 473e15f8-de34-4269-a348-f82fefcef54e, dest@example.com, R$ 100,00]","methodName":"initiateTransfer","className":"PixTransferUseCase"},"correlationId":"815f4480-0efb-4a96-9a00-ced460b0144f","event":"error","operation":"PixTransferUseCase.initiateTransfer","transactionId":"TX-1760570384109-535","timestamp":"2025-10-15T19:20:14.114406624"}
2025-10-15 19:20:14,114 [pool-10-thread-6] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: PixTransferUseCase.initiateTransfer after 30004ms
org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:531)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:610)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.domain.service.AtomicTransferService$$SpringCGLIB$$0.createTransferAtomically(<generated>)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer(PixTransferUseCase.java:65)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase$$SpringCGLIB$$0.initiateTransfer(<generated>)
	at com.finaya.pixwallet.concurrency.PixTransferConcurrencyTest.lambda$shouldHandleConcurrentTransfersWithSameIdempotencyKey$1(PixTransferConcurrencyTest.java:87)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.JDBCConnectionException: Unable to acquire JDBC Connection [HikariPool-1 - Connection is not available, request timed out after 30000ms.] [n/a]
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:51)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:116)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:143)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	... 60 common frames omitted
Caused by: java.sql.SQLTransientConnectionException: HikariPool-1 - Connection is not available, request timed out after 30000ms.
	at com.zaxxer.hikari.pool.HikariPool.createTimeoutException(HikariPool.java:696)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:181)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:146)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:128)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:38)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:113)
	... 63 common frames omitted
2025-10-15 19:20:14,114 [pool-10-thread-4] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: PixTransferUseCase.initiateTransfer after 30004ms
org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:531)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:610)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.domain.service.AtomicTransferService$$SpringCGLIB$$0.createTransferAtomically(<generated>)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer(PixTransferUseCase.java:65)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase$$SpringCGLIB$$0.initiateTransfer(<generated>)
	at com.finaya.pixwallet.concurrency.PixTransferConcurrencyTest.lambda$shouldHandleConcurrentTransfersWithSameIdempotencyKey$1(PixTransferConcurrencyTest.java:87)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.JDBCConnectionException: Unable to acquire JDBC Connection [HikariPool-1 - Connection is not available, request timed out after 30000ms.] [n/a]
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:51)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:116)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:143)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	... 60 common frames omitted
Caused by: java.sql.SQLTransientConnectionException: HikariPool-1 - Connection is not available, request timed out after 30000ms.
	at com.zaxxer.hikari.pool.HikariPool.createTimeoutException(HikariPool.java:696)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:181)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:146)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:128)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:38)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:113)
	... 63 common frames omitted
2025-10-15 19:20:14,114 [pool-10-thread-5] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: PixTransferUseCase.initiateTransfer after 30005ms
org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:531)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:610)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.domain.service.AtomicTransferService$$SpringCGLIB$$0.createTransferAtomically(<generated>)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer(PixTransferUseCase.java:65)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase$$SpringCGLIB$$0.initiateTransfer(<generated>)
	at com.finaya.pixwallet.concurrency.PixTransferConcurrencyTest.lambda$shouldHandleConcurrentTransfersWithSameIdempotencyKey$1(PixTransferConcurrencyTest.java:87)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.JDBCConnectionException: Unable to acquire JDBC Connection [HikariPool-1 - Connection is not available, request timed out after 30000ms.] [n/a]
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:51)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:116)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:143)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	... 60 common frames omitted
Caused by: java.sql.SQLTransientConnectionException: HikariPool-1 - Connection is not available, request timed out after 30000ms.
	at com.zaxxer.hikari.pool.HikariPool.createTimeoutException(HikariPool.java:696)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:181)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:146)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:128)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:38)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:113)
	... 63 common frames omitted
2025-10-15 19:20:14,114 [pool-10-thread-2] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:14,114 [pool-10-thread-6] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570384109-540 for PixTransferUseCase.initiateTransfer after 30005ms - Could not open JPA EntityManager for transaction
2025-10-15 19:20:14,114 [pool-10-thread-10] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"CannotCreateTransactionException","errorMessage":"Could not open JPA EntityManager for transaction","context":{"duration":"30004","args":"[CONCURRENT-TEST-ab6e7251-91db-45f6-9978-2253e7b1a44d, 473e15f8-de34-4269-a348-f82fefcef54e, dest@example.com, R$ 100,00]","methodName":"initiateTransfer","className":"PixTransferUseCase"},"correlationId":"da9121a2-6be3-48c0-9016-18e1c5eb2287","event":"error","operation":"PixTransferUseCase.initiateTransfer","transactionId":"TX-1760570384110-544","timestamp":"2025-10-15T19:20:14.114354145"}
2025-10-15 19:20:14,114 [pool-10-thread-3] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: PixTransferUseCase.initiateTransfer after 30003ms
org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:531)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:610)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.domain.service.AtomicTransferService$$SpringCGLIB$$0.createTransferAtomically(<generated>)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer(PixTransferUseCase.java:65)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase$$SpringCGLIB$$0.initiateTransfer(<generated>)
	at com.finaya.pixwallet.concurrency.PixTransferConcurrencyTest.lambda$shouldHandleConcurrentTransfersWithSameIdempotencyKey$1(PixTransferConcurrencyTest.java:87)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.JDBCConnectionException: Unable to acquire JDBC Connection [HikariPool-1 - Connection is not available, request timed out after 30000ms.] [n/a]
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:51)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:116)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:143)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	... 60 common frames omitted
Caused by: java.sql.SQLTransientConnectionException: HikariPool-1 - Connection is not available, request timed out after 30000ms.
	at com.zaxxer.hikari.pool.HikariPool.createTimeoutException(HikariPool.java:696)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:181)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:146)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:128)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:38)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:113)
	... 63 common frames omitted
2025-10-15 19:20:14,114 [pool-10-thread-8] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570384109-542 for PixTransferUseCase.initiateTransfer after 30005ms - Could not open JPA EntityManager for transaction
2025-10-15 19:20:14,114 [pool-10-thread-2] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(1186809076<open>)]
2025-10-15 19:20:14,114 [pool-10-thread-9] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: PixTransferUseCase.initiateTransfer after 30004ms
org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:531)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:610)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.domain.service.AtomicTransferService$$SpringCGLIB$$0.createTransferAtomically(<generated>)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer(PixTransferUseCase.java:65)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase$$SpringCGLIB$$0.initiateTransfer(<generated>)
	at com.finaya.pixwallet.concurrency.PixTransferConcurrencyTest.lambda$shouldHandleConcurrentTransfersWithSameIdempotencyKey$1(PixTransferConcurrencyTest.java:87)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.JDBCConnectionException: Unable to acquire JDBC Connection [HikariPool-1 - Connection is not available, request timed out after 30000ms.] [n/a]
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:51)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:116)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:143)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	... 60 common frames omitted
Caused by: java.sql.SQLTransientConnectionException: HikariPool-1 - Connection is not available, request timed out after 30000ms.
	at com.zaxxer.hikari.pool.HikariPool.createTimeoutException(HikariPool.java:696)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:181)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:146)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:128)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:38)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:113)
	... 63 common frames omitted
2025-10-15 19:20:14,114 [pool-10-thread-7] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: PixTransferUseCase.initiateTransfer after 30005ms
org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:531)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:610)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.domain.service.AtomicTransferService$$SpringCGLIB$$0.createTransferAtomically(<generated>)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer(PixTransferUseCase.java:65)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase$$SpringCGLIB$$0.initiateTransfer(<generated>)
	at com.finaya.pixwallet.concurrency.PixTransferConcurrencyTest.lambda$shouldHandleConcurrentTransfersWithSameIdempotencyKey$1(PixTransferConcurrencyTest.java:87)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.JDBCConnectionException: Unable to acquire JDBC Connection [HikariPool-1 - Connection is not available, request timed out after 30000ms.] [n/a]
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:51)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:116)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:143)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	... 60 common frames omitted
Caused by: java.sql.SQLTransientConnectionException: HikariPool-1 - Connection is not available, request timed out after 30000ms.
	at com.zaxxer.hikari.pool.HikariPool.createTimeoutException(HikariPool.java:696)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:181)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:146)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:128)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:38)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:113)
	... 63 common frames omitted
2025-10-15 19:20:14,114 [pool-10-thread-4] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570384109-538 for PixTransferUseCase.initiateTransfer after 30005ms - Could not open JPA EntityManager for transaction
2025-10-15 19:20:14,114 [pool-10-thread-7] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570384109-541 for PixTransferUseCase.initiateTransfer after 30005ms - Could not open JPA EntityManager for transaction
2025-10-15 19:20:14,114 [pool-10-thread-9] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570384110-543 for PixTransferUseCase.initiateTransfer after 30004ms - Could not open JPA EntityManager for transaction
2025-10-15 19:20:14,114 [pool-10-thread-7] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:14,114 [pool-10-thread-5] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570384109-539 for PixTransferUseCase.initiateTransfer after 30005ms - Could not open JPA EntityManager for transaction
2025-10-15 19:20:14,114 [pool-10-thread-6] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:14,115 [pool-10-thread-5] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:14,114 [pool-10-thread-3] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570384109-537 for PixTransferUseCase.initiateTransfer after 30005ms - Could not open JPA EntityManager for transaction
2025-10-15 19:20:14,114 [pool-10-thread-9] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:14,114 [pool-10-thread-2] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1186809076<open>)] after transaction
2025-10-15 19:20:14,114 [pool-10-thread-4] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:14,115 [pool-10-thread-3] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:14,115 [pool-10-thread-4] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(1028015502<open>)]
2025-10-15 19:20:14,114 [pool-10-thread-8] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:14,115 [pool-10-thread-6] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(272627661<open>)]
2025-10-15 19:20:14,115 [pool-10-thread-5] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(562154912<open>)]
2025-10-15 19:20:14,114 [pool-10-thread-1] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: PixTransferUseCase.initiateTransfer after 30005ms
org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:531)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:610)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.domain.service.AtomicTransferService$$SpringCGLIB$$0.createTransferAtomically(<generated>)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer(PixTransferUseCase.java:65)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase$$SpringCGLIB$$0.initiateTransfer(<generated>)
	at com.finaya.pixwallet.concurrency.PixTransferConcurrencyTest.lambda$shouldHandleConcurrentTransfersWithSameIdempotencyKey$1(PixTransferConcurrencyTest.java:87)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.JDBCConnectionException: Unable to acquire JDBC Connection [HikariPool-1 - Connection is not available, request timed out after 30000ms.] [n/a]
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:51)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:116)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:143)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	... 60 common frames omitted
Caused by: java.sql.SQLTransientConnectionException: HikariPool-1 - Connection is not available, request timed out after 30000ms.
	at com.zaxxer.hikari.pool.HikariPool.createTimeoutException(HikariPool.java:696)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:181)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:146)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:128)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:38)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:113)
	... 63 common frames omitted
2025-10-15 19:20:14,115 [pool-10-thread-9] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(1732649374<open>)]
2025-10-15 19:20:14,115 [pool-10-thread-4] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1028015502<open>)] after transaction
2025-10-15 19:20:14,115 [pool-10-thread-1] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570384109-535 for PixTransferUseCase.initiateTransfer after 30006ms - Could not open JPA EntityManager for transaction
2025-10-15 19:20:14,115 [pool-10-thread-1] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:14,115 [pool-10-thread-9] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1732649374<open>)] after transaction
2025-10-15 19:20:14,115 [pool-10-thread-8] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(763819467<open>)]
2025-10-15 19:20:14,115 [pool-10-thread-8] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(763819467<open>)] after transaction
2025-10-15 19:20:14,115 [pool-10-thread-7] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(347364450<open>)]
2025-10-15 19:20:14,115 [pool-10-thread-3] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(960188472<open>)]
2025-10-15 19:20:14,114 [pool-10-thread-10] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: PixTransferUseCase.initiateTransfer after 30004ms
org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:531)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:452)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:384)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:610)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:379)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.domain.service.AtomicTransferService$$SpringCGLIB$$0.createTransferAtomically(<generated>)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer(PixTransferUseCase.java:65)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.PixTransferUseCase$$SpringCGLIB$$0.initiateTransfer(<generated>)
	at com.finaya.pixwallet.concurrency.PixTransferConcurrencyTest.lambda$shouldHandleConcurrentTransfersWithSameIdempotencyKey$1(PixTransferConcurrencyTest.java:87)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.JDBCConnectionException: Unable to acquire JDBC Connection [HikariPool-1 - Connection is not available, request timed out after 30000ms.] [n/a]
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:51)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:116)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.getPhysicalConnection(LogicalConnectionManagedImpl.java:143)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:420)
	... 60 common frames omitted
Caused by: java.sql.SQLTransientConnectionException: HikariPool-1 - Connection is not available, request timed out after 30000ms.
	at com.zaxxer.hikari.pool.HikariPool.createTimeoutException(HikariPool.java:696)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:181)
	at com.zaxxer.hikari.pool.HikariPool.getConnection(HikariPool.java:146)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:128)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.obtainConnection(NonContextualJdbcConnectionAccess.java:38)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.acquireConnectionIfNeeded(LogicalConnectionManagedImpl.java:113)
	... 63 common frames omitted
2025-10-15 19:20:14,115 [pool-10-thread-6] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(272627661<open>)] after transaction
2025-10-15 19:20:14,115 [pool-10-thread-10] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570384110-544 for PixTransferUseCase.initiateTransfer after 30005ms - Could not open JPA EntityManager for transaction
2025-10-15 19:20:14,115 [pool-10-thread-5] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(562154912<open>)] after transaction
2025-10-15 19:20:14,115 [pool-10-thread-3] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(960188472<open>)] after transaction
2025-10-15 19:20:14,115 [pool-10-thread-1] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(1265328320<open>)]
2025-10-15 19:20:14,115 [pool-10-thread-10] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:14,115 [pool-10-thread-7] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(347364450<open>)] after transaction
2025-10-15 19:20:14,115 [pool-10-thread-10] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(790862804<open>)]
2025-10-15 19:20:14,115 [pool-10-thread-1] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1265328320<open>)] after transaction
2025-10-15 19:20:14,115 [pool-10-thread-10] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(790862804<open>)] after transaction
2025-10-15 19:20:14,116 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findByFromWalletIdOrderByCreatedAtDesc]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:14,116 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1639470179<open>)] for JPA transaction
2025-10-15 19:20:14,116 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@77544896]
2025-10-15 19:20:14,116 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.from_wallet_id=? 
    order by
        pt1_0.created_at desc
2025-10-15 19:20:14,117 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:14,117 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1639470179<open>)]
2025-10-15 19:20:14,117 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1639470179<open>)] after transaction
2025-10-15 19:20:14,121 [main] INFO  o.s.t.c.s.AnnotationConfigContextLoaderUtils - Could not detect default configuration classes for test class [com.finaya.pixwallet.integration.WalletIntegrationTest]: WalletIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2025-10-15 19:20:14,129 [main] INFO  o.s.b.t.c.SpringBootTestContextBootstrapper - Found @SpringBootConfiguration com.finaya.pixwallet.PixWalletApplication for test class com.finaya.pixwallet.integration.WalletIntegrationTest
2025-10-15 19:20:14,145 [main] INFO  c.f.p.i.WalletIntegrationTest - Starting WalletIntegrationTest using Java 21.0.7 with PID 473118 (started by ramon in /home/ramon/Documentos/code/other/finaya)
2025-10-15 19:20:14,145 [main] DEBUG c.f.p.i.WalletIntegrationTest - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-10-15 19:20:14,145 [main] INFO  c.f.p.i.WalletIntegrationTest - The following 1 profile is active: "test"
2025-10-15 19:20:14,237 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:20:14,237 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-10-15 19:20:14,240 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 2 ms. Found 4 JPA repository interfaces.
2025-10-15 19:20:14,353 [main] DEBUG o.s.o.j.LocalContainerEntityManagerFactoryBean - Building JPA container EntityManagerFactory for persistence unit 'default'
2025-10-15 19:20:14,353 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-10-15 19:20:14,354 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-10-15 19:20:14,356 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-10-15 19:20:14,356 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Starting...
2025-10-15 19:20:14,358 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-2 - Added connection conn10: url=jdbc:h2:mem:testdb user=SA
2025-10-15 19:20:14,358 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Start completed.
2025-10-15 19:20:14,358 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-15 19:20:14,416 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-10-15 19:20:14,417 [main] DEBUG org.hibernate.SQL - 
    drop table if exists idempotency_records cascade 
2025-10-15 19:20:14,418 [main] DEBUG org.hibernate.SQL - 
    drop table if exists ledger_entries cascade 
2025-10-15 19:20:14,418 [main] DEBUG org.hibernate.SQL - 
    drop table if exists pix_keys cascade 
2025-10-15 19:20:14,418 [main] DEBUG org.hibernate.SQL - 
    drop table if exists pix_transfers cascade 
2025-10-15 19:20:14,418 [main] DEBUG org.hibernate.SQL - 
    drop table if exists wallets cascade 
2025-10-15 19:20:14,419 [main] DEBUG org.hibernate.SQL - 
    create table idempotency_records (
        response_status integer not null,
        created_at timestamp(6) not null,
        expires_at timestamp(6) not null,
        id uuid not null,
        request_hash varchar(64) not null,
        scope varchar(100) not null,
        idempotency_key varchar(500) not null,
        response_body TEXT,
        primary key (id),
        unique (scope, idempotency_key)
    )
2025-10-15 19:20:14,419 [main] DEBUG org.hibernate.SQL - 
    create table ledger_entries (
        amount_centavos numeric(38,0) not null,
        balance_after_centavos numeric(38,0),
        created_at timestamp(6) not null,
        id uuid not null,
        wallet_id uuid not null,
        transaction_id varchar(100) not null,
        description varchar(500) not null,
        entry_type varchar(255) not null check (entry_type in ('CREDIT','DEBIT')),
        primary key (id)
    )
2025-10-15 19:20:14,420 [main] DEBUG org.hibernate.SQL - 
    create table pix_keys (
        is_active boolean not null,
        created_at timestamp(6) not null,
        id uuid not null,
        wallet_id uuid not null,
        key_value varchar(500) not null,
        key_type varchar(255) not null check (key_type in ('EMAIL','PHONE','CPF','CNPJ','EVP')),
        primary key (id),
        unique (key_value, key_type)
    )
2025-10-15 19:20:14,421 [main] DEBUG org.hibernate.SQL - 
    create table pix_transfers (
        amount_cents numeric(38,0) not null,
        confirmed_at timestamp(6),
        created_at timestamp(6) not null,
        rejected_at timestamp(6),
        updated_at timestamp(6) not null,
        version bigint,
        from_wallet_id uuid not null,
        id uuid not null,
        end_to_end_id varchar(32) not null unique,
        rejection_reason varchar(500),
        to_pix_key varchar(500) not null,
        idempotency_key varchar(255) not null unique,
        status varchar(255) not null check (status in ('PENDING','CONFIRMED','REJECTED')),
        primary key (id)
    )
2025-10-15 19:20:14,421 [main] DEBUG org.hibernate.SQL - 
    create table wallets (
        balance_centavos numeric(38,0) not null,
        created_at timestamp(6) not null,
        updated_at timestamp(6) not null,
        version bigint,
        id uuid not null,
        user_id varchar(255) not null,
        primary key (id)
    )
2025-10-15 19:20:14,422 [main] DEBUG org.hibernate.SQL - 
    create index idx_ledger_wallet_created 
       on ledger_entries (wallet_id, created_at)
2025-10-15 19:20:14,422 [main] DEBUG org.hibernate.SQL - 
    create index idx_ledger_transaction_id 
       on ledger_entries (transaction_id)
2025-10-15 19:20:14,422 [main] DEBUG org.hibernate.SQL - 
    alter table if exists ledger_entries 
       add constraint FKcfwn04lfp5eyco3vbjc3729ib 
       foreign key (wallet_id) 
       references wallets
2025-10-15 19:20:14,423 [main] DEBUG org.hibernate.SQL - 
    alter table if exists pix_keys 
       add constraint FKtcqgch7msy1cefy1lojhigvdk 
       foreign key (wallet_id) 
       references wallets
2025-10-15 19:20:14,423 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:20:14,480 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,516 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,524 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,527 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,528 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,529 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,549 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,549 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,554 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,556 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,580 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,591 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,594 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,596 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,597 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,597 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,611 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,619 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,620 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,622 [main] DEBUG o.s.o.j.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler - Creating new EntityManager for shared EntityManager invocation
2025-10-15 19:20:14,812 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-15 19:20:15,121 [main] INFO  o.s.b.t.m.w.SpringBootMockServletContext - Initializing Spring TestDispatcherServlet ''
2025-10-15 19:20:15,121 [main] INFO  o.s.t.w.s.TestDispatcherServlet - Initializing Servlet ''
2025-10-15 19:20:15,125 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-15 19:20:15,133 [main] INFO  o.s.t.w.s.TestDispatcherServlet - Completed initialization in 12 ms
2025-10-15 19:20:15,145 [main] INFO  c.f.p.i.WalletIntegrationTest - Started WalletIntegrationTest in 1.014 seconds (process running for 128.551)
2025-10-15 19:20:15,148 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,149 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1637966097<open>)] for JPA transaction
2025-10-15 19:20:15,149 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2454ee88]
2025-10-15 19:20:15,149 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1637966097<open>)] for JPA transaction
2025-10-15 19:20:15,149 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,149 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - Deleting all wallets - this operation should only be used in tests
2025-10-15 19:20:15,150 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0
2025-10-15 19:20:15,151 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - All wallets deleted
2025-10-15 19:20:15,152 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,152 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1637966097<open>)]
2025-10-15 19:20:15,152 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1637966097<open>)] after transaction
2025-10-15 19:20:15,179 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,221 [main] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.createWallet
2025-10-15 19:20:15,221 [main] INFO  c.f.p.a.controller.WalletController - Creating wallet for user: user123
2025-10-15 19:20:15,222 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1501848754<open>)] for JPA transaction
2025-10-15 19:20:15,222 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.createWallet]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,222 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@17d864f8]
2025-10-15 19:20:15,222 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415222-1 for WalletUseCase.createWallet
2025-10-15 19:20:15,222 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.createWallet with args: [user123]
2025-10-15 19:20:15,222 [main] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #1 for user: user123
2025-10-15 19:20:15,222 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1501848754<open>)] for JPA transaction
2025-10-15 19:20:15,222 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,222 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1501848754<open>)] for JPA transaction
2025-10-15 19:20:15,222 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,222 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Checking if wallet exists for userId: user123
2025-10-15 19:20:15,224 [main] DEBUG org.hibernate.SQL - 
    select
        count(w1_0.id) 
    from
        wallets w1_0 
    where
        w1_0.user_id=?
2025-10-15 19:20:15,224 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet exists for userId: user123 - false
2025-10-15 19:20:15,224 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1501848754<open>)] for JPA transaction
2025-10-15 19:20:15,224 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,224 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1501848754<open>)] for JPA transaction
2025-10-15 19:20:15,224 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,225 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,225 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 36e911e1-0984-4c37-a4fc-590af2842c64 - New Version: 0
2025-10-15 19:20:15,225 [main] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #1 created successfully - ID: 36e911e1-0984-4c37-a4fc-590af2842c64, User: user123
2025-10-15 19:20:15,226 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"e3f6f4c8-d133-4c40-beac-f640a580e517","correlationId":"e3f6f4c8-d133-4c40-beac-f640a580e517","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":3,"transactionId":"TX-1760570415222-1","timestamp":"2025-10-15T19:20:15.225882005"}
2025-10-15 19:20:15,226 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.createWallet in 3ms
2025-10-15 19:20:15,226 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415222-1 for WalletUseCase.createWallet in 4ms
2025-10-15 19:20:15,226 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,226 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1501848754<open>)]
2025-10-15 19:20:15,228 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,229 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Not closing pre-bound JPA EntityManager after transaction
2025-10-15 19:20:15,229 [main] INFO  c.f.p.a.controller.WalletController - Wallet created successfully - ID: 36e911e1-0984-4c37-a4fc-590af2842c64, User: user123
2025-10-15 19:20:15,230 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"0bd87d21-5bad-4c86-882e-feb6f0a59c5c","event":"performance_metric","operation":"HTTP.WalletController.createWallet","durationMs":8,"timestamp":"2025-10-15T19:20:15.230041763"}
2025-10-15 19:20:15,230 [main] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.createWallet in 8ms
2025-10-15 19:20:15,247 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,252 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,253 [main] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.createWallet
2025-10-15 19:20:15,253 [main] INFO  c.f.p.a.controller.WalletController - Creating wallet for user: user123
2025-10-15 19:20:15,253 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(758778997<open>)] for JPA transaction
2025-10-15 19:20:15,253 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.createWallet]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,253 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@a29670a]
2025-10-15 19:20:15,253 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415253-1 for WalletUseCase.createWallet
2025-10-15 19:20:15,253 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.createWallet with args: [user123]
2025-10-15 19:20:15,253 [main] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #2 for user: user123
2025-10-15 19:20:15,253 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(758778997<open>)] for JPA transaction
2025-10-15 19:20:15,253 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,253 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(758778997<open>)] for JPA transaction
2025-10-15 19:20:15,253 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,253 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Checking if wallet exists for userId: user123
2025-10-15 19:20:15,253 [main] DEBUG org.hibernate.SQL - 
    select
        count(w1_0.id) 
    from
        wallets w1_0 
    where
        w1_0.user_id=?
2025-10-15 19:20:15,254 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet exists for userId: user123 - true
2025-10-15 19:20:15,254 [main] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"IllegalArgumentException","errorMessage":"Wallet already exists for user: user123","context":{"duration":"1","args":"[user123]","methodName":"createWallet","className":"WalletUseCase"},"correlationId":"5f3a767d-1972-49b0-a89d-4b6877831811","event":"error","operation":"WalletUseCase.createWallet","transactionId":"TX-1760570415253-1","timestamp":"2025-10-15T19:20:15.254283535"}
2025-10-15 19:20:15,254 [main] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: WalletUseCase.createWallet after 1ms
java.lang.IllegalArgumentException: Wallet already exists for user: user123
	at com.finaya.pixwallet.application.usecase.WalletUseCase.createWallet(WalletUseCase.java:53)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:163)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.WalletUseCase$$SpringCGLIB$$1.createWallet(<generated>)
	at com.finaya.pixwallet.application.controller.WalletController.createWallet(WalletController.java:53)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at io.micrometer.core.aop.TimedAspect.processWithTimer(TimedAspect.java:227)
	at io.micrometer.core.aop.TimedAspect.perform(TimedAspect.java:202)
	at io.micrometer.core.aop.TimedAspect.timedMethod(TimedAspect.java:194)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logControllerExecution(LoggingAspect.java:120)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.controller.WalletController$$SpringCGLIB$$0.createWallet(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:72)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:165)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:201)
	at com.finaya.pixwallet.integration.WalletIntegrationTest.shouldNotCreateDuplicateWallet(WalletIntegrationTest.java:75)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:218)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:214)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:139)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
2025-10-15 19:20:15,255 [main] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570415253-1 for WalletUseCase.createWallet after 2ms - Wallet already exists for user: user123
2025-10-15 19:20:15,255 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:15,255 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(758778997<open>)]
2025-10-15 19:20:15,255 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Not closing pre-bound JPA EntityManager after transaction
2025-10-15 19:20:15,255 [main] ERROR c.f.p.a.controller.WalletController - Failed to create wallet - validation error occurred
2025-10-15 19:20:15,255 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"18eb78a9-a2e4-4909-8291-93e4be131257","event":"performance_metric","operation":"HTTP.WalletController.createWallet","durationMs":2,"timestamp":"2025-10-15T19:20:15.255604864"}
2025-10-15 19:20:15,255 [main] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.createWallet in 2ms
2025-10-15 19:20:15,255 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,258 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,258 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1859722525<open>)] for JPA transaction
2025-10-15 19:20:15,258 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4685fae6]
2025-10-15 19:20:15,258 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1859722525<open>)] for JPA transaction
2025-10-15 19:20:15,258 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,258 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - Deleting all wallets - this operation should only be used in tests
2025-10-15 19:20:15,259 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0
2025-10-15 19:20:15,260 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Deleting wallet: 36e911e1-0984-4c37-a4fc-590af2842c64
2025-10-15 19:20:15,260 [main] DEBUG org.hibernate.SQL - 
    select
        le1_0.wallet_id,
        le1_0.id,
        le1_0.amount_centavos,
        le1_0.balance_after_centavos,
        le1_0.created_at,
        le1_0.description,
        le1_0.entry_type,
        le1_0.transaction_id 
    from
        ledger_entries le1_0 
    where
        le1_0.wallet_id=?
2025-10-15 19:20:15,260 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.wallet_id,
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value 
    from
        pix_keys pk1_0 
    where
        pk1_0.wallet_id=?
2025-10-15 19:20:15,260 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Wallet deleted: 36e911e1-0984-4c37-a4fc-590af2842c64
2025-10-15 19:20:15,260 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - All wallets deleted
2025-10-15 19:20:15,260 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,260 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1859722525<open>)]
2025-10-15 19:20:15,261 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        wallets 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,261 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1859722525<open>)] after transaction
2025-10-15 19:20:15,262 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,262 [main] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.createWallet
2025-10-15 19:20:15,262 [main] INFO  c.f.p.a.controller.WalletController - Creating wallet for user: user123
2025-10-15 19:20:15,262 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(5753511<open>)] for JPA transaction
2025-10-15 19:20:15,262 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.createWallet]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,262 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@3d8b888f]
2025-10-15 19:20:15,262 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415262-1 for WalletUseCase.createWallet
2025-10-15 19:20:15,263 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.createWallet with args: [user123]
2025-10-15 19:20:15,263 [main] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #3 for user: user123
2025-10-15 19:20:15,263 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(5753511<open>)] for JPA transaction
2025-10-15 19:20:15,263 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,263 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(5753511<open>)] for JPA transaction
2025-10-15 19:20:15,263 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,263 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Checking if wallet exists for userId: user123
2025-10-15 19:20:15,263 [main] DEBUG org.hibernate.SQL - 
    select
        count(w1_0.id) 
    from
        wallets w1_0 
    where
        w1_0.user_id=?
2025-10-15 19:20:15,263 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet exists for userId: user123 - false
2025-10-15 19:20:15,263 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(5753511<open>)] for JPA transaction
2025-10-15 19:20:15,263 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,263 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(5753511<open>)] for JPA transaction
2025-10-15 19:20:15,263 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,263 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,263 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: efae5612-a877-4e1c-9579-6a8a3c9cb440 - New Version: 0
2025-10-15 19:20:15,263 [main] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #3 created successfully - ID: efae5612-a877-4e1c-9579-6a8a3c9cb440, User: user123
2025-10-15 19:20:15,263 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"dff9898f-6887-4955-87cf-a5d399130739","correlationId":"dff9898f-6887-4955-87cf-a5d399130739","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":0,"transactionId":"TX-1760570415262-1","timestamp":"2025-10-15T19:20:15.263796157"}
2025-10-15 19:20:15,263 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.createWallet in 0ms
2025-10-15 19:20:15,263 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415262-1 for WalletUseCase.createWallet in 1ms
2025-10-15 19:20:15,263 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,263 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(5753511<open>)]
2025-10-15 19:20:15,264 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,264 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Not closing pre-bound JPA EntityManager after transaction
2025-10-15 19:20:15,264 [main] INFO  c.f.p.a.controller.WalletController - Wallet created successfully - ID: efae5612-a877-4e1c-9579-6a8a3c9cb440, User: user123
2025-10-15 19:20:15,264 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"d333df33-5db4-43b7-afb6-7575ea9c48e7","event":"performance_metric","operation":"HTTP.WalletController.createWallet","durationMs":2,"timestamp":"2025-10-15T19:20:15.26444806"}
2025-10-15 19:20:15,264 [main] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.createWallet in 2ms
2025-10-15 19:20:15,264 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,289 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.existsById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,289 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(80433549<open>)] for JPA transaction
2025-10-15 19:20:15,289 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2960a7fe]
2025-10-15 19:20:15,290 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(80433549<open>)] for JPA transaction
2025-10-15 19:20:15,290 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,292 [main] DEBUG org.hibernate.SQL - 
    select
        count(*) 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,293 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,293 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(80433549<open>)]
2025-10-15 19:20:15,293 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(80433549<open>)] after transaction
2025-10-15 19:20:15,296 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,296 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(517323317<open>)] for JPA transaction
2025-10-15 19:20:15,296 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4e37373c]
2025-10-15 19:20:15,296 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(517323317<open>)] for JPA transaction
2025-10-15 19:20:15,296 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,296 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - Deleting all wallets - this operation should only be used in tests
2025-10-15 19:20:15,296 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0
2025-10-15 19:20:15,297 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Deleting wallet: efae5612-a877-4e1c-9579-6a8a3c9cb440
2025-10-15 19:20:15,297 [main] DEBUG org.hibernate.SQL - 
    select
        le1_0.wallet_id,
        le1_0.id,
        le1_0.amount_centavos,
        le1_0.balance_after_centavos,
        le1_0.created_at,
        le1_0.description,
        le1_0.entry_type,
        le1_0.transaction_id 
    from
        ledger_entries le1_0 
    where
        le1_0.wallet_id=?
2025-10-15 19:20:15,297 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.wallet_id,
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value 
    from
        pix_keys pk1_0 
    where
        pk1_0.wallet_id=?
2025-10-15 19:20:15,297 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Wallet deleted: efae5612-a877-4e1c-9579-6a8a3c9cb440
2025-10-15 19:20:15,297 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - All wallets deleted
2025-10-15 19:20:15,297 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,297 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(517323317<open>)]
2025-10-15 19:20:15,297 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        wallets 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,298 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(517323317<open>)] after transaction
2025-10-15 19:20:15,299 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,300 [main] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.getBalance
2025-10-15 19:20:15,300 [main] DEBUG c.f.p.a.controller.WalletController - Getting balance for wallet: c080bf6c-f6c4-4484-87ba-5732b6550465, timestamp: null
2025-10-15 19:20:15,300 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(26323287<open>)] for JPA transaction
2025-10-15 19:20:15,300 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.getBalance]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,300 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5555eb81]
2025-10-15 19:20:15,300 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415300-1 for WalletUseCase.getBalance
2025-10-15 19:20:15,300 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.getBalance with args: [c080bf6c-f6c4-4484-87ba-5732b6550465]
2025-10-15 19:20:15,300 [main] DEBUG c.f.p.a.usecase.WalletUseCase - Getting balance for wallet: c080bf6c-f6c4-4484-87ba-5732b6550465
2025-10-15 19:20:15,300 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(26323287<open>)] for JPA transaction
2025-10-15 19:20:15,300 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,300 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(26323287<open>)] for JPA transaction
2025-10-15 19:20:15,300 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,300 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: c080bf6c-f6c4-4484-87ba-5732b6550465
2025-10-15 19:20:15,300 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,301 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet not found: c080bf6c-f6c4-4484-87ba-5732b6550465
2025-10-15 19:20:15,301 [main] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"IllegalArgumentException","errorMessage":"Wallet not found: c080bf6c-f6c4-4484-87ba-5732b6550465","context":{"duration":"1","args":"[c080bf6c-f6c4-4484-87ba-5732b6550465]","methodName":"getBalance","className":"WalletUseCase"},"correlationId":"f957be3d-84e6-4ea0-b1c3-6b39e80106a5","event":"error","operation":"WalletUseCase.getBalance","transactionId":"TX-1760570415300-1","timestamp":"2025-10-15T19:20:15.301450809"}
2025-10-15 19:20:15,301 [main] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: WalletUseCase.getBalance after 1ms
java.lang.IllegalArgumentException: Wallet not found: c080bf6c-f6c4-4484-87ba-5732b6550465
	at com.finaya.pixwallet.application.usecase.WalletUseCase.lambda$getBalance$1(WalletUseCase.java:89)
	at java.base/java.util.Optional.orElseThrow(Optional.java:403)
	at com.finaya.pixwallet.application.usecase.WalletUseCase.getBalance(WalletUseCase.java:89)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:163)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.WalletUseCase$$SpringCGLIB$$1.getBalance(<generated>)
	at com.finaya.pixwallet.application.controller.WalletController.getBalance(WalletController.java:98)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at io.micrometer.core.aop.TimedAspect.processWithTimer(TimedAspect.java:227)
	at io.micrometer.core.aop.TimedAspect.perform(TimedAspect.java:202)
	at io.micrometer.core.aop.TimedAspect.timedMethod(TimedAspect.java:194)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logControllerExecution(LoggingAspect.java:120)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.controller.WalletController$$SpringCGLIB$$0.getBalance(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:72)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:165)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:201)
	at com.finaya.pixwallet.integration.WalletIntegrationTest.shouldReturnNotFoundForNonExistentWallet(WalletIntegrationTest.java:142)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:218)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:214)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:139)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
2025-10-15 19:20:15,302 [main] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570415300-1 for WalletUseCase.getBalance after 2ms - Wallet not found: c080bf6c-f6c4-4484-87ba-5732b6550465
2025-10-15 19:20:15,302 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:15,302 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(26323287<open>)]
2025-10-15 19:20:15,302 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Not closing pre-bound JPA EntityManager after transaction
2025-10-15 19:20:15,302 [main] ERROR c.f.p.a.controller.WalletController - Failed to get balance for wallet c080bf6c-f6c4-4484-87ba-5732b6550465: Wallet not found: c080bf6c-f6c4-4484-87ba-5732b6550465
2025-10-15 19:20:15,302 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"ad5c8227-d273-43da-bc0d-142d5d70b997","event":"performance_metric","operation":"HTTP.WalletController.getBalance","durationMs":2,"timestamp":"2025-10-15T19:20:15.302540119"}
2025-10-15 19:20:15,302 [main] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.getBalance in 2ms
2025-10-15 19:20:15,304 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,306 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,307 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(838698170<open>)] for JPA transaction
2025-10-15 19:20:15,307 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@c4ced8e]
2025-10-15 19:20:15,307 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(838698170<open>)] for JPA transaction
2025-10-15 19:20:15,307 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,307 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - Deleting all wallets - this operation should only be used in tests
2025-10-15 19:20:15,307 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0
2025-10-15 19:20:15,307 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - All wallets deleted
2025-10-15 19:20:15,307 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,307 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(838698170<open>)]
2025-10-15 19:20:15,308 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(838698170<open>)] after transaction
2025-10-15 19:20:15,308 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,308 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(30709766<open>)] for JPA transaction
2025-10-15 19:20:15,308 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6c4adb44]
2025-10-15 19:20:15,308 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(30709766<open>)] for JPA transaction
2025-10-15 19:20:15,308 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,308 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,308 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: c9f9dcd1-8b29-4530-b371-ebb5b825ccd1 - New Version: 0
2025-10-15 19:20:15,308 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,308 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(30709766<open>)]
2025-10-15 19:20:15,308 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,308 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(30709766<open>)] after transaction
2025-10-15 19:20:15,311 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,319 [main] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.deposit
2025-10-15 19:20:15,319 [main] INFO  c.f.p.a.controller.WalletController - Processing deposit for wallet: c9f9dcd1-8b29-4530-b371-ebb5b825ccd1 - Amount: 100.50
2025-10-15 19:20:15,319 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(716238420<open>)] for JPA transaction
2025-10-15 19:20:15,319 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.deposit]: PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE
2025-10-15 19:20:15,319 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@19b3800e]
2025-10-15 19:20:15,319 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415319-1 for WalletUseCase.deposit
2025-10-15 19:20:15,320 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.deposit with args: [c9f9dcd1-8b29-4530-b371-ebb5b825ccd1, R$ 100,50, Test deposit]
2025-10-15 19:20:15,320 [main] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic deposit #1 - Wallet: c9f9dcd1-8b29-4530-b371-ebb5b825ccd1, Amount: R$ 100,50, Description: Test deposit
2025-10-15 19:20:15,320 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(716238420<open>)] for JPA transaction
2025-10-15 19:20:15,320 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,321 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,322 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(716238420<open>)] for JPA transaction
2025-10-15 19:20:15,322 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,322 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(716238420<open>)] for JPA transaction
2025-10-15 19:20:15,322 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,322 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: c9f9dcd1-8b29-4530-b371-ebb5b825ccd1 - Balance: R$ 100,50, Version: 0
2025-10-15 19:20:15,322 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: c9f9dcd1-8b29-4530-b371-ebb5b825ccd1 - New Version: 0
2025-10-15 19:20:15,323 [main] INFO  c.f.p.a.usecase.WalletUseCase - Atomic deposit processed successfully - Deposit #1, Wallet: c9f9dcd1-8b29-4530-b371-ebb5b825ccd1, Amount: R$ 100,50, Balance: R$ 0,00 -> R$ 100,50
2025-10-15 19:20:15,323 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"aed6cf51-a5ff-4fc8-acb3-e5964f77dc7c","correlationId":"aed6cf51-a5ff-4fc8-acb3-e5964f77dc7c","event":"performance_metric","operation":"WalletUseCase.deposit","durationMs":3,"transactionId":"TX-1760570415319-1","timestamp":"2025-10-15T19:20:15.323097432"}
2025-10-15 19:20:15,323 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.deposit in 3ms
2025-10-15 19:20:15,323 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415319-1 for WalletUseCase.deposit in 4ms
2025-10-15 19:20:15,323 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,323 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(716238420<open>)]
2025-10-15 19:20:15,325 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,325 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,326 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Not closing pre-bound JPA EntityManager after transaction
2025-10-15 19:20:15,326 [main] INFO  c.f.p.a.controller.WalletController - Deposit processed successfully for wallet: c9f9dcd1-8b29-4530-b371-ebb5b825ccd1 - Amount: 100.50
2025-10-15 19:20:15,326 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"73c2bb54-643f-4c90-81f5-6417bf58e850","event":"performance_metric","operation":"HTTP.WalletController.deposit","durationMs":7,"timestamp":"2025-10-15T19:20:15.326456966"}
2025-10-15 19:20:15,326 [main] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.deposit in 7ms
2025-10-15 19:20:15,327 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,328 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,328 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1299661691<open>)] for JPA transaction
2025-10-15 19:20:15,328 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2f7cf665]
2025-10-15 19:20:15,328 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1299661691<open>)] for JPA transaction
2025-10-15 19:20:15,328 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,328 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: c9f9dcd1-8b29-4530-b371-ebb5b825ccd1
2025-10-15 19:20:15,328 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,328 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: c9f9dcd1-8b29-4530-b371-ebb5b825ccd1 - Balance: R$ 100,50
2025-10-15 19:20:15,328 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,328 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1299661691<open>)]
2025-10-15 19:20:15,329 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1299661691<open>)] after transaction
2025-10-15 19:20:15,332 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,332 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1106125451<open>)] for JPA transaction
2025-10-15 19:20:15,332 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@65420507]
2025-10-15 19:20:15,332 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1106125451<open>)] for JPA transaction
2025-10-15 19:20:15,332 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,332 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - Deleting all wallets - this operation should only be used in tests
2025-10-15 19:20:15,333 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0
2025-10-15 19:20:15,333 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Deleting wallet: c9f9dcd1-8b29-4530-b371-ebb5b825ccd1
2025-10-15 19:20:15,333 [main] DEBUG org.hibernate.SQL - 
    select
        le1_0.wallet_id,
        le1_0.id,
        le1_0.amount_centavos,
        le1_0.balance_after_centavos,
        le1_0.created_at,
        le1_0.description,
        le1_0.entry_type,
        le1_0.transaction_id 
    from
        ledger_entries le1_0 
    where
        le1_0.wallet_id=?
2025-10-15 19:20:15,334 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.wallet_id,
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value 
    from
        pix_keys pk1_0 
    where
        pk1_0.wallet_id=?
2025-10-15 19:20:15,334 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Wallet deleted: c9f9dcd1-8b29-4530-b371-ebb5b825ccd1
2025-10-15 19:20:15,334 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - All wallets deleted
2025-10-15 19:20:15,334 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,334 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1106125451<open>)]
2025-10-15 19:20:15,334 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        ledger_entries 
    where
        id=?
2025-10-15 19:20:15,334 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        wallets 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,334 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1106125451<open>)] after transaction
2025-10-15 19:20:15,335 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,335 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(862525395<open>)] for JPA transaction
2025-10-15 19:20:15,335 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@67b4b072]
2025-10-15 19:20:15,335 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(862525395<open>)] for JPA transaction
2025-10-15 19:20:15,335 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,335 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 200,00, Version: null
2025-10-15 19:20:15,335 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 8335795e-2a77-4afc-bdc8-0d60063b4d12 - New Version: 0
2025-10-15 19:20:15,336 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,336 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(862525395<open>)]
2025-10-15 19:20:15,336 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,336 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,336 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(862525395<open>)] after transaction
2025-10-15 19:20:15,338 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,341 [main] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.withdraw
2025-10-15 19:20:15,341 [main] INFO  c.f.p.a.controller.WalletController - Processing withdrawal for wallet: 8335795e-2a77-4afc-bdc8-0d60063b4d12 - Amount: 50.25
2025-10-15 19:20:15,342 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2032681387<open>)] for JPA transaction
2025-10-15 19:20:15,342 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.withdraw]: PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE
2025-10-15 19:20:15,342 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@54eb65bc]
2025-10-15 19:20:15,342 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415342-1 for WalletUseCase.withdraw
2025-10-15 19:20:15,342 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.withdraw with args: [8335795e-2a77-4afc-bdc8-0d60063b4d12, R$ 50,25, Test withdrawal]
2025-10-15 19:20:15,342 [main] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic withdrawal #1 - Wallet: 8335795e-2a77-4afc-bdc8-0d60063b4d12, Amount: R$ 50,25, Description: Test withdrawal
2025-10-15 19:20:15,342 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2032681387<open>)] for JPA transaction
2025-10-15 19:20:15,342 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,343 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,343 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2032681387<open>)] for JPA transaction
2025-10-15 19:20:15,343 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,343 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2032681387<open>)] for JPA transaction
2025-10-15 19:20:15,343 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,343 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: 8335795e-2a77-4afc-bdc8-0d60063b4d12 - Balance: R$ 149,75, Version: 0
2025-10-15 19:20:15,344 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 8335795e-2a77-4afc-bdc8-0d60063b4d12 - New Version: 0
2025-10-15 19:20:15,344 [main] INFO  c.f.p.a.usecase.WalletUseCase - Atomic withdrawal processed successfully - Withdrawal #1, Wallet: 8335795e-2a77-4afc-bdc8-0d60063b4d12, Amount: R$ 50,25, Balance: R$ 200,00 -> R$ 149,75
2025-10-15 19:20:15,344 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"dbd8785d-e3b4-4378-92b3-7360089c86b0","correlationId":"dbd8785d-e3b4-4378-92b3-7360089c86b0","event":"performance_metric","operation":"WalletUseCase.withdraw","durationMs":2,"transactionId":"TX-1760570415342-1","timestamp":"2025-10-15T19:20:15.34420774"}
2025-10-15 19:20:15,344 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.withdraw in 2ms
2025-10-15 19:20:15,344 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415342-1 for WalletUseCase.withdraw in 2ms
2025-10-15 19:20:15,344 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,344 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(2032681387<open>)]
2025-10-15 19:20:15,344 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,344 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,345 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Not closing pre-bound JPA EntityManager after transaction
2025-10-15 19:20:15,345 [main] INFO  c.f.p.a.controller.WalletController - Withdrawal processed successfully for wallet: 8335795e-2a77-4afc-bdc8-0d60063b4d12 - Amount: 50.25
2025-10-15 19:20:15,345 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"98c1036d-e672-489a-9494-db27efe71935","event":"performance_metric","operation":"HTTP.WalletController.withdraw","durationMs":4,"timestamp":"2025-10-15T19:20:15.34541274"}
2025-10-15 19:20:15,345 [main] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.withdraw in 4ms
2025-10-15 19:20:15,345 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,346 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,346 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(461224193<open>)] for JPA transaction
2025-10-15 19:20:15,346 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@16669033]
2025-10-15 19:20:15,346 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(461224193<open>)] for JPA transaction
2025-10-15 19:20:15,346 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,346 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: 8335795e-2a77-4afc-bdc8-0d60063b4d12
2025-10-15 19:20:15,346 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,346 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: 8335795e-2a77-4afc-bdc8-0d60063b4d12 - Balance: R$ 149,75
2025-10-15 19:20:15,346 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,346 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(461224193<open>)]
2025-10-15 19:20:15,346 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(461224193<open>)] after transaction
2025-10-15 19:20:15,349 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,349 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1918252650<open>)] for JPA transaction
2025-10-15 19:20:15,349 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@3368ce0d]
2025-10-15 19:20:15,349 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1918252650<open>)] for JPA transaction
2025-10-15 19:20:15,349 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,349 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - Deleting all wallets - this operation should only be used in tests
2025-10-15 19:20:15,350 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0
2025-10-15 19:20:15,350 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Deleting wallet: 8335795e-2a77-4afc-bdc8-0d60063b4d12
2025-10-15 19:20:15,351 [main] DEBUG org.hibernate.SQL - 
    select
        le1_0.wallet_id,
        le1_0.id,
        le1_0.amount_centavos,
        le1_0.balance_after_centavos,
        le1_0.created_at,
        le1_0.description,
        le1_0.entry_type,
        le1_0.transaction_id 
    from
        ledger_entries le1_0 
    where
        le1_0.wallet_id=?
2025-10-15 19:20:15,351 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.wallet_id,
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value 
    from
        pix_keys pk1_0 
    where
        pk1_0.wallet_id=?
2025-10-15 19:20:15,351 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Wallet deleted: 8335795e-2a77-4afc-bdc8-0d60063b4d12
2025-10-15 19:20:15,351 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - All wallets deleted
2025-10-15 19:20:15,351 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,351 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1918252650<open>)]
2025-10-15 19:20:15,351 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        ledger_entries 
    where
        id=?
2025-10-15 19:20:15,352 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        ledger_entries 
    where
        id=?
2025-10-15 19:20:15,352 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        wallets 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,352 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1918252650<open>)] after transaction
2025-10-15 19:20:15,352 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,352 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(2102233821<open>)] for JPA transaction
2025-10-15 19:20:15,352 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@c65734e]
2025-10-15 19:20:15,352 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2102233821<open>)] for JPA transaction
2025-10-15 19:20:15,352 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,352 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,352 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 7a835bc2-bbc9-4802-8600-9a370475e835 - New Version: 0
2025-10-15 19:20:15,353 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,353 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(2102233821<open>)]
2025-10-15 19:20:15,353 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,353 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(2102233821<open>)] after transaction
2025-10-15 19:20:15,354 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,354 [main] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.withdraw
2025-10-15 19:20:15,354 [main] INFO  c.f.p.a.controller.WalletController - Processing withdrawal for wallet: 7a835bc2-bbc9-4802-8600-9a370475e835 - Amount: 100.00
2025-10-15 19:20:15,354 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1544429494<open>)] for JPA transaction
2025-10-15 19:20:15,354 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.withdraw]: PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE
2025-10-15 19:20:15,355 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@16b6e6c3]
2025-10-15 19:20:15,355 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415355-1 for WalletUseCase.withdraw
2025-10-15 19:20:15,355 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.withdraw with args: [7a835bc2-bbc9-4802-8600-9a370475e835, R$ 100,00, Test withdrawal]
2025-10-15 19:20:15,355 [main] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic withdrawal #2 - Wallet: 7a835bc2-bbc9-4802-8600-9a370475e835, Amount: R$ 100,00, Description: Test withdrawal
2025-10-15 19:20:15,355 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1544429494<open>)] for JPA transaction
2025-10-15 19:20:15,355 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,355 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,356 [main] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"IllegalArgumentException","errorMessage":"Insufficient funds - Available: R$ 0,00, Required: R$ 100,00","context":{"duration":"1","args":"[7a835bc2-bbc9-4802-8600-9a370475e835, R$ 100,00, Test withdrawal]","methodName":"withdraw","className":"WalletUseCase"},"correlationId":"981dfa78-e589-4f42-aece-f6209238585f","event":"error","operation":"WalletUseCase.withdraw","transactionId":"TX-1760570415355-1","timestamp":"2025-10-15T19:20:15.356021946"}
2025-10-15 19:20:15,356 [main] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: WalletUseCase.withdraw after 1ms
java.lang.IllegalArgumentException: Insufficient funds - Available: R$ 0,00, Required: R$ 100,00
	at com.finaya.pixwallet.application.usecase.WalletUseCase.withdraw(WalletUseCase.java:170)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.WalletUseCase$$SpringCGLIB$$1.withdraw(<generated>)
	at com.finaya.pixwallet.application.controller.WalletController.withdraw(WalletController.java:137)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at io.micrometer.core.aop.TimedAspect.processWithTimer(TimedAspect.java:227)
	at io.micrometer.core.aop.TimedAspect.perform(TimedAspect.java:202)
	at io.micrometer.core.aop.TimedAspect.timedMethod(TimedAspect.java:194)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logControllerExecution(LoggingAspect.java:120)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.controller.WalletController$$SpringCGLIB$$0.withdraw(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:72)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:165)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:201)
	at com.finaya.pixwallet.integration.WalletIntegrationTest.shouldNotWithdrawWhenInsufficientFunds(WalletIntegrationTest.java:132)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:218)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:214)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:139)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
2025-10-15 19:20:15,356 [main] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570415355-1 for WalletUseCase.withdraw after 1ms - Insufficient funds - Available: R$ 0,00, Required: R$ 100,00
2025-10-15 19:20:15,356 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:15,356 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(1544429494<open>)]
2025-10-15 19:20:15,357 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Not closing pre-bound JPA EntityManager after transaction
2025-10-15 19:20:15,457 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1544429494<open>)] for JPA transaction
2025-10-15 19:20:15,457 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.withdraw]: PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE
2025-10-15 19:20:15,457 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@25941b5b]
2025-10-15 19:20:15,457 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415457-1 for WalletUseCase.withdraw
2025-10-15 19:20:15,457 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.withdraw with args: [7a835bc2-bbc9-4802-8600-9a370475e835, R$ 100,00, Test withdrawal]
2025-10-15 19:20:15,457 [main] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic withdrawal #3 - Wallet: 7a835bc2-bbc9-4802-8600-9a370475e835, Amount: R$ 100,00, Description: Test withdrawal
2025-10-15 19:20:15,457 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1544429494<open>)] for JPA transaction
2025-10-15 19:20:15,457 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,458 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,458 [main] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"IllegalArgumentException","errorMessage":"Insufficient funds - Available: R$ 0,00, Required: R$ 100,00","context":{"duration":"1","args":"[7a835bc2-bbc9-4802-8600-9a370475e835, R$ 100,00, Test withdrawal]","methodName":"withdraw","className":"WalletUseCase"},"correlationId":"da94e6bb-4f14-4f88-8a7c-aa96b31c5f79","event":"error","operation":"WalletUseCase.withdraw","transactionId":"TX-1760570415457-1","timestamp":"2025-10-15T19:20:15.458940069"}
2025-10-15 19:20:15,459 [main] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: WalletUseCase.withdraw after 1ms
java.lang.IllegalArgumentException: Insufficient funds - Available: R$ 0,00, Required: R$ 100,00
	at com.finaya.pixwallet.application.usecase.WalletUseCase.withdraw(WalletUseCase.java:170)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.WalletUseCase$$SpringCGLIB$$1.withdraw(<generated>)
	at com.finaya.pixwallet.application.controller.WalletController.withdraw(WalletController.java:137)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at io.micrometer.core.aop.TimedAspect.processWithTimer(TimedAspect.java:227)
	at io.micrometer.core.aop.TimedAspect.perform(TimedAspect.java:202)
	at io.micrometer.core.aop.TimedAspect.timedMethod(TimedAspect.java:194)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logControllerExecution(LoggingAspect.java:120)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.controller.WalletController$$SpringCGLIB$$0.withdraw(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:72)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:165)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:201)
	at com.finaya.pixwallet.integration.WalletIntegrationTest.shouldNotWithdrawWhenInsufficientFunds(WalletIntegrationTest.java:132)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:218)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:214)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:139)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
2025-10-15 19:20:15,459 [main] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570415457-1 for WalletUseCase.withdraw after 2ms - Insufficient funds - Available: R$ 0,00, Required: R$ 100,00
2025-10-15 19:20:15,459 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:15,459 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(1544429494<open>)]
2025-10-15 19:20:15,460 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Not closing pre-bound JPA EntityManager after transaction
2025-10-15 19:20:15,560 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1544429494<open>)] for JPA transaction
2025-10-15 19:20:15,560 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.withdraw]: PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE
2025-10-15 19:20:15,560 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@542a0f90]
2025-10-15 19:20:15,560 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415560-1 for WalletUseCase.withdraw
2025-10-15 19:20:15,560 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.withdraw with args: [7a835bc2-bbc9-4802-8600-9a370475e835, R$ 100,00, Test withdrawal]
2025-10-15 19:20:15,560 [main] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic withdrawal #4 - Wallet: 7a835bc2-bbc9-4802-8600-9a370475e835, Amount: R$ 100,00, Description: Test withdrawal
2025-10-15 19:20:15,560 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1544429494<open>)] for JPA transaction
2025-10-15 19:20:15,560 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,560 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,561 [main] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"IllegalArgumentException","errorMessage":"Insufficient funds - Available: R$ 0,00, Required: R$ 100,00","context":{"duration":"1","args":"[7a835bc2-bbc9-4802-8600-9a370475e835, R$ 100,00, Test withdrawal]","methodName":"withdraw","className":"WalletUseCase"},"correlationId":"a5d8166d-8883-4da6-8a0e-388ebcdf1103","event":"error","operation":"WalletUseCase.withdraw","transactionId":"TX-1760570415560-1","timestamp":"2025-10-15T19:20:15.561708509"}
2025-10-15 19:20:15,561 [main] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: WalletUseCase.withdraw after 1ms
java.lang.IllegalArgumentException: Insufficient funds - Available: R$ 0,00, Required: R$ 100,00
	at com.finaya.pixwallet.application.usecase.WalletUseCase.withdraw(WalletUseCase.java:170)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor$1.doWithRetry(RetryOperationsInterceptor.java:102)
	at org.springframework.retry.support.RetryTemplate.doExecute(RetryTemplate.java:329)
	at org.springframework.retry.support.RetryTemplate.execute(RetryTemplate.java:209)
	at org.springframework.retry.interceptor.RetryOperationsInterceptor.invoke(RetryOperationsInterceptor.java:135)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:160)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.WalletUseCase$$SpringCGLIB$$1.withdraw(<generated>)
	at com.finaya.pixwallet.application.controller.WalletController.withdraw(WalletController.java:137)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at io.micrometer.core.aop.TimedAspect.processWithTimer(TimedAspect.java:227)
	at io.micrometer.core.aop.TimedAspect.perform(TimedAspect.java:202)
	at io.micrometer.core.aop.TimedAspect.timedMethod(TimedAspect.java:194)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logControllerExecution(LoggingAspect.java:120)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.controller.WalletController$$SpringCGLIB$$0.withdraw(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:72)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:165)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:201)
	at com.finaya.pixwallet.integration.WalletIntegrationTest.shouldNotWithdrawWhenInsufficientFunds(WalletIntegrationTest.java:132)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:218)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:214)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:139)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
2025-10-15 19:20:15,562 [main] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760570415560-1 for WalletUseCase.withdraw after 2ms - Insufficient funds - Available: R$ 0,00, Required: R$ 100,00
2025-10-15 19:20:15,562 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction rollback
2025-10-15 19:20:15,562 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Rolling back JPA transaction on EntityManager [SessionImpl(1544429494<open>)]
2025-10-15 19:20:15,562 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Not closing pre-bound JPA EntityManager after transaction
2025-10-15 19:20:15,562 [main] ERROR c.f.p.a.controller.WalletController - Failed to process withdrawal for wallet 7a835bc2-bbc9-4802-8600-9a370475e835: Insufficient funds - Available: R$ 0,00, Required: R$ 100,00
2025-10-15 19:20:15,562 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"edc6c888-49a1-4ebf-acc9-2a39a03fa3bc","event":"performance_metric","operation":"HTTP.WalletController.withdraw","durationMs":208,"timestamp":"2025-10-15T19:20:15.562800484"}
2025-10-15 19:20:15,562 [main] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.withdraw in 208ms
2025-10-15 19:20:15,563 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,565 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,566 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(732445761<open>)] for JPA transaction
2025-10-15 19:20:15,566 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@316245b6]
2025-10-15 19:20:15,566 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(732445761<open>)] for JPA transaction
2025-10-15 19:20:15,566 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,566 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - Deleting all wallets - this operation should only be used in tests
2025-10-15 19:20:15,566 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0
2025-10-15 19:20:15,566 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Deleting wallet: 7a835bc2-bbc9-4802-8600-9a370475e835
2025-10-15 19:20:15,567 [main] DEBUG org.hibernate.SQL - 
    select
        le1_0.wallet_id,
        le1_0.id,
        le1_0.amount_centavos,
        le1_0.balance_after_centavos,
        le1_0.created_at,
        le1_0.description,
        le1_0.entry_type,
        le1_0.transaction_id 
    from
        ledger_entries le1_0 
    where
        le1_0.wallet_id=?
2025-10-15 19:20:15,567 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.wallet_id,
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value 
    from
        pix_keys pk1_0 
    where
        pk1_0.wallet_id=?
2025-10-15 19:20:15,567 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Wallet deleted: 7a835bc2-bbc9-4802-8600-9a370475e835
2025-10-15 19:20:15,567 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - All wallets deleted
2025-10-15 19:20:15,567 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,567 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(732445761<open>)]
2025-10-15 19:20:15,567 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        wallets 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,567 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(732445761<open>)] after transaction
2025-10-15 19:20:15,568 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.save]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,568 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1570710450<open>)] for JPA transaction
2025-10-15 19:20:15,568 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@28a9f772]
2025-10-15 19:20:15,568 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1570710450<open>)] for JPA transaction
2025-10-15 19:20:15,568 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,568 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,568 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 14ad1fac-3d7b-4669-a304-8e00d106e086 - New Version: 0
2025-10-15 19:20:15,568 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,568 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1570710450<open>)]
2025-10-15 19:20:15,568 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,568 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1570710450<open>)] after transaction
2025-10-15 19:20:15,569 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Opening JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,569 [main] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.getBalance
2025-10-15 19:20:15,569 [main] DEBUG c.f.p.a.controller.WalletController - Getting balance for wallet: 14ad1fac-3d7b-4669-a304-8e00d106e086, timestamp: null
2025-10-15 19:20:15,569 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(297389039<open>)] for JPA transaction
2025-10-15 19:20:15,569 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.getBalance]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,569 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@32fbea]
2025-10-15 19:20:15,569 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415569-1 for WalletUseCase.getBalance
2025-10-15 19:20:15,569 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.getBalance with args: [14ad1fac-3d7b-4669-a304-8e00d106e086]
2025-10-15 19:20:15,569 [main] DEBUG c.f.p.a.usecase.WalletUseCase - Getting balance for wallet: 14ad1fac-3d7b-4669-a304-8e00d106e086
2025-10-15 19:20:15,569 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(297389039<open>)] for JPA transaction
2025-10-15 19:20:15,569 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,569 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(297389039<open>)] for JPA transaction
2025-10-15 19:20:15,569 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,569 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: 14ad1fac-3d7b-4669-a304-8e00d106e086
2025-10-15 19:20:15,569 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,570 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: 14ad1fac-3d7b-4669-a304-8e00d106e086 - Balance: R$ 0,00
2025-10-15 19:20:15,570 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"fa9d63cb-4c05-4d47-a3cb-ed0718f1c119","correlationId":"fa9d63cb-4c05-4d47-a3cb-ed0718f1c119","event":"performance_metric","operation":"WalletUseCase.getBalance","durationMs":1,"transactionId":"TX-1760570415569-1","timestamp":"2025-10-15T19:20:15.570076406"}
2025-10-15 19:20:15,570 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.getBalance in 1ms
2025-10-15 19:20:15,570 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415569-1 for WalletUseCase.getBalance in 1ms
2025-10-15 19:20:15,570 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,570 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(297389039<open>)]
2025-10-15 19:20:15,570 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Not closing pre-bound JPA EntityManager after transaction
2025-10-15 19:20:15,570 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"c9fb1312-f539-4bdc-b1ac-e17d289ffd71","event":"performance_metric","operation":"HTTP.WalletController.getBalance","durationMs":1,"timestamp":"2025-10-15T19:20:15.57024248"}
2025-10-15 19:20:15,570 [main] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.getBalance in 1ms
2025-10-15 19:20:15,570 [main] DEBUG o.s.o.j.s.OpenEntityManagerInViewInterceptor - Closing JPA EntityManager in OpenEntityManagerInViewInterceptor
2025-10-15 19:20:15,573 [main] INFO  o.s.t.c.s.AnnotationConfigContextLoaderUtils - Could not detect default configuration classes for test class [com.finaya.pixwallet.integration.IdempotencyTest]: IdempotencyTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2025-10-15 19:20:15,574 [main] INFO  o.s.b.t.c.SpringBootTestContextBootstrapper - Found @SpringBootConfiguration com.finaya.pixwallet.PixWalletApplication for test class com.finaya.pixwallet.integration.IdempotencyTest
2025-10-15 19:20:15,576 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,576 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(964389101<open>)] for JPA transaction
2025-10-15 19:20:15,576 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6f601ce0]
2025-10-15 19:20:15,576 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(964389101<open>)] for JPA transaction
2025-10-15 19:20:15,576 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,576 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415576-1 for PixTransferRepositoryImpl.deleteAll
2025-10-15 19:20:15,577 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0
2025-10-15 19:20:15,577 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415576-1 for PixTransferRepositoryImpl.deleteAll in 1ms
2025-10-15 19:20:15,577 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,577 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(964389101<open>)]
2025-10-15 19:20:15,577 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(964389101<open>)] after transaction
2025-10-15 19:20:15,577 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,577 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(656856272<open>)] for JPA transaction
2025-10-15 19:20:15,577 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@3da0180a]
2025-10-15 19:20:15,577 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(656856272<open>)] for JPA transaction
2025-10-15 19:20:15,577 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,577 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - Deleting all wallets - this operation should only be used in tests
2025-10-15 19:20:15,578 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0
2025-10-15 19:20:15,578 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Deleting wallet: 14ad1fac-3d7b-4669-a304-8e00d106e086
2025-10-15 19:20:15,578 [main] DEBUG org.hibernate.SQL - 
    select
        le1_0.wallet_id,
        le1_0.id,
        le1_0.amount_centavos,
        le1_0.balance_after_centavos,
        le1_0.created_at,
        le1_0.description,
        le1_0.entry_type,
        le1_0.transaction_id 
    from
        ledger_entries le1_0 
    where
        le1_0.wallet_id=?
2025-10-15 19:20:15,578 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.wallet_id,
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value 
    from
        pix_keys pk1_0 
    where
        pk1_0.wallet_id=?
2025-10-15 19:20:15,578 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Wallet deleted: 14ad1fac-3d7b-4669-a304-8e00d106e086
2025-10-15 19:20:15,578 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - All wallets deleted
2025-10-15 19:20:15,578 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,578 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(656856272<open>)]
2025-10-15 19:20:15,579 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        wallets 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,579 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(656856272<open>)] after transaction
2025-10-15 19:20:15,579 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.createWallet]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,579 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(97728322<open>)] for JPA transaction
2025-10-15 19:20:15,579 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7cf3544]
2025-10-15 19:20:15,579 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415579-1 for WalletUseCase.createWallet
2025-10-15 19:20:15,579 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.createWallet with args: [source-user]
2025-10-15 19:20:15,579 [main] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #25 for user: source-user
2025-10-15 19:20:15,579 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(97728322<open>)] for JPA transaction
2025-10-15 19:20:15,579 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,579 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(97728322<open>)] for JPA transaction
2025-10-15 19:20:15,579 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,579 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Checking if wallet exists for userId: source-user
2025-10-15 19:20:15,579 [main] DEBUG org.hibernate.SQL - 
    select
        count(w1_0.id) 
    from
        wallets w1_0 
    where
        w1_0.user_id=?
2025-10-15 19:20:15,579 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet exists for userId: source-user - false
2025-10-15 19:20:15,579 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(97728322<open>)] for JPA transaction
2025-10-15 19:20:15,579 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,579 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(97728322<open>)] for JPA transaction
2025-10-15 19:20:15,579 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,579 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,579 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 534c2db5-2149-44de-9d55-dffb39582ca3 - New Version: 0
2025-10-15 19:20:15,579 [main] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #25 created successfully - ID: 534c2db5-2149-44de-9d55-dffb39582ca3, User: source-user
2025-10-15 19:20:15,580 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"05a9c305-7e37-43fb-8131-e681dd4312c2","correlationId":"05a9c305-7e37-43fb-8131-e681dd4312c2","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":0,"transactionId":"TX-1760570415579-1","timestamp":"2025-10-15T19:20:15.579992571"}
2025-10-15 19:20:15,580 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.createWallet in 0ms
2025-10-15 19:20:15,580 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415579-1 for WalletUseCase.createWallet in 1ms
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(97728322<open>)]
2025-10-15 19:20:15,580 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(97728322<open>)] after transaction
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.createWallet]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(294308211<open>)] for JPA transaction
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5e5978e5]
2025-10-15 19:20:15,580 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415580-1 for WalletUseCase.createWallet
2025-10-15 19:20:15,580 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.createWallet with args: [dest-user]
2025-10-15 19:20:15,580 [main] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #26 for user: dest-user
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(294308211<open>)] for JPA transaction
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(294308211<open>)] for JPA transaction
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,580 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Checking if wallet exists for userId: dest-user
2025-10-15 19:20:15,580 [main] DEBUG org.hibernate.SQL - 
    select
        count(w1_0.id) 
    from
        wallets w1_0 
    where
        w1_0.user_id=?
2025-10-15 19:20:15,580 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet exists for userId: dest-user - false
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(294308211<open>)] for JPA transaction
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(294308211<open>)] for JPA transaction
2025-10-15 19:20:15,580 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,580 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,580 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 167e6850-720d-4195-943b-12f6d8be3be9 - New Version: 0
2025-10-15 19:20:15,580 [main] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #26 created successfully - ID: 167e6850-720d-4195-943b-12f6d8be3be9, User: dest-user
2025-10-15 19:20:15,580 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"7334055a-f83d-4b83-af4a-bd6b283284a0","correlationId":"7334055a-f83d-4b83-af4a-bd6b283284a0","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":0,"transactionId":"TX-1760570415580-1","timestamp":"2025-10-15T19:20:15.580976863"}
2025-10-15 19:20:15,581 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.createWallet in 0ms
2025-10-15 19:20:15,581 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415580-1 for WalletUseCase.createWallet in 1ms
2025-10-15 19:20:15,581 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,581 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(294308211<open>)]
2025-10-15 19:20:15,581 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,581 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(294308211<open>)] after transaction
2025-10-15 19:20:15,581 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.deposit]: PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE
2025-10-15 19:20:15,581 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(481976794<open>)] for JPA transaction
2025-10-15 19:20:15,581 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@337eb1b4]
2025-10-15 19:20:15,581 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415581-1 for WalletUseCase.deposit
2025-10-15 19:20:15,581 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.deposit with args: [534c2db5-2149-44de-9d55-dffb39582ca3, R$ 1.000,00, Initial deposit]
2025-10-15 19:20:15,581 [main] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic deposit #261 - Wallet: 534c2db5-2149-44de-9d55-dffb39582ca3, Amount: R$ 1.000,00, Description: Initial deposit
2025-10-15 19:20:15,581 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(481976794<open>)] for JPA transaction
2025-10-15 19:20:15,581 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,581 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,581 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(481976794<open>)] for JPA transaction
2025-10-15 19:20:15,581 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,581 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(481976794<open>)] for JPA transaction
2025-10-15 19:20:15,581 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,581 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: 534c2db5-2149-44de-9d55-dffb39582ca3 - Balance: R$ 1.000,00, Version: 0
2025-10-15 19:20:15,582 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 534c2db5-2149-44de-9d55-dffb39582ca3 - New Version: 0
2025-10-15 19:20:15,582 [main] INFO  c.f.p.a.usecase.WalletUseCase - Atomic deposit processed successfully - Deposit #261, Wallet: 534c2db5-2149-44de-9d55-dffb39582ca3, Amount: R$ 1.000,00, Balance: R$ 0,00 -> R$ 1.000,00
2025-10-15 19:20:15,582 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"afc9b1ee-210c-4c5b-a632-8ae9fffe45aa","correlationId":"afc9b1ee-210c-4c5b-a632-8ae9fffe45aa","event":"performance_metric","operation":"WalletUseCase.deposit","durationMs":1,"transactionId":"TX-1760570415581-1","timestamp":"2025-10-15T19:20:15.582210397"}
2025-10-15 19:20:15,582 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.deposit in 1ms
2025-10-15 19:20:15,582 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415581-1 for WalletUseCase.deposit in 1ms
2025-10-15 19:20:15,582 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,582 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(481976794<open>)]
2025-10-15 19:20:15,582 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,582 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,582 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(481976794<open>)] after transaction
2025-10-15 19:20:15,582 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.registerPixKey]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,582 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(268566575<open>)] for JPA transaction
2025-10-15 19:20:15,582 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5d442535]
2025-10-15 19:20:15,582 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415582-1 for WalletUseCase.registerPixKey
2025-10-15 19:20:15,582 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.registerPixKey with args: [167e6850-720d-4195-943b-12f6d8be3be9, dest@example.com, EMAIL]
2025-10-15 19:20:15,583 [main] INFO  c.f.p.a.usecase.WalletUseCase - Registering Pix key #8 for wallet: 167e6850-720d-4195-943b-12f6d8be3be9 - Key: dest@example.com, Type: EMAIL
2025-10-15 19:20:15,583 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.id 
    from
        pix_keys pk1_0 
    where
        pk1_0.key_value=? 
        and pk1_0.key_type=? 
        and pk1_0.is_active=? 
    fetch
        first ? rows only
2025-10-15 19:20:15,583 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(268566575<open>)] for JPA transaction
2025-10-15 19:20:15,583 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,583 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(268566575<open>)] for JPA transaction
2025-10-15 19:20:15,583 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,583 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: 167e6850-720d-4195-943b-12f6d8be3be9
2025-10-15 19:20:15,584 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,584 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: 167e6850-720d-4195-943b-12f6d8be3be9 - Balance: R$ 0,00
2025-10-15 19:20:15,584 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(268566575<open>)] for JPA transaction
2025-10-15 19:20:15,584 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,584 [main] INFO  c.f.p.a.usecase.WalletUseCase - Pix key #8 registered successfully - ID: a5e71bc6-ac19-4c30-8daa-e1b33a17f043, Key: dest@example.com
2025-10-15 19:20:15,584 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"2fb85ce9-1047-4c22-b8fe-2ba5b084af27","correlationId":"2fb85ce9-1047-4c22-b8fe-2ba5b084af27","event":"performance_metric","operation":"WalletUseCase.registerPixKey","durationMs":2,"transactionId":"TX-1760570415582-1","timestamp":"2025-10-15T19:20:15.58440091"}
2025-10-15 19:20:15,584 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.registerPixKey in 2ms
2025-10-15 19:20:15,584 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415582-1 for WalletUseCase.registerPixKey in 2ms
2025-10-15 19:20:15,584 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,584 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(268566575<open>)]
2025-10-15 19:20:15,584 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        pix_keys
        (created_at, is_active, key_type, key_value, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,584 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(268566575<open>)] after transaction
2025-10-15 19:20:15,585 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,585 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(117559504<open>)] for JPA transaction
2025-10-15 19:20:15,585 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@338f0970]
2025-10-15 19:20:15,585 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415585-1 for PixTransferUseCase.initiateTransfer
2025-10-15 19:20:15,585 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: PixTransferUseCase.initiateTransfer with args: [IDEMPOTENCY-TEST-8833a4bb-ea4c-4678-b8a8-45bd74b89b8c, 534c2db5-2149-44de-9d55-dffb39582ca3, dest@example.com, R$ 100,00]
2025-10-15 19:20:15,585 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Initiating Pix transfer with atomic operations - Idempotency Key: IDEMPOTENCY-TEST-8833a4bb-ea4c-4678-b8a8-45bd74b89b8c, From: 534c2db5-2149-44de-9d55-dffb39582ca3, To: dest@example.com, Amount: R$ 100,00
2025-10-15 19:20:15,585 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(117559504<open>)] for JPA transaction
2025-10-15 19:20:15,585 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,585 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(117559504<open>)] for JPA transaction
2025-10-15 19:20:15,585 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,585 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Finding transfer by idempotencyKey: IDEMPOTENCY-TEST-8833a4bb-ea4c-4678-b8a8-45bd74b89b8c
2025-10-15 19:20:15,585 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.idempotency_key=?
2025-10-15 19:20:15,585 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - No transfer found for idempotencyKey: IDEMPOTENCY-TEST-8833a4bb-ea4c-4678-b8a8-45bd74b89b8c
2025-10-15 19:20:15,585 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value,
        pk1_0.wallet_id 
    from
        pix_keys pk1_0 
    where
        pk1_0.key_value=? 
        and pk1_0.is_active=true
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(117559504<open>)] for JPA transaction
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Suspending current transaction, creating new transaction with name [com.finaya.pixwallet.domain.service.AtomicTransferService.createTransferAtomically]
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1994161115<open>)] for JPA transaction
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5241e263]
2025-10-15 19:20:15,586 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: AtomicTransferService.createTransferAtomically
2025-10-15 19:20:15,586 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415586-1 for AtomicTransferService.createTransferAtomically
2025-10-15 19:20:15,586 [main] INFO  c.f.p.d.s.AtomicTransferService - Starting atomic transfer creation - ID: 3, EndToEnd: E1760570415586839720991274466283, From: 534c2db5-2149-44de-9d55-dffb39582ca3, Amount: R$ 100,00
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1994161115<open>)] for JPA transaction
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,586 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1994161115<open>)] for JPA transaction
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1994161115<open>)] for JPA transaction
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,586 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: 534c2db5-2149-44de-9d55-dffb39582ca3 - Balance: R$ 900,00, Version: 1
2025-10-15 19:20:15,586 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 534c2db5-2149-44de-9d55-dffb39582ca3 - New Version: 1
2025-10-15 19:20:15,586 [main] DEBUG c.f.p.d.s.AtomicTransferService - Wallet debited atomically - ID: 534c2db5-2149-44de-9d55-dffb39582ca3, Amount: R$ 100,00, NewBalance: R$ 900,00
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1994161115<open>)] for JPA transaction
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1994161115<open>)] for JPA transaction
2025-10-15 19:20:15,586 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,586 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Saving transfer: E1760570415586839720991274466283 - Status: PENDING, Version: null
2025-10-15 19:20:15,587 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Transfer saved successfully: E1760570415586839720991274466283 - New Version: 0
2025-10-15 19:20:15,587 [main] INFO  c.f.p.d.s.AtomicTransferService - Atomic transfer created successfully - ID: 3, EndToEnd: E1760570415586839720991274466283
2025-10-15 19:20:15,587 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415586-1 for AtomicTransferService.createTransferAtomically in 1ms
2025-10-15 19:20:15,587 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: AtomicTransferService.createTransferAtomically in 1ms
2025-10-15 19:20:15,587 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,587 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1994161115<open>)]
2025-10-15 19:20:15,587 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,587 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        pix_transfers
        (amount_cents, confirmed_at, created_at, end_to_end_id, from_wallet_id, idempotency_key, rejected_at, rejection_reason, status, to_pix_key, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,587 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,587 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1994161115<open>)] after transaction
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Resuming suspended transaction after completion of inner transaction
2025-10-15 19:20:15,588 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Pix transfer initiated atomically - End-to-End ID: E1760570415586839720991274466283, Transfer ID: cc201f38-5521-4398-904b-3174ec27f48f
2025-10-15 19:20:15,588 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"2f76fe77-8a99-4ec5-9925-4a98bd0ebf1a","correlationId":"2f76fe77-8a99-4ec5-9925-4a98bd0ebf1a","event":"performance_metric","operation":"PixTransferUseCase.initiateTransfer","durationMs":3,"transactionId":"TX-1760570415586-1","timestamp":"2025-10-15T19:20:15.588081351"}
2025-10-15 19:20:15,588 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: PixTransferUseCase.initiateTransfer in 3ms
2025-10-15 19:20:15,588 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415585-1 for PixTransferUseCase.initiateTransfer in 3ms
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(117559504<open>)]
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(117559504<open>)] after transaction
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(190476512<open>)] for JPA transaction
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5c806f1d]
2025-10-15 19:20:15,588 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415588-1 for PixTransferUseCase.initiateTransfer
2025-10-15 19:20:15,588 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: PixTransferUseCase.initiateTransfer with args: [IDEMPOTENCY-TEST-8833a4bb-ea4c-4678-b8a8-45bd74b89b8c, 534c2db5-2149-44de-9d55-dffb39582ca3, dest@example.com, R$ 100,00]
2025-10-15 19:20:15,588 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Initiating Pix transfer with atomic operations - Idempotency Key: IDEMPOTENCY-TEST-8833a4bb-ea4c-4678-b8a8-45bd74b89b8c, From: 534c2db5-2149-44de-9d55-dffb39582ca3, To: dest@example.com, Amount: R$ 100,00
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(190476512<open>)] for JPA transaction
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(190476512<open>)] for JPA transaction
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,588 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Finding transfer by idempotencyKey: IDEMPOTENCY-TEST-8833a4bb-ea4c-4678-b8a8-45bd74b89b8c
2025-10-15 19:20:15,588 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.idempotency_key=?
2025-10-15 19:20:15,588 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Found transfer for idempotencyKey: IDEMPOTENCY-TEST-8833a4bb-ea4c-4678-b8a8-45bd74b89b8c - EndToEnd: E1760570415586839720991274466283, Status: PENDING
2025-10-15 19:20:15,588 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Transfer already exists for idempotency key: IDEMPOTENCY-TEST-8833a4bb-ea4c-4678-b8a8-45bd74b89b8c
2025-10-15 19:20:15,588 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"f01eae96-80af-4ecc-a730-f699a233ec51","correlationId":"f01eae96-80af-4ecc-a730-f699a233ec51","event":"performance_metric","operation":"PixTransferUseCase.initiateTransfer","durationMs":0,"transactionId":"TX-1760570415588-1","timestamp":"2025-10-15T19:20:15.588668391"}
2025-10-15 19:20:15,588 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: PixTransferUseCase.initiateTransfer in 0ms
2025-10-15 19:20:15,588 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415588-1 for PixTransferUseCase.initiateTransfer in 0ms
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(190476512<open>)]
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(190476512<open>)] after transaction
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findByFromWalletIdOrderByCreatedAtDesc]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1171498878<open>)] for JPA transaction
2025-10-15 19:20:15,588 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7df8898a]
2025-10-15 19:20:15,589 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.from_wallet_id=? 
    order by
        pt1_0.created_at desc
2025-10-15 19:20:15,589 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,589 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1171498878<open>)]
2025-10-15 19:20:15,589 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1171498878<open>)] after transaction
2025-10-15 19:20:15,589 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,589 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1771780052<open>)] for JPA transaction
2025-10-15 19:20:15,589 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@43567fca]
2025-10-15 19:20:15,589 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1771780052<open>)] for JPA transaction
2025-10-15 19:20:15,589 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,589 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: 534c2db5-2149-44de-9d55-dffb39582ca3
2025-10-15 19:20:15,589 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,589 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: 534c2db5-2149-44de-9d55-dffb39582ca3 - Balance: R$ 900,00
2025-10-15 19:20:15,589 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,589 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1771780052<open>)]
2025-10-15 19:20:15,589 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1771780052<open>)] after transaction
2025-10-15 19:20:15,592 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,592 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1807775584<open>)] for JPA transaction
2025-10-15 19:20:15,592 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@f4416fc]
2025-10-15 19:20:15,592 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1807775584<open>)] for JPA transaction
2025-10-15 19:20:15,592 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,592 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415592-1 for PixTransferRepositoryImpl.deleteAll
2025-10-15 19:20:15,593 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0
2025-10-15 19:20:15,593 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415592-1 for PixTransferRepositoryImpl.deleteAll in 1ms
2025-10-15 19:20:15,593 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,593 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1807775584<open>)]
2025-10-15 19:20:15,593 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        pix_transfers 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,593 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1807775584<open>)] after transaction
2025-10-15 19:20:15,593 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,593 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1064907559<open>)] for JPA transaction
2025-10-15 19:20:15,593 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@29a1e9fc]
2025-10-15 19:20:15,593 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1064907559<open>)] for JPA transaction
2025-10-15 19:20:15,593 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,593 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - Deleting all wallets - this operation should only be used in tests
2025-10-15 19:20:15,594 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0
2025-10-15 19:20:15,594 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Deleting wallet: 534c2db5-2149-44de-9d55-dffb39582ca3
2025-10-15 19:20:15,594 [main] DEBUG org.hibernate.SQL - 
    select
        le1_0.wallet_id,
        le1_0.id,
        le1_0.amount_centavos,
        le1_0.balance_after_centavos,
        le1_0.created_at,
        le1_0.description,
        le1_0.entry_type,
        le1_0.transaction_id 
    from
        ledger_entries le1_0 
    where
        le1_0.wallet_id=?
2025-10-15 19:20:15,595 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.wallet_id,
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value 
    from
        pix_keys pk1_0 
    where
        pk1_0.wallet_id=?
2025-10-15 19:20:15,595 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Wallet deleted: 534c2db5-2149-44de-9d55-dffb39582ca3
2025-10-15 19:20:15,595 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Deleting wallet: 167e6850-720d-4195-943b-12f6d8be3be9
2025-10-15 19:20:15,595 [main] DEBUG org.hibernate.SQL - 
    select
        le1_0.wallet_id,
        le1_0.id,
        le1_0.amount_centavos,
        le1_0.balance_after_centavos,
        le1_0.created_at,
        le1_0.description,
        le1_0.entry_type,
        le1_0.transaction_id 
    from
        ledger_entries le1_0 
    where
        le1_0.wallet_id=?
2025-10-15 19:20:15,595 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.wallet_id,
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value 
    from
        pix_keys pk1_0 
    where
        pk1_0.wallet_id=?
2025-10-15 19:20:15,595 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Wallet deleted: 167e6850-720d-4195-943b-12f6d8be3be9
2025-10-15 19:20:15,595 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - All wallets deleted
2025-10-15 19:20:15,595 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,595 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1064907559<open>)]
2025-10-15 19:20:15,595 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        ledger_entries 
    where
        id=?
2025-10-15 19:20:15,595 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        ledger_entries 
    where
        id=?
2025-10-15 19:20:15,595 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        wallets 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,596 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        pix_keys 
    where
        id=?
2025-10-15 19:20:15,596 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        wallets 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,596 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1064907559<open>)] after transaction
2025-10-15 19:20:15,596 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.createWallet]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,596 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(800954245<open>)] for JPA transaction
2025-10-15 19:20:15,596 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@74786396]
2025-10-15 19:20:15,596 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415596-1 for WalletUseCase.createWallet
2025-10-15 19:20:15,596 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.createWallet with args: [source-user]
2025-10-15 19:20:15,596 [main] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #27 for user: source-user
2025-10-15 19:20:15,596 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(800954245<open>)] for JPA transaction
2025-10-15 19:20:15,596 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,596 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(800954245<open>)] for JPA transaction
2025-10-15 19:20:15,596 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,596 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Checking if wallet exists for userId: source-user
2025-10-15 19:20:15,596 [main] DEBUG org.hibernate.SQL - 
    select
        count(w1_0.id) 
    from
        wallets w1_0 
    where
        w1_0.user_id=?
2025-10-15 19:20:15,597 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet exists for userId: source-user - false
2025-10-15 19:20:15,597 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(800954245<open>)] for JPA transaction
2025-10-15 19:20:15,597 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,597 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(800954245<open>)] for JPA transaction
2025-10-15 19:20:15,597 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,597 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,597 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 46293309-0992-4cec-8f09-c73cb0544dab - New Version: 0
2025-10-15 19:20:15,597 [main] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #27 created successfully - ID: 46293309-0992-4cec-8f09-c73cb0544dab, User: source-user
2025-10-15 19:20:15,597 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"a7691c0c-a07d-4c65-988d-807025bf975a","correlationId":"a7691c0c-a07d-4c65-988d-807025bf975a","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":1,"transactionId":"TX-1760570415596-1","timestamp":"2025-10-15T19:20:15.597691297"}
2025-10-15 19:20:15,597 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.createWallet in 1ms
2025-10-15 19:20:15,597 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415596-1 for WalletUseCase.createWallet in 1ms
2025-10-15 19:20:15,597 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,597 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(800954245<open>)]
2025-10-15 19:20:15,597 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(800954245<open>)] after transaction
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.createWallet]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1682454927<open>)] for JPA transaction
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6dc12603]
2025-10-15 19:20:15,598 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415598-1 for WalletUseCase.createWallet
2025-10-15 19:20:15,598 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.createWallet with args: [dest-user]
2025-10-15 19:20:15,598 [main] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #28 for user: dest-user
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1682454927<open>)] for JPA transaction
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1682454927<open>)] for JPA transaction
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,598 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Checking if wallet exists for userId: dest-user
2025-10-15 19:20:15,598 [main] DEBUG org.hibernate.SQL - 
    select
        count(w1_0.id) 
    from
        wallets w1_0 
    where
        w1_0.user_id=?
2025-10-15 19:20:15,598 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet exists for userId: dest-user - false
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1682454927<open>)] for JPA transaction
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1682454927<open>)] for JPA transaction
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,598 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,598 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: e93eeb59-2d57-4e2a-b97e-e002f8bc592f - New Version: 0
2025-10-15 19:20:15,598 [main] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #28 created successfully - ID: e93eeb59-2d57-4e2a-b97e-e002f8bc592f, User: dest-user
2025-10-15 19:20:15,598 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"9a0010c5-f4ec-41f0-9f83-5fe33d4c40a6","correlationId":"9a0010c5-f4ec-41f0-9f83-5fe33d4c40a6","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":0,"transactionId":"TX-1760570415598-1","timestamp":"2025-10-15T19:20:15.598899132"}
2025-10-15 19:20:15,598 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.createWallet in 0ms
2025-10-15 19:20:15,598 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415598-1 for WalletUseCase.createWallet in 0ms
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,598 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1682454927<open>)]
2025-10-15 19:20:15,599 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,599 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1682454927<open>)] after transaction
2025-10-15 19:20:15,599 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.deposit]: PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE
2025-10-15 19:20:15,599 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(590382622<open>)] for JPA transaction
2025-10-15 19:20:15,599 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1e28feb0]
2025-10-15 19:20:15,599 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415599-1 for WalletUseCase.deposit
2025-10-15 19:20:15,599 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.deposit with args: [46293309-0992-4cec-8f09-c73cb0544dab, R$ 1.000,00, Initial deposit]
2025-10-15 19:20:15,599 [main] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic deposit #262 - Wallet: 46293309-0992-4cec-8f09-c73cb0544dab, Amount: R$ 1.000,00, Description: Initial deposit
2025-10-15 19:20:15,599 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(590382622<open>)] for JPA transaction
2025-10-15 19:20:15,599 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,599 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,599 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(590382622<open>)] for JPA transaction
2025-10-15 19:20:15,599 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,599 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(590382622<open>)] for JPA transaction
2025-10-15 19:20:15,599 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,599 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: 46293309-0992-4cec-8f09-c73cb0544dab - Balance: R$ 1.000,00, Version: 0
2025-10-15 19:20:15,600 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 46293309-0992-4cec-8f09-c73cb0544dab - New Version: 0
2025-10-15 19:20:15,600 [main] INFO  c.f.p.a.usecase.WalletUseCase - Atomic deposit processed successfully - Deposit #262, Wallet: 46293309-0992-4cec-8f09-c73cb0544dab, Amount: R$ 1.000,00, Balance: R$ 0,00 -> R$ 1.000,00
2025-10-15 19:20:15,600 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"07466c58-f959-420b-90b0-f370e5d760d5","correlationId":"07466c58-f959-420b-90b0-f370e5d760d5","event":"performance_metric","operation":"WalletUseCase.deposit","durationMs":1,"transactionId":"TX-1760570415599-1","timestamp":"2025-10-15T19:20:15.600104592"}
2025-10-15 19:20:15,600 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.deposit in 1ms
2025-10-15 19:20:15,600 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415599-1 for WalletUseCase.deposit in 1ms
2025-10-15 19:20:15,600 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,600 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(590382622<open>)]
2025-10-15 19:20:15,600 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,600 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,600 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(590382622<open>)] after transaction
2025-10-15 19:20:15,600 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.registerPixKey]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,600 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(222197667<open>)] for JPA transaction
2025-10-15 19:20:15,600 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@ff68deb]
2025-10-15 19:20:15,600 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415600-1 for WalletUseCase.registerPixKey
2025-10-15 19:20:15,600 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.registerPixKey with args: [e93eeb59-2d57-4e2a-b97e-e002f8bc592f, dest@example.com, EMAIL]
2025-10-15 19:20:15,600 [main] INFO  c.f.p.a.usecase.WalletUseCase - Registering Pix key #9 for wallet: e93eeb59-2d57-4e2a-b97e-e002f8bc592f - Key: dest@example.com, Type: EMAIL
2025-10-15 19:20:15,601 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.id 
    from
        pix_keys pk1_0 
    where
        pk1_0.key_value=? 
        and pk1_0.key_type=? 
        and pk1_0.is_active=? 
    fetch
        first ? rows only
2025-10-15 19:20:15,601 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(222197667<open>)] for JPA transaction
2025-10-15 19:20:15,601 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,601 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(222197667<open>)] for JPA transaction
2025-10-15 19:20:15,601 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,601 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: e93eeb59-2d57-4e2a-b97e-e002f8bc592f
2025-10-15 19:20:15,601 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,602 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: e93eeb59-2d57-4e2a-b97e-e002f8bc592f - Balance: R$ 0,00
2025-10-15 19:20:15,602 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(222197667<open>)] for JPA transaction
2025-10-15 19:20:15,602 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,602 [main] INFO  c.f.p.a.usecase.WalletUseCase - Pix key #9 registered successfully - ID: 037b6f6a-0b5e-46c9-bd32-fd4bc5b416f2, Key: dest@example.com
2025-10-15 19:20:15,602 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"e7205f6b-e90e-4acd-9550-d68333561c16","correlationId":"e7205f6b-e90e-4acd-9550-d68333561c16","event":"performance_metric","operation":"WalletUseCase.registerPixKey","durationMs":2,"transactionId":"TX-1760570415600-1","timestamp":"2025-10-15T19:20:15.602221135"}
2025-10-15 19:20:15,602 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.registerPixKey in 2ms
2025-10-15 19:20:15,602 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415600-1 for WalletUseCase.registerPixKey in 2ms
2025-10-15 19:20:15,602 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,602 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(222197667<open>)]
2025-10-15 19:20:15,602 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        pix_keys
        (created_at, is_active, key_type, key_value, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,602 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(222197667<open>)] after transaction
2025-10-15 19:20:15,602 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,602 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(475341694<open>)] for JPA transaction
2025-10-15 19:20:15,602 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@3f8f80d3]
2025-10-15 19:20:15,602 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415602-1 for PixTransferUseCase.initiateTransfer
2025-10-15 19:20:15,603 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: PixTransferUseCase.initiateTransfer with args: [MULTI-WEBHOOK-77fe4e41-5b05-42f5-8dcf-9395feef9532, 46293309-0992-4cec-8f09-c73cb0544dab, dest@example.com, R$ 75,00]
2025-10-15 19:20:15,603 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Initiating Pix transfer with atomic operations - Idempotency Key: MULTI-WEBHOOK-77fe4e41-5b05-42f5-8dcf-9395feef9532, From: 46293309-0992-4cec-8f09-c73cb0544dab, To: dest@example.com, Amount: R$ 75,00
2025-10-15 19:20:15,603 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(475341694<open>)] for JPA transaction
2025-10-15 19:20:15,603 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,603 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(475341694<open>)] for JPA transaction
2025-10-15 19:20:15,603 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,603 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Finding transfer by idempotencyKey: MULTI-WEBHOOK-77fe4e41-5b05-42f5-8dcf-9395feef9532
2025-10-15 19:20:15,603 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.idempotency_key=?
2025-10-15 19:20:15,603 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - No transfer found for idempotencyKey: MULTI-WEBHOOK-77fe4e41-5b05-42f5-8dcf-9395feef9532
2025-10-15 19:20:15,604 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value,
        pk1_0.wallet_id 
    from
        pix_keys pk1_0 
    where
        pk1_0.key_value=? 
        and pk1_0.is_active=true
2025-10-15 19:20:15,604 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(475341694<open>)] for JPA transaction
2025-10-15 19:20:15,604 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Suspending current transaction, creating new transaction with name [com.finaya.pixwallet.domain.service.AtomicTransferService.createTransferAtomically]
2025-10-15 19:20:15,604 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(855463334<open>)] for JPA transaction
2025-10-15 19:20:15,604 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@70f5a2a1]
2025-10-15 19:20:15,604 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: AtomicTransferService.createTransferAtomically
2025-10-15 19:20:15,604 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415604-1 for AtomicTransferService.createTransferAtomically
2025-10-15 19:20:15,604 [main] INFO  c.f.p.d.s.AtomicTransferService - Starting atomic transfer creation - ID: 4, EndToEnd: E1760570415604f3eaf949593e4e1ea3, From: 46293309-0992-4cec-8f09-c73cb0544dab, Amount: R$ 75,00
2025-10-15 19:20:15,604 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(855463334<open>)] for JPA transaction
2025-10-15 19:20:15,604 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,604 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,605 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(855463334<open>)] for JPA transaction
2025-10-15 19:20:15,605 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,605 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(855463334<open>)] for JPA transaction
2025-10-15 19:20:15,605 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,605 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: 46293309-0992-4cec-8f09-c73cb0544dab - Balance: R$ 925,00, Version: 1
2025-10-15 19:20:15,605 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 46293309-0992-4cec-8f09-c73cb0544dab - New Version: 1
2025-10-15 19:20:15,605 [main] DEBUG c.f.p.d.s.AtomicTransferService - Wallet debited atomically - ID: 46293309-0992-4cec-8f09-c73cb0544dab, Amount: R$ 75,00, NewBalance: R$ 925,00
2025-10-15 19:20:15,605 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(855463334<open>)] for JPA transaction
2025-10-15 19:20:15,605 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,605 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(855463334<open>)] for JPA transaction
2025-10-15 19:20:15,605 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,605 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Saving transfer: E1760570415604f3eaf949593e4e1ea3 - Status: PENDING, Version: null
2025-10-15 19:20:15,605 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Transfer saved successfully: E1760570415604f3eaf949593e4e1ea3 - New Version: 0
2025-10-15 19:20:15,605 [main] INFO  c.f.p.d.s.AtomicTransferService - Atomic transfer created successfully - ID: 4, EndToEnd: E1760570415604f3eaf949593e4e1ea3
2025-10-15 19:20:15,605 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415604-1 for AtomicTransferService.createTransferAtomically in 1ms
2025-10-15 19:20:15,605 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: AtomicTransferService.createTransferAtomically in 1ms
2025-10-15 19:20:15,605 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,605 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(855463334<open>)]
2025-10-15 19:20:15,605 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,606 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        pix_transfers
        (amount_cents, confirmed_at, created_at, end_to_end_id, from_wallet_id, idempotency_key, rejected_at, rejection_reason, status, to_pix_key, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,606 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,606 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(855463334<open>)] after transaction
2025-10-15 19:20:15,606 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Resuming suspended transaction after completion of inner transaction
2025-10-15 19:20:15,606 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Pix transfer initiated atomically - End-to-End ID: E1760570415604f3eaf949593e4e1ea3, Transfer ID: fe8ef021-98df-4c90-afcf-78fcc30cb669
2025-10-15 19:20:15,606 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"aca65d52-7cc0-4193-a015-9148b0380bd9","correlationId":"aca65d52-7cc0-4193-a015-9148b0380bd9","event":"performance_metric","operation":"PixTransferUseCase.initiateTransfer","durationMs":3,"transactionId":"TX-1760570415604-1","timestamp":"2025-10-15T19:20:15.606539303"}
2025-10-15 19:20:15,606 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: PixTransferUseCase.initiateTransfer in 3ms
2025-10-15 19:20:15,606 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415602-1 for PixTransferUseCase.initiateTransfer in 4ms
2025-10-15 19:20:15,606 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,606 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(475341694<open>)]
2025-10-15 19:20:15,606 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(475341694<open>)] after transaction
2025-10-15 19:20:15,606 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.PixTransferUseCase.processWebhookEvent]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,606 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(881292742<open>)] for JPA transaction
2025-10-15 19:20:15,606 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4dfc1455]
2025-10-15 19:20:15,606 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415606-1 for PixTransferUseCase.processWebhookEvent
2025-10-15 19:20:15,606 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: PixTransferUseCase.processWebhookEvent with args: [E1760570415604f3eaf949593e4e1ea3, EVENT-1, CONFIRMED]
2025-10-15 19:20:15,606 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Processing webhook event atomically - End-to-End ID: E1760570415604f3eaf949593e4e1ea3, Event ID: EVENT-1, Event Type: CONFIRMED
2025-10-15 19:20:15,606 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(881292742<open>)] for JPA transaction
2025-10-15 19:20:15,606 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,606 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: IdempotencyService.findExistingRecord
2025-10-15 19:20:15,606 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415606-1 for IdempotencyService.findExistingRecord
2025-10-15 19:20:15,606 [main] DEBUG c.f.p.d.service.IdempotencyService - Looking for existing idempotency record - scope: [REDACTED], key: [REDACTED]
2025-10-15 19:20:15,606 [main] DEBUG c.f.p.d.service.IdempotencyService - Found valid cached idempotency record
2025-10-15 19:20:15,606 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415606-1 for IdempotencyService.findExistingRecord in 0ms
2025-10-15 19:20:15,606 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: IdempotencyService.findExistingRecord in 0ms
2025-10-15 19:20:15,606 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Webhook event already processed atomically - Event ID: EVENT-1
2025-10-15 19:20:15,607 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"24dc117b-4de9-48b8-a652-cacc9eabbf18","correlationId":"24dc117b-4de9-48b8-a652-cacc9eabbf18","event":"performance_metric","operation":"PixTransferUseCase.processWebhookEvent","durationMs":0,"transactionId":"TX-1760570415606-1","timestamp":"2025-10-15T19:20:15.606987851"}
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: PixTransferUseCase.processWebhookEvent in 0ms
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415606-1 for PixTransferUseCase.processWebhookEvent in 1ms
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(881292742<open>)]
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(881292742<open>)] after transaction
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.PixTransferUseCase.processWebhookEvent]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(611828817<open>)] for JPA transaction
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@73cb14ab]
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415607-1 for PixTransferUseCase.processWebhookEvent
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: PixTransferUseCase.processWebhookEvent with args: [E1760570415604f3eaf949593e4e1ea3, EVENT-2, CONFIRMED]
2025-10-15 19:20:15,607 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Processing webhook event atomically - End-to-End ID: E1760570415604f3eaf949593e4e1ea3, Event ID: EVENT-2, Event Type: CONFIRMED
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(611828817<open>)] for JPA transaction
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: IdempotencyService.findExistingRecord
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415607-1 for IdempotencyService.findExistingRecord
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.d.service.IdempotencyService - Looking for existing idempotency record - scope: [REDACTED], key: [REDACTED]
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(611828817<open>)] for JPA transaction
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(611828817<open>)] for JPA transaction
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Finding idempotency record by scope: webhook and key: EVENT-2
2025-10-15 19:20:15,607 [main] DEBUG org.hibernate.SQL - 
    select
        ir1_0.id,
        ir1_0.created_at,
        ir1_0.expires_at,
        ir1_0.idempotency_key,
        ir1_0.request_hash,
        ir1_0.response_body,
        ir1_0.response_status,
        ir1_0.scope 
    from
        idempotency_records ir1_0 
    where
        ir1_0.scope=? 
        and ir1_0.idempotency_key=?
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - No idempotency record found for scope: webhook and key: EVENT-2
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415607-1 for IdempotencyService.findExistingRecord in 0ms
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: IdempotencyService.findExistingRecord in 0ms
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(611828817<open>)] for JPA transaction
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Suspending current transaction, creating new transaction with name [com.finaya.pixwallet.domain.service.AtomicTransferService.updateTransferStateAtomically]
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1263634443<open>)] for JPA transaction
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6014b386]
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: AtomicTransferService.updateTransferStateAtomically
2025-10-15 19:20:15,607 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415607-1 for AtomicTransferService.updateTransferStateAtomically
2025-10-15 19:20:15,607 [main] INFO  c.f.p.d.s.AtomicTransferService - Updating transfer state atomically - EndToEnd: E1760570415604f3eaf949593e4e1ea3, NewStatus: CONFIRMED
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1263634443<open>)] for JPA transaction
2025-10-15 19:20:15,607 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,607 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.end_to_end_id=? for update
2025-10-15 19:20:15,608 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1263634443<open>)] for JPA transaction
2025-10-15 19:20:15,608 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,608 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1263634443<open>)] for JPA transaction
2025-10-15 19:20:15,608 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,608 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Saving transfer: E1760570415604f3eaf949593e4e1ea3 - Status: CONFIRMED, Version: 0
2025-10-15 19:20:15,608 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Transfer saved successfully: E1760570415604f3eaf949593e4e1ea3 - New Version: 0
2025-10-15 19:20:15,608 [main] INFO  c.f.p.d.s.AtomicTransferService - Transfer state updated successfully - EndToEnd: E1760570415604f3eaf949593e4e1ea3, Status: CONFIRMED
2025-10-15 19:20:15,608 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415607-1 for AtomicTransferService.updateTransferStateAtomically in 1ms
2025-10-15 19:20:15,608 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: AtomicTransferService.updateTransferStateAtomically in 1ms
2025-10-15 19:20:15,608 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,608 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1263634443<open>)]
2025-10-15 19:20:15,608 [main] DEBUG org.hibernate.SQL - 
    update
        pix_transfers 
    set
        amount_cents=?,
        confirmed_at=?,
        created_at=?,
        end_to_end_id=?,
        from_wallet_id=?,
        idempotency_key=?,
        rejected_at=?,
        rejection_reason=?,
        status=?,
        to_pix_key=?,
        updated_at=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,608 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1263634443<open>)] after transaction
2025-10-15 19:20:15,608 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Resuming suspended transaction after completion of inner transaction
2025-10-15 19:20:15,608 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(611828817<open>)] for JPA transaction
2025-10-15 19:20:15,608 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,608 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(611828817<open>)] for JPA transaction
2025-10-15 19:20:15,608 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,608 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Finding transfer by endToEndId: E1760570415604f3eaf949593e4e1ea3
2025-10-15 19:20:15,608 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.end_to_end_id=?
2025-10-15 19:20:15,609 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Found transfer for endToEndId: E1760570415604f3eaf949593e4e1ea3 - Status: CONFIRMED
2025-10-15 19:20:15,609 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Handling confirmed event atomically - End-to-End ID: E1760570415604f3eaf949593e4e1ea3
2025-10-15 19:20:15,609 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value,
        pk1_0.wallet_id 
    from
        pix_keys pk1_0 
    where
        pk1_0.key_value=? 
        and pk1_0.is_active=true
2025-10-15 19:20:15,609 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: AtomicTransferService.creditDestinationWalletAtomically
2025-10-15 19:20:15,609 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(611828817<open>)] for JPA transaction
2025-10-15 19:20:15,609 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,609 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,609 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(611828817<open>)] for JPA transaction
2025-10-15 19:20:15,609 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,609 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(611828817<open>)] for JPA transaction
2025-10-15 19:20:15,609 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,609 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: e93eeb59-2d57-4e2a-b97e-e002f8bc592f - Balance: R$ 75,00, Version: 0
2025-10-15 19:20:15,610 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: e93eeb59-2d57-4e2a-b97e-e002f8bc592f - New Version: 0
2025-10-15 19:20:15,610 [main] DEBUG c.f.p.d.s.AtomicTransferService - Wallet credited atomically - ID: e93eeb59-2d57-4e2a-b97e-e002f8bc592f, Amount: R$ 75,00, NewBalance: R$ 75,00
2025-10-15 19:20:15,610 [main] INFO  c.f.p.d.s.AtomicTransferService - Destination wallet credited atomically - Wallet: e93eeb59-2d57-4e2a-b97e-e002f8bc592f, Amount: R$ 75,00
2025-10-15 19:20:15,610 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: AtomicTransferService.creditDestinationWalletAtomically in 1ms
2025-10-15 19:20:15,610 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Transfer confirmed and credited atomically - End-to-End ID: E1760570415604f3eaf949593e4e1ea3, Destination Wallet: e93eeb59-2d57-4e2a-b97e-e002f8bc592f
2025-10-15 19:20:15,610 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(611828817<open>)] for JPA transaction
2025-10-15 19:20:15,610 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Suspending current transaction, creating new transaction with name [com.finaya.pixwallet.domain.service.IdempotencyService.saveRecordAtomically]
2025-10-15 19:20:15,610 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1140490945<open>)] for JPA transaction
2025-10-15 19:20:15,610 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4a6e6db0]
2025-10-15 19:20:15,610 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: IdempotencyService.saveRecordAtomically
2025-10-15 19:20:15,610 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415610-1 for IdempotencyService.saveRecordAtomically
2025-10-15 19:20:15,610 [main] DEBUG c.f.p.d.service.IdempotencyService - Saving idempotency record atomically - scope: webhook, key: EVENT-2, status: 200
2025-10-15 19:20:15,610 [main] DEBUG c.f.p.d.service.IdempotencyService - Looking for existing idempotency record - scope: [REDACTED], key: [REDACTED]
2025-10-15 19:20:15,611 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1140490945<open>)] for JPA transaction
2025-10-15 19:20:15,611 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,611 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1140490945<open>)] for JPA transaction
2025-10-15 19:20:15,611 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,611 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Finding idempotency record by scope: webhook and key: EVENT-2
2025-10-15 19:20:15,611 [main] DEBUG org.hibernate.SQL - 
    select
        ir1_0.id,
        ir1_0.created_at,
        ir1_0.expires_at,
        ir1_0.idempotency_key,
        ir1_0.request_hash,
        ir1_0.response_body,
        ir1_0.response_status,
        ir1_0.scope 
    from
        idempotency_records ir1_0 
    where
        ir1_0.scope=? 
        and ir1_0.idempotency_key=?
2025-10-15 19:20:15,611 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - No idempotency record found for scope: webhook and key: EVENT-2
2025-10-15 19:20:15,611 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1140490945<open>)] for JPA transaction
2025-10-15 19:20:15,611 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,611 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1140490945<open>)] for JPA transaction
2025-10-15 19:20:15,611 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,611 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Saving idempotency record: scope=webhook, key=EVENT-2, status=200
2025-10-15 19:20:15,611 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Idempotency record saved successfully: scope=webhook, key=EVENT-2
2025-10-15 19:20:15,611 [main] DEBUG c.f.p.d.service.IdempotencyService - Idempotency record saved successfully - scope: webhook, key: EVENT-2
2025-10-15 19:20:15,611 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415610-1 for IdempotencyService.saveRecordAtomically in 1ms
2025-10-15 19:20:15,611 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: IdempotencyService.saveRecordAtomically in 1ms
2025-10-15 19:20:15,611 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,611 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1140490945<open>)]
2025-10-15 19:20:15,611 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        idempotency_records
        (created_at, expires_at, idempotency_key, request_hash, response_body, response_status, scope, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,611 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1140490945<open>)] after transaction
2025-10-15 19:20:15,611 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Resuming suspended transaction after completion of inner transaction
2025-10-15 19:20:15,612 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Webhook event processed atomically - Event #41, End-to-End ID: E1760570415604f3eaf949593e4e1ea3, Event ID: EVENT-2, Status: CONFIRMED
2025-10-15 19:20:15,612 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"cfd2f05e-55e1-4292-8d58-0701c1bb805b","correlationId":"cfd2f05e-55e1-4292-8d58-0701c1bb805b","event":"performance_metric","operation":"PixTransferUseCase.processWebhookEvent","durationMs":5,"transactionId":"TX-1760570415610-1","timestamp":"2025-10-15T19:20:15.612029026"}
2025-10-15 19:20:15,612 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: PixTransferUseCase.processWebhookEvent in 5ms
2025-10-15 19:20:15,612 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415607-1 for PixTransferUseCase.processWebhookEvent in 5ms
2025-10-15 19:20:15,612 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,612 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(611828817<open>)]
2025-10-15 19:20:15,612 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,612 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,612 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(611828817<open>)] after transaction
2025-10-15 19:20:15,612 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.PixTransferUseCase.processWebhookEvent]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,612 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1135268579<open>)] for JPA transaction
2025-10-15 19:20:15,612 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1bd6c0de]
2025-10-15 19:20:15,612 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415612-1 for PixTransferUseCase.processWebhookEvent
2025-10-15 19:20:15,612 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: PixTransferUseCase.processWebhookEvent with args: [E1760570415604f3eaf949593e4e1ea3, EVENT-3, CONFIRMED]
2025-10-15 19:20:15,612 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Processing webhook event atomically - End-to-End ID: E1760570415604f3eaf949593e4e1ea3, Event ID: EVENT-3, Event Type: CONFIRMED
2025-10-15 19:20:15,612 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1135268579<open>)] for JPA transaction
2025-10-15 19:20:15,612 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,612 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: IdempotencyService.findExistingRecord
2025-10-15 19:20:15,612 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415612-1 for IdempotencyService.findExistingRecord
2025-10-15 19:20:15,612 [main] DEBUG c.f.p.d.service.IdempotencyService - Looking for existing idempotency record - scope: [REDACTED], key: [REDACTED]
2025-10-15 19:20:15,612 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1135268579<open>)] for JPA transaction
2025-10-15 19:20:15,612 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,612 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1135268579<open>)] for JPA transaction
2025-10-15 19:20:15,612 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,612 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Finding idempotency record by scope: webhook and key: EVENT-3
2025-10-15 19:20:15,613 [main] DEBUG org.hibernate.SQL - 
    select
        ir1_0.id,
        ir1_0.created_at,
        ir1_0.expires_at,
        ir1_0.idempotency_key,
        ir1_0.request_hash,
        ir1_0.response_body,
        ir1_0.response_status,
        ir1_0.scope 
    from
        idempotency_records ir1_0 
    where
        ir1_0.scope=? 
        and ir1_0.idempotency_key=?
2025-10-15 19:20:15,613 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - No idempotency record found for scope: webhook and key: EVENT-3
2025-10-15 19:20:15,613 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415612-1 for IdempotencyService.findExistingRecord in 1ms
2025-10-15 19:20:15,613 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: IdempotencyService.findExistingRecord in 1ms
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1135268579<open>)] for JPA transaction
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Suspending current transaction, creating new transaction with name [com.finaya.pixwallet.domain.service.AtomicTransferService.updateTransferStateAtomically]
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1908643182<open>)] for JPA transaction
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5cbe7bb8]
2025-10-15 19:20:15,613 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: AtomicTransferService.updateTransferStateAtomically
2025-10-15 19:20:15,613 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415613-1 for AtomicTransferService.updateTransferStateAtomically
2025-10-15 19:20:15,613 [main] INFO  c.f.p.d.s.AtomicTransferService - Updating transfer state atomically - EndToEnd: E1760570415604f3eaf949593e4e1ea3, NewStatus: CONFIRMED
2025-10-15 19:20:15,613 [main] WARN  c.f.p.d.s.AtomicTransferService - Invalid state transition - EndToEnd: E1760570415604f3eaf949593e4e1ea3, From: CONFIRMED, To: CONFIRMED
2025-10-15 19:20:15,613 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415613-1 for AtomicTransferService.updateTransferStateAtomically in 0ms
2025-10-15 19:20:15,613 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: AtomicTransferService.updateTransferStateAtomically in 0ms
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1908643182<open>)]
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1908643182<open>)] after transaction
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Resuming suspended transaction after completion of inner transaction
2025-10-15 19:20:15,613 [main] WARN  c.f.p.a.usecase.PixTransferUseCase - Failed to update transfer state atomically - End-to-End ID: E1760570415604f3eaf949593e4e1ea3, Target Status: CONFIRMED
2025-10-15 19:20:15,613 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"965e4465-50be-41a7-9cf2-693f20b4e41c","correlationId":"965e4465-50be-41a7-9cf2-693f20b4e41c","event":"performance_metric","operation":"PixTransferUseCase.processWebhookEvent","durationMs":1,"transactionId":"TX-1760570415613-1","timestamp":"2025-10-15T19:20:15.613398256"}
2025-10-15 19:20:15,613 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: PixTransferUseCase.processWebhookEvent in 1ms
2025-10-15 19:20:15,613 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415612-1 for PixTransferUseCase.processWebhookEvent in 1ms
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1135268579<open>)]
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1135268579<open>)] after transaction
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1882021493<open>)] for JPA transaction
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4f8f7314]
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1882021493<open>)] for JPA transaction
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,613 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: e93eeb59-2d57-4e2a-b97e-e002f8bc592f
2025-10-15 19:20:15,613 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,613 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: e93eeb59-2d57-4e2a-b97e-e002f8bc592f - Balance: R$ 75,00
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1882021493<open>)]
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1882021493<open>)] after transaction
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findByEndToEndId]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1791371414<open>)] for JPA transaction
2025-10-15 19:20:15,613 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6dd30df3]
2025-10-15 19:20:15,614 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1791371414<open>)] for JPA transaction
2025-10-15 19:20:15,614 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,614 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Finding transfer by endToEndId: E1760570415604f3eaf949593e4e1ea3
2025-10-15 19:20:15,614 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.end_to_end_id=?
2025-10-15 19:20:15,614 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Found transfer for endToEndId: E1760570415604f3eaf949593e4e1ea3 - Status: CONFIRMED
2025-10-15 19:20:15,614 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,614 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1791371414<open>)]
2025-10-15 19:20:15,614 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1791371414<open>)] after transaction
2025-10-15 19:20:15,616 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,616 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(331561490<open>)] for JPA transaction
2025-10-15 19:20:15,616 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@25ae5f6b]
2025-10-15 19:20:15,616 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(331561490<open>)] for JPA transaction
2025-10-15 19:20:15,616 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,616 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415616-1 for PixTransferRepositoryImpl.deleteAll
2025-10-15 19:20:15,617 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0
2025-10-15 19:20:15,617 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415616-1 for PixTransferRepositoryImpl.deleteAll in 1ms
2025-10-15 19:20:15,617 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,617 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(331561490<open>)]
2025-10-15 19:20:15,617 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        pix_transfers 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,617 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(331561490<open>)] after transaction
2025-10-15 19:20:15,617 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,617 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(490324942<open>)] for JPA transaction
2025-10-15 19:20:15,617 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4d2f5474]
2025-10-15 19:20:15,617 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(490324942<open>)] for JPA transaction
2025-10-15 19:20:15,617 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,617 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - Deleting all wallets - this operation should only be used in tests
2025-10-15 19:20:15,618 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0
2025-10-15 19:20:15,618 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Deleting wallet: 46293309-0992-4cec-8f09-c73cb0544dab
2025-10-15 19:20:15,618 [main] DEBUG org.hibernate.SQL - 
    select
        le1_0.wallet_id,
        le1_0.id,
        le1_0.amount_centavos,
        le1_0.balance_after_centavos,
        le1_0.created_at,
        le1_0.description,
        le1_0.entry_type,
        le1_0.transaction_id 
    from
        ledger_entries le1_0 
    where
        le1_0.wallet_id=?
2025-10-15 19:20:15,619 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.wallet_id,
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value 
    from
        pix_keys pk1_0 
    where
        pk1_0.wallet_id=?
2025-10-15 19:20:15,619 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Wallet deleted: 46293309-0992-4cec-8f09-c73cb0544dab
2025-10-15 19:20:15,619 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Deleting wallet: e93eeb59-2d57-4e2a-b97e-e002f8bc592f
2025-10-15 19:20:15,619 [main] DEBUG org.hibernate.SQL - 
    select
        le1_0.wallet_id,
        le1_0.id,
        le1_0.amount_centavos,
        le1_0.balance_after_centavos,
        le1_0.created_at,
        le1_0.description,
        le1_0.entry_type,
        le1_0.transaction_id 
    from
        ledger_entries le1_0 
    where
        le1_0.wallet_id=?
2025-10-15 19:20:15,619 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.wallet_id,
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value 
    from
        pix_keys pk1_0 
    where
        pk1_0.wallet_id=?
2025-10-15 19:20:15,619 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Wallet deleted: e93eeb59-2d57-4e2a-b97e-e002f8bc592f
2025-10-15 19:20:15,619 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - All wallets deleted
2025-10-15 19:20:15,619 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,619 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(490324942<open>)]
2025-10-15 19:20:15,619 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        ledger_entries 
    where
        id=?
2025-10-15 19:20:15,619 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        ledger_entries 
    where
        id=?
2025-10-15 19:20:15,620 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        wallets 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,620 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        ledger_entries 
    where
        id=?
2025-10-15 19:20:15,620 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        pix_keys 
    where
        id=?
2025-10-15 19:20:15,620 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        wallets 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,620 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(490324942<open>)] after transaction
2025-10-15 19:20:15,620 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.createWallet]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,620 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1427085336<open>)] for JPA transaction
2025-10-15 19:20:15,620 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@39626e48]
2025-10-15 19:20:15,620 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415620-1 for WalletUseCase.createWallet
2025-10-15 19:20:15,620 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.createWallet with args: [source-user]
2025-10-15 19:20:15,620 [main] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #29 for user: source-user
2025-10-15 19:20:15,620 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1427085336<open>)] for JPA transaction
2025-10-15 19:20:15,620 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,620 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1427085336<open>)] for JPA transaction
2025-10-15 19:20:15,620 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,620 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Checking if wallet exists for userId: source-user
2025-10-15 19:20:15,620 [main] DEBUG org.hibernate.SQL - 
    select
        count(w1_0.id) 
    from
        wallets w1_0 
    where
        w1_0.user_id=?
2025-10-15 19:20:15,620 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet exists for userId: source-user - false
2025-10-15 19:20:15,620 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1427085336<open>)] for JPA transaction
2025-10-15 19:20:15,620 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,620 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1427085336<open>)] for JPA transaction
2025-10-15 19:20:15,620 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,620 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,621 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: b36cc3d4-f640-4d12-8a48-5962f527db83 - New Version: 0
2025-10-15 19:20:15,621 [main] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #29 created successfully - ID: b36cc3d4-f640-4d12-8a48-5962f527db83, User: source-user
2025-10-15 19:20:15,621 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"58141530-9fc6-4727-b20d-eb33c51ee572","correlationId":"58141530-9fc6-4727-b20d-eb33c51ee572","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":1,"transactionId":"TX-1760570415620-1","timestamp":"2025-10-15T19:20:15.621122065"}
2025-10-15 19:20:15,621 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.createWallet in 1ms
2025-10-15 19:20:15,621 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415620-1 for WalletUseCase.createWallet in 1ms
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1427085336<open>)]
2025-10-15 19:20:15,621 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1427085336<open>)] after transaction
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.createWallet]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1956241210<open>)] for JPA transaction
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@3f559822]
2025-10-15 19:20:15,621 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415621-1 for WalletUseCase.createWallet
2025-10-15 19:20:15,621 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.createWallet with args: [dest-user]
2025-10-15 19:20:15,621 [main] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #30 for user: dest-user
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1956241210<open>)] for JPA transaction
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1956241210<open>)] for JPA transaction
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,621 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Checking if wallet exists for userId: dest-user
2025-10-15 19:20:15,621 [main] DEBUG org.hibernate.SQL - 
    select
        count(w1_0.id) 
    from
        wallets w1_0 
    where
        w1_0.user_id=?
2025-10-15 19:20:15,621 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet exists for userId: dest-user - false
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1956241210<open>)] for JPA transaction
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1956241210<open>)] for JPA transaction
2025-10-15 19:20:15,621 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,621 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,621 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: ea12e96e-9b0c-486c-8b9b-bd11fd07917c - New Version: 0
2025-10-15 19:20:15,621 [main] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #30 created successfully - ID: ea12e96e-9b0c-486c-8b9b-bd11fd07917c, User: dest-user
2025-10-15 19:20:15,622 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"fb7ec0a9-45e2-426a-b4e0-cbc406748921","correlationId":"fb7ec0a9-45e2-426a-b4e0-cbc406748921","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":0,"transactionId":"TX-1760570415621-1","timestamp":"2025-10-15T19:20:15.621992402"}
2025-10-15 19:20:15,622 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.createWallet in 0ms
2025-10-15 19:20:15,622 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415621-1 for WalletUseCase.createWallet in 1ms
2025-10-15 19:20:15,622 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,622 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1956241210<open>)]
2025-10-15 19:20:15,622 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,622 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1956241210<open>)] after transaction
2025-10-15 19:20:15,622 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.deposit]: PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE
2025-10-15 19:20:15,622 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(248287314<open>)] for JPA transaction
2025-10-15 19:20:15,622 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@63c10f2d]
2025-10-15 19:20:15,622 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415622-1 for WalletUseCase.deposit
2025-10-15 19:20:15,622 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.deposit with args: [b36cc3d4-f640-4d12-8a48-5962f527db83, R$ 1.000,00, Initial deposit]
2025-10-15 19:20:15,622 [main] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic deposit #263 - Wallet: b36cc3d4-f640-4d12-8a48-5962f527db83, Amount: R$ 1.000,00, Description: Initial deposit
2025-10-15 19:20:15,622 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(248287314<open>)] for JPA transaction
2025-10-15 19:20:15,622 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,622 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,622 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(248287314<open>)] for JPA transaction
2025-10-15 19:20:15,622 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,622 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(248287314<open>)] for JPA transaction
2025-10-15 19:20:15,622 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,622 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: b36cc3d4-f640-4d12-8a48-5962f527db83 - Balance: R$ 1.000,00, Version: 0
2025-10-15 19:20:15,623 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: b36cc3d4-f640-4d12-8a48-5962f527db83 - New Version: 0
2025-10-15 19:20:15,623 [main] INFO  c.f.p.a.usecase.WalletUseCase - Atomic deposit processed successfully - Deposit #263, Wallet: b36cc3d4-f640-4d12-8a48-5962f527db83, Amount: R$ 1.000,00, Balance: R$ 0,00 -> R$ 1.000,00
2025-10-15 19:20:15,623 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"7cd56040-437f-4aab-b01d-7acb1d2df300","correlationId":"7cd56040-437f-4aab-b01d-7acb1d2df300","event":"performance_metric","operation":"WalletUseCase.deposit","durationMs":1,"transactionId":"TX-1760570415622-1","timestamp":"2025-10-15T19:20:15.623128941"}
2025-10-15 19:20:15,623 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.deposit in 1ms
2025-10-15 19:20:15,623 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415622-1 for WalletUseCase.deposit in 1ms
2025-10-15 19:20:15,623 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,623 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(248287314<open>)]
2025-10-15 19:20:15,623 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,623 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,623 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(248287314<open>)] after transaction
2025-10-15 19:20:15,623 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.registerPixKey]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,623 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1818272065<open>)] for JPA transaction
2025-10-15 19:20:15,623 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4727acf9]
2025-10-15 19:20:15,623 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415623-1 for WalletUseCase.registerPixKey
2025-10-15 19:20:15,623 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.registerPixKey with args: [ea12e96e-9b0c-486c-8b9b-bd11fd07917c, dest@example.com, EMAIL]
2025-10-15 19:20:15,623 [main] INFO  c.f.p.a.usecase.WalletUseCase - Registering Pix key #10 for wallet: ea12e96e-9b0c-486c-8b9b-bd11fd07917c - Key: dest@example.com, Type: EMAIL
2025-10-15 19:20:15,624 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.id 
    from
        pix_keys pk1_0 
    where
        pk1_0.key_value=? 
        and pk1_0.key_type=? 
        and pk1_0.is_active=? 
    fetch
        first ? rows only
2025-10-15 19:20:15,624 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1818272065<open>)] for JPA transaction
2025-10-15 19:20:15,624 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,624 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1818272065<open>)] for JPA transaction
2025-10-15 19:20:15,624 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,624 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: ea12e96e-9b0c-486c-8b9b-bd11fd07917c
2025-10-15 19:20:15,624 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,625 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: ea12e96e-9b0c-486c-8b9b-bd11fd07917c - Balance: R$ 0,00
2025-10-15 19:20:15,625 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1818272065<open>)] for JPA transaction
2025-10-15 19:20:15,625 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,625 [main] INFO  c.f.p.a.usecase.WalletUseCase - Pix key #10 registered successfully - ID: 9d822c46-5b46-4995-8d24-66a03713372c, Key: dest@example.com
2025-10-15 19:20:15,625 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"50a90919-6c90-4927-ad24-758c11255c21","correlationId":"50a90919-6c90-4927-ad24-758c11255c21","event":"performance_metric","operation":"WalletUseCase.registerPixKey","durationMs":2,"transactionId":"TX-1760570415623-1","timestamp":"2025-10-15T19:20:15.625374188"}
2025-10-15 19:20:15,625 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.registerPixKey in 2ms
2025-10-15 19:20:15,625 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415623-1 for WalletUseCase.registerPixKey in 2ms
2025-10-15 19:20:15,625 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,625 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1818272065<open>)]
2025-10-15 19:20:15,625 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        pix_keys
        (created_at, is_active, key_type, key_value, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,625 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1818272065<open>)] after transaction
2025-10-15 19:20:15,626 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,626 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(484886039<open>)] for JPA transaction
2025-10-15 19:20:15,626 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@320d4122]
2025-10-15 19:20:15,626 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415626-1 for PixTransferUseCase.initiateTransfer
2025-10-15 19:20:15,626 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: PixTransferUseCase.initiateTransfer with args: [OUT-OF-ORDER-4a4e3eb2-7b6f-4745-9879-17e77955735e, b36cc3d4-f640-4d12-8a48-5962f527db83, dest@example.com, R$ 25,00]
2025-10-15 19:20:15,626 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Initiating Pix transfer with atomic operations - Idempotency Key: OUT-OF-ORDER-4a4e3eb2-7b6f-4745-9879-17e77955735e, From: b36cc3d4-f640-4d12-8a48-5962f527db83, To: dest@example.com, Amount: R$ 25,00
2025-10-15 19:20:15,626 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(484886039<open>)] for JPA transaction
2025-10-15 19:20:15,626 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,626 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(484886039<open>)] for JPA transaction
2025-10-15 19:20:15,626 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,626 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Finding transfer by idempotencyKey: OUT-OF-ORDER-4a4e3eb2-7b6f-4745-9879-17e77955735e
2025-10-15 19:20:15,626 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.idempotency_key=?
2025-10-15 19:20:15,626 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - No transfer found for idempotencyKey: OUT-OF-ORDER-4a4e3eb2-7b6f-4745-9879-17e77955735e
2025-10-15 19:20:15,626 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value,
        pk1_0.wallet_id 
    from
        pix_keys pk1_0 
    where
        pk1_0.key_value=? 
        and pk1_0.is_active=true
2025-10-15 19:20:15,627 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(484886039<open>)] for JPA transaction
2025-10-15 19:20:15,627 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Suspending current transaction, creating new transaction with name [com.finaya.pixwallet.domain.service.AtomicTransferService.createTransferAtomically]
2025-10-15 19:20:15,627 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(2063469051<open>)] for JPA transaction
2025-10-15 19:20:15,627 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@26308d2a]
2025-10-15 19:20:15,627 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: AtomicTransferService.createTransferAtomically
2025-10-15 19:20:15,627 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415627-1 for AtomicTransferService.createTransferAtomically
2025-10-15 19:20:15,627 [main] INFO  c.f.p.d.s.AtomicTransferService - Starting atomic transfer creation - ID: 5, EndToEnd: E1760570415627ec6529e96f2e40e79d, From: b36cc3d4-f640-4d12-8a48-5962f527db83, Amount: R$ 25,00
2025-10-15 19:20:15,627 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2063469051<open>)] for JPA transaction
2025-10-15 19:20:15,627 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,627 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,627 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2063469051<open>)] for JPA transaction
2025-10-15 19:20:15,627 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,627 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2063469051<open>)] for JPA transaction
2025-10-15 19:20:15,627 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,627 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: b36cc3d4-f640-4d12-8a48-5962f527db83 - Balance: R$ 975,00, Version: 1
2025-10-15 19:20:15,628 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: b36cc3d4-f640-4d12-8a48-5962f527db83 - New Version: 1
2025-10-15 19:20:15,628 [main] DEBUG c.f.p.d.s.AtomicTransferService - Wallet debited atomically - ID: b36cc3d4-f640-4d12-8a48-5962f527db83, Amount: R$ 25,00, NewBalance: R$ 975,00
2025-10-15 19:20:15,628 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2063469051<open>)] for JPA transaction
2025-10-15 19:20:15,628 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,628 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2063469051<open>)] for JPA transaction
2025-10-15 19:20:15,628 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,628 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Saving transfer: E1760570415627ec6529e96f2e40e79d - Status: PENDING, Version: null
2025-10-15 19:20:15,628 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Transfer saved successfully: E1760570415627ec6529e96f2e40e79d - New Version: 0
2025-10-15 19:20:15,628 [main] INFO  c.f.p.d.s.AtomicTransferService - Atomic transfer created successfully - ID: 5, EndToEnd: E1760570415627ec6529e96f2e40e79d
2025-10-15 19:20:15,628 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415627-1 for AtomicTransferService.createTransferAtomically in 1ms
2025-10-15 19:20:15,628 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: AtomicTransferService.createTransferAtomically in 1ms
2025-10-15 19:20:15,628 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,628 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(2063469051<open>)]
2025-10-15 19:20:15,628 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,628 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        pix_transfers
        (amount_cents, confirmed_at, created_at, end_to_end_id, from_wallet_id, idempotency_key, rejected_at, rejection_reason, status, to_pix_key, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,628 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(2063469051<open>)] after transaction
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Resuming suspended transaction after completion of inner transaction
2025-10-15 19:20:15,629 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Pix transfer initiated atomically - End-to-End ID: E1760570415627ec6529e96f2e40e79d, Transfer ID: 719e6366-933a-45ff-aed5-d03d09c69cbb
2025-10-15 19:20:15,629 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"a373ee5d-0f41-4401-8af1-7cd4b7cefb2c","correlationId":"a373ee5d-0f41-4401-8af1-7cd4b7cefb2c","event":"performance_metric","operation":"PixTransferUseCase.initiateTransfer","durationMs":3,"transactionId":"TX-1760570415627-1","timestamp":"2025-10-15T19:20:15.629217517"}
2025-10-15 19:20:15,629 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: PixTransferUseCase.initiateTransfer in 3ms
2025-10-15 19:20:15,629 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415626-1 for PixTransferUseCase.initiateTransfer in 3ms
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(484886039<open>)]
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(484886039<open>)] after transaction
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.PixTransferUseCase.processWebhookEvent]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(908585290<open>)] for JPA transaction
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4a7f5550]
2025-10-15 19:20:15,629 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415629-1 for PixTransferUseCase.processWebhookEvent
2025-10-15 19:20:15,629 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: PixTransferUseCase.processWebhookEvent with args: [E1760570415627ec6529e96f2e40e79d, REJECTED-EVENT, REJECTED]
2025-10-15 19:20:15,629 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Processing webhook event atomically - End-to-End ID: E1760570415627ec6529e96f2e40e79d, Event ID: REJECTED-EVENT, Event Type: REJECTED
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(908585290<open>)] for JPA transaction
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,629 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: IdempotencyService.findExistingRecord
2025-10-15 19:20:15,629 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415629-1 for IdempotencyService.findExistingRecord
2025-10-15 19:20:15,629 [main] DEBUG c.f.p.d.service.IdempotencyService - Looking for existing idempotency record - scope: [REDACTED], key: [REDACTED]
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(908585290<open>)] for JPA transaction
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(908585290<open>)] for JPA transaction
2025-10-15 19:20:15,629 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,629 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Finding idempotency record by scope: webhook and key: REJECTED-EVENT
2025-10-15 19:20:15,629 [main] DEBUG org.hibernate.SQL - 
    select
        ir1_0.id,
        ir1_0.created_at,
        ir1_0.expires_at,
        ir1_0.idempotency_key,
        ir1_0.request_hash,
        ir1_0.response_body,
        ir1_0.response_status,
        ir1_0.scope 
    from
        idempotency_records ir1_0 
    where
        ir1_0.scope=? 
        and ir1_0.idempotency_key=?
2025-10-15 19:20:15,630 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - No idempotency record found for scope: webhook and key: REJECTED-EVENT
2025-10-15 19:20:15,630 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415629-1 for IdempotencyService.findExistingRecord in 1ms
2025-10-15 19:20:15,630 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: IdempotencyService.findExistingRecord in 1ms
2025-10-15 19:20:15,630 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(908585290<open>)] for JPA transaction
2025-10-15 19:20:15,630 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Suspending current transaction, creating new transaction with name [com.finaya.pixwallet.domain.service.AtomicTransferService.updateTransferStateAtomically]
2025-10-15 19:20:15,630 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1294905285<open>)] for JPA transaction
2025-10-15 19:20:15,630 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7dcbb6e5]
2025-10-15 19:20:15,630 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: AtomicTransferService.updateTransferStateAtomically
2025-10-15 19:20:15,630 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415630-1 for AtomicTransferService.updateTransferStateAtomically
2025-10-15 19:20:15,630 [main] INFO  c.f.p.d.s.AtomicTransferService - Updating transfer state atomically - EndToEnd: E1760570415627ec6529e96f2e40e79d, NewStatus: REJECTED
2025-10-15 19:20:15,630 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1294905285<open>)] for JPA transaction
2025-10-15 19:20:15,630 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,630 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.end_to_end_id=? for update
2025-10-15 19:20:15,630 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1294905285<open>)] for JPA transaction
2025-10-15 19:20:15,630 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,630 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1294905285<open>)] for JPA transaction
2025-10-15 19:20:15,630 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,630 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Saving transfer: E1760570415627ec6529e96f2e40e79d - Status: REJECTED, Version: 0
2025-10-15 19:20:15,630 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Transfer saved successfully: E1760570415627ec6529e96f2e40e79d - New Version: 0
2025-10-15 19:20:15,630 [main] INFO  c.f.p.d.s.AtomicTransferService - Transfer state updated successfully - EndToEnd: E1760570415627ec6529e96f2e40e79d, Status: REJECTED
2025-10-15 19:20:15,630 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415630-1 for AtomicTransferService.updateTransferStateAtomically in 0ms
2025-10-15 19:20:15,630 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: AtomicTransferService.updateTransferStateAtomically in 0ms
2025-10-15 19:20:15,630 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,630 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1294905285<open>)]
2025-10-15 19:20:15,631 [main] DEBUG org.hibernate.SQL - 
    update
        pix_transfers 
    set
        amount_cents=?,
        confirmed_at=?,
        created_at=?,
        end_to_end_id=?,
        from_wallet_id=?,
        idempotency_key=?,
        rejected_at=?,
        rejection_reason=?,
        status=?,
        to_pix_key=?,
        updated_at=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,631 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1294905285<open>)] after transaction
2025-10-15 19:20:15,631 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Resuming suspended transaction after completion of inner transaction
2025-10-15 19:20:15,631 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(908585290<open>)] for JPA transaction
2025-10-15 19:20:15,631 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,631 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(908585290<open>)] for JPA transaction
2025-10-15 19:20:15,631 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,631 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Finding transfer by endToEndId: E1760570415627ec6529e96f2e40e79d
2025-10-15 19:20:15,631 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.end_to_end_id=?
2025-10-15 19:20:15,631 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Found transfer for endToEndId: E1760570415627ec6529e96f2e40e79d - Status: REJECTED
2025-10-15 19:20:15,631 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Handling rejected event atomically - End-to-End ID: E1760570415627ec6529e96f2e40e79d
2025-10-15 19:20:15,631 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: AtomicTransferService.refundSourceWalletAtomically
2025-10-15 19:20:15,631 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(908585290<open>)] for JPA transaction
2025-10-15 19:20:15,631 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,632 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,632 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(908585290<open>)] for JPA transaction
2025-10-15 19:20:15,632 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,632 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(908585290<open>)] for JPA transaction
2025-10-15 19:20:15,632 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,632 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: b36cc3d4-f640-4d12-8a48-5962f527db83 - Balance: R$ 1.000,00, Version: 2
2025-10-15 19:20:15,632 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: b36cc3d4-f640-4d12-8a48-5962f527db83 - New Version: 2
2025-10-15 19:20:15,632 [main] DEBUG c.f.p.d.s.AtomicTransferService - Wallet credited atomically - ID: b36cc3d4-f640-4d12-8a48-5962f527db83, Amount: R$ 25,00, NewBalance: R$ 1.000,00
2025-10-15 19:20:15,632 [main] INFO  c.f.p.d.s.AtomicTransferService - Refund processed atomically - Wallet: b36cc3d4-f640-4d12-8a48-5962f527db83, Amount: R$ 25,00
2025-10-15 19:20:15,632 [main] INFO  c.f.p.d.s.AtomicTransferService - Source wallet refunded atomically - Wallet: b36cc3d4-f640-4d12-8a48-5962f527db83, Amount: R$ 25,00
2025-10-15 19:20:15,632 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: AtomicTransferService.refundSourceWalletAtomically in 1ms
2025-10-15 19:20:15,632 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Transfer rejected and refunded atomically - End-to-End ID: E1760570415627ec6529e96f2e40e79d, Source Wallet: b36cc3d4-f640-4d12-8a48-5962f527db83
2025-10-15 19:20:15,632 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(908585290<open>)] for JPA transaction
2025-10-15 19:20:15,632 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Suspending current transaction, creating new transaction with name [com.finaya.pixwallet.domain.service.IdempotencyService.saveRecordAtomically]
2025-10-15 19:20:15,632 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(2018306763<open>)] for JPA transaction
2025-10-15 19:20:15,632 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@17a2d74c]
2025-10-15 19:20:15,632 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: IdempotencyService.saveRecordAtomically
2025-10-15 19:20:15,632 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415632-1 for IdempotencyService.saveRecordAtomically
2025-10-15 19:20:15,632 [main] DEBUG c.f.p.d.service.IdempotencyService - Saving idempotency record atomically - scope: webhook, key: REJECTED-EVENT, status: 200
2025-10-15 19:20:15,632 [main] DEBUG c.f.p.d.service.IdempotencyService - Looking for existing idempotency record - scope: [REDACTED], key: [REDACTED]
2025-10-15 19:20:15,632 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2018306763<open>)] for JPA transaction
2025-10-15 19:20:15,632 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,632 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2018306763<open>)] for JPA transaction
2025-10-15 19:20:15,632 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,632 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Finding idempotency record by scope: webhook and key: REJECTED-EVENT
2025-10-15 19:20:15,632 [main] DEBUG org.hibernate.SQL - 
    select
        ir1_0.id,
        ir1_0.created_at,
        ir1_0.expires_at,
        ir1_0.idempotency_key,
        ir1_0.request_hash,
        ir1_0.response_body,
        ir1_0.response_status,
        ir1_0.scope 
    from
        idempotency_records ir1_0 
    where
        ir1_0.scope=? 
        and ir1_0.idempotency_key=?
2025-10-15 19:20:15,633 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - No idempotency record found for scope: webhook and key: REJECTED-EVENT
2025-10-15 19:20:15,633 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2018306763<open>)] for JPA transaction
2025-10-15 19:20:15,633 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,633 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2018306763<open>)] for JPA transaction
2025-10-15 19:20:15,633 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,633 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Saving idempotency record: scope=webhook, key=REJECTED-EVENT, status=200
2025-10-15 19:20:15,633 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Idempotency record saved successfully: scope=webhook, key=REJECTED-EVENT
2025-10-15 19:20:15,633 [main] DEBUG c.f.p.d.service.IdempotencyService - Idempotency record saved successfully - scope: webhook, key: REJECTED-EVENT
2025-10-15 19:20:15,633 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415632-1 for IdempotencyService.saveRecordAtomically in 1ms
2025-10-15 19:20:15,633 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: IdempotencyService.saveRecordAtomically in 1ms
2025-10-15 19:20:15,633 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,633 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(2018306763<open>)]
2025-10-15 19:20:15,633 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        idempotency_records
        (created_at, expires_at, idempotency_key, request_hash, response_body, response_status, scope, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,633 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(2018306763<open>)] after transaction
2025-10-15 19:20:15,633 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Resuming suspended transaction after completion of inner transaction
2025-10-15 19:20:15,633 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Webhook event processed atomically - Event #43, End-to-End ID: E1760570415627ec6529e96f2e40e79d, Event ID: REJECTED-EVENT, Status: REJECTED
2025-10-15 19:20:15,633 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"4f3999e3-db82-4221-8d35-a5240f311e38","correlationId":"4f3999e3-db82-4221-8d35-a5240f311e38","event":"performance_metric","operation":"PixTransferUseCase.processWebhookEvent","durationMs":4,"transactionId":"TX-1760570415632-1","timestamp":"2025-10-15T19:20:15.633663266"}
2025-10-15 19:20:15,633 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: PixTransferUseCase.processWebhookEvent in 4ms
2025-10-15 19:20:15,633 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415629-1 for PixTransferUseCase.processWebhookEvent in 4ms
2025-10-15 19:20:15,633 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,633 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(908585290<open>)]
2025-10-15 19:20:15,634 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,634 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,634 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(908585290<open>)] after transaction
2025-10-15 19:20:15,634 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findByEndToEndId]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,634 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1433338097<open>)] for JPA transaction
2025-10-15 19:20:15,635 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@fb8adcf]
2025-10-15 19:20:15,635 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1433338097<open>)] for JPA transaction
2025-10-15 19:20:15,635 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,635 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Finding transfer by endToEndId: E1760570415627ec6529e96f2e40e79d
2025-10-15 19:20:15,635 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.end_to_end_id=?
2025-10-15 19:20:15,635 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Found transfer for endToEndId: E1760570415627ec6529e96f2e40e79d - Status: REJECTED
2025-10-15 19:20:15,635 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,635 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1433338097<open>)]
2025-10-15 19:20:15,635 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1433338097<open>)] after transaction
2025-10-15 19:20:15,635 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,635 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1005497741<open>)] for JPA transaction
2025-10-15 19:20:15,635 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2e8f558c]
2025-10-15 19:20:15,635 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1005497741<open>)] for JPA transaction
2025-10-15 19:20:15,635 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,635 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: b36cc3d4-f640-4d12-8a48-5962f527db83
2025-10-15 19:20:15,635 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,635 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: b36cc3d4-f640-4d12-8a48-5962f527db83 - Balance: R$ 1.000,00
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1005497741<open>)]
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1005497741<open>)] after transaction
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.PixTransferUseCase.processWebhookEvent]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1316040205<open>)] for JPA transaction
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@700735e2]
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415636-1 for PixTransferUseCase.processWebhookEvent
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: PixTransferUseCase.processWebhookEvent with args: [E1760570415627ec6529e96f2e40e79d, CONFIRMED-EVENT, CONFIRMED]
2025-10-15 19:20:15,636 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Processing webhook event atomically - End-to-End ID: E1760570415627ec6529e96f2e40e79d, Event ID: CONFIRMED-EVENT, Event Type: CONFIRMED
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1316040205<open>)] for JPA transaction
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: IdempotencyService.findExistingRecord
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415636-1 for IdempotencyService.findExistingRecord
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.d.service.IdempotencyService - Looking for existing idempotency record - scope: [REDACTED], key: [REDACTED]
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1316040205<open>)] for JPA transaction
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1316040205<open>)] for JPA transaction
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Finding idempotency record by scope: webhook and key: CONFIRMED-EVENT
2025-10-15 19:20:15,636 [main] DEBUG org.hibernate.SQL - 
    select
        ir1_0.id,
        ir1_0.created_at,
        ir1_0.expires_at,
        ir1_0.idempotency_key,
        ir1_0.request_hash,
        ir1_0.response_body,
        ir1_0.response_status,
        ir1_0.scope 
    from
        idempotency_records ir1_0 
    where
        ir1_0.scope=? 
        and ir1_0.idempotency_key=?
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - No idempotency record found for scope: webhook and key: CONFIRMED-EVENT
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415636-1 for IdempotencyService.findExistingRecord in 0ms
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: IdempotencyService.findExistingRecord in 0ms
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1316040205<open>)] for JPA transaction
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Suspending current transaction, creating new transaction with name [com.finaya.pixwallet.domain.service.AtomicTransferService.updateTransferStateAtomically]
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(849767246<open>)] for JPA transaction
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@7b47e0dd]
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: AtomicTransferService.updateTransferStateAtomically
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415636-1 for AtomicTransferService.updateTransferStateAtomically
2025-10-15 19:20:15,636 [main] INFO  c.f.p.d.s.AtomicTransferService - Updating transfer state atomically - EndToEnd: E1760570415627ec6529e96f2e40e79d, NewStatus: CONFIRMED
2025-10-15 19:20:15,636 [main] WARN  c.f.p.d.s.AtomicTransferService - Invalid state transition - EndToEnd: E1760570415627ec6529e96f2e40e79d, From: REJECTED, To: CONFIRMED
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415636-1 for AtomicTransferService.updateTransferStateAtomically in 0ms
2025-10-15 19:20:15,636 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: AtomicTransferService.updateTransferStateAtomically in 0ms
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(849767246<open>)]
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(849767246<open>)] after transaction
2025-10-15 19:20:15,636 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Resuming suspended transaction after completion of inner transaction
2025-10-15 19:20:15,636 [main] WARN  c.f.p.a.usecase.PixTransferUseCase - Failed to update transfer state atomically - End-to-End ID: E1760570415627ec6529e96f2e40e79d, Target Status: CONFIRMED
2025-10-15 19:20:15,637 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"c05edf6c-fafc-4137-998c-f806de7dc725","correlationId":"c05edf6c-fafc-4137-998c-f806de7dc725","event":"performance_metric","operation":"PixTransferUseCase.processWebhookEvent","durationMs":0,"transactionId":"TX-1760570415636-1","timestamp":"2025-10-15T19:20:15.636994557"}
2025-10-15 19:20:15,637 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: PixTransferUseCase.processWebhookEvent in 0ms
2025-10-15 19:20:15,637 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415636-1 for PixTransferUseCase.processWebhookEvent in 1ms
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1316040205<open>)]
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1316040205<open>)] after transaction
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findByEndToEndId]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(891880661<open>)] for JPA transaction
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@41288da3]
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(891880661<open>)] for JPA transaction
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,637 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Finding transfer by endToEndId: E1760570415627ec6529e96f2e40e79d
2025-10-15 19:20:15,637 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.end_to_end_id=?
2025-10-15 19:20:15,637 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Found transfer for endToEndId: E1760570415627ec6529e96f2e40e79d - Status: REJECTED
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(891880661<open>)]
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(891880661<open>)] after transaction
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(2086821885<open>)] for JPA transaction
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@174af948]
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2086821885<open>)] for JPA transaction
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,637 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: ea12e96e-9b0c-486c-8b9b-bd11fd07917c
2025-10-15 19:20:15,637 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,637 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: ea12e96e-9b0c-486c-8b9b-bd11fd07917c - Balance: R$ 0,00
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(2086821885<open>)]
2025-10-15 19:20:15,637 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(2086821885<open>)] after transaction
2025-10-15 19:20:15,640 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,640 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(2120574409<open>)] for JPA transaction
2025-10-15 19:20:15,640 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@bfcdc45]
2025-10-15 19:20:15,640 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2120574409<open>)] for JPA transaction
2025-10-15 19:20:15,640 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,640 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415640-1 for PixTransferRepositoryImpl.deleteAll
2025-10-15 19:20:15,640 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0
2025-10-15 19:20:15,641 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415640-1 for PixTransferRepositoryImpl.deleteAll in 1ms
2025-10-15 19:20:15,641 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,641 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(2120574409<open>)]
2025-10-15 19:20:15,641 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        pix_transfers 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,642 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(2120574409<open>)] after transaction
2025-10-15 19:20:15,642 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.deleteAll]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,642 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1793123345<open>)] for JPA transaction
2025-10-15 19:20:15,642 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@3c3b5d1]
2025-10-15 19:20:15,642 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1793123345<open>)] for JPA transaction
2025-10-15 19:20:15,642 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,642 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - Deleting all wallets - this operation should only be used in tests
2025-10-15 19:20:15,642 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0
2025-10-15 19:20:15,642 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Deleting wallet: b36cc3d4-f640-4d12-8a48-5962f527db83
2025-10-15 19:20:15,643 [main] DEBUG org.hibernate.SQL - 
    select
        le1_0.wallet_id,
        le1_0.id,
        le1_0.amount_centavos,
        le1_0.balance_after_centavos,
        le1_0.created_at,
        le1_0.description,
        le1_0.entry_type,
        le1_0.transaction_id 
    from
        ledger_entries le1_0 
    where
        le1_0.wallet_id=?
2025-10-15 19:20:15,643 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.wallet_id,
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value 
    from
        pix_keys pk1_0 
    where
        pk1_0.wallet_id=?
2025-10-15 19:20:15,643 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Wallet deleted: b36cc3d4-f640-4d12-8a48-5962f527db83
2025-10-15 19:20:15,643 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Deleting wallet: ea12e96e-9b0c-486c-8b9b-bd11fd07917c
2025-10-15 19:20:15,643 [main] DEBUG org.hibernate.SQL - 
    select
        le1_0.wallet_id,
        le1_0.id,
        le1_0.amount_centavos,
        le1_0.balance_after_centavos,
        le1_0.created_at,
        le1_0.description,
        le1_0.entry_type,
        le1_0.transaction_id 
    from
        ledger_entries le1_0 
    where
        le1_0.wallet_id=?
2025-10-15 19:20:15,643 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.wallet_id,
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value 
    from
        pix_keys pk1_0 
    where
        pk1_0.wallet_id=?
2025-10-15 19:20:15,644 [main] INFO  c.f.p.i.p.WalletRepositoryImpl - Wallet deleted: ea12e96e-9b0c-486c-8b9b-bd11fd07917c
2025-10-15 19:20:15,644 [main] WARN  c.f.p.i.p.WalletRepositoryImpl - All wallets deleted
2025-10-15 19:20:15,644 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,644 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1793123345<open>)]
2025-10-15 19:20:15,644 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        ledger_entries 
    where
        id=?
2025-10-15 19:20:15,644 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        ledger_entries 
    where
        id=?
2025-10-15 19:20:15,644 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        ledger_entries 
    where
        id=?
2025-10-15 19:20:15,644 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        wallets 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,644 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        pix_keys 
    where
        id=?
2025-10-15 19:20:15,644 [main] DEBUG org.hibernate.SQL - 
    delete 
    from
        wallets 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,644 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1793123345<open>)] after transaction
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.createWallet]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1736471747<open>)] for JPA transaction
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@25df373d]
2025-10-15 19:20:15,645 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415645-1 for WalletUseCase.createWallet
2025-10-15 19:20:15,645 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.createWallet with args: [source-user]
2025-10-15 19:20:15,645 [main] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #31 for user: source-user
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1736471747<open>)] for JPA transaction
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1736471747<open>)] for JPA transaction
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,645 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Checking if wallet exists for userId: source-user
2025-10-15 19:20:15,645 [main] DEBUG org.hibernate.SQL - 
    select
        count(w1_0.id) 
    from
        wallets w1_0 
    where
        w1_0.user_id=?
2025-10-15 19:20:15,645 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet exists for userId: source-user - false
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1736471747<open>)] for JPA transaction
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1736471747<open>)] for JPA transaction
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,645 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,645 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 977b5104-916f-4fbc-ba5b-878e00b6e0ec - New Version: 0
2025-10-15 19:20:15,645 [main] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #31 created successfully - ID: 977b5104-916f-4fbc-ba5b-878e00b6e0ec, User: source-user
2025-10-15 19:20:15,645 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"2ccd5de4-9fe2-46e4-ad1b-f7b6e8092141","correlationId":"2ccd5de4-9fe2-46e4-ad1b-f7b6e8092141","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":0,"transactionId":"TX-1760570415645-1","timestamp":"2025-10-15T19:20:15.645844957"}
2025-10-15 19:20:15,645 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.createWallet in 0ms
2025-10-15 19:20:15,645 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415645-1 for WalletUseCase.createWallet in 0ms
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,645 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1736471747<open>)]
2025-10-15 19:20:15,646 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1736471747<open>)] after transaction
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.createWallet]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1040354326<open>)] for JPA transaction
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5746441d]
2025-10-15 19:20:15,646 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415646-1 for WalletUseCase.createWallet
2025-10-15 19:20:15,646 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.createWallet with args: [dest-user]
2025-10-15 19:20:15,646 [main] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #32 for user: dest-user
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1040354326<open>)] for JPA transaction
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1040354326<open>)] for JPA transaction
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,646 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Checking if wallet exists for userId: dest-user
2025-10-15 19:20:15,646 [main] DEBUG org.hibernate.SQL - 
    select
        count(w1_0.id) 
    from
        wallets w1_0 
    where
        w1_0.user_id=?
2025-10-15 19:20:15,646 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet exists for userId: dest-user - false
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1040354326<open>)] for JPA transaction
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1040354326<open>)] for JPA transaction
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,646 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: null - Balance: R$ 0,00, Version: null
2025-10-15 19:20:15,646 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: f98f5f78-ecde-406d-bca6-06468a8df92d - New Version: 0
2025-10-15 19:20:15,646 [main] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #32 created successfully - ID: f98f5f78-ecde-406d-bca6-06468a8df92d, User: dest-user
2025-10-15 19:20:15,646 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"59821ca0-46ae-45da-9a2d-5958dc3b8835","correlationId":"59821ca0-46ae-45da-9a2d-5958dc3b8835","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":0,"transactionId":"TX-1760570415646-1","timestamp":"2025-10-15T19:20:15.646848726"}
2025-10-15 19:20:15,646 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.createWallet in 0ms
2025-10-15 19:20:15,646 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415646-1 for WalletUseCase.createWallet in 0ms
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,646 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1040354326<open>)]
2025-10-15 19:20:15,646 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        wallets
        (balance_centavos, created_at, updated_at, user_id, version, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,647 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1040354326<open>)] after transaction
2025-10-15 19:20:15,647 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.deposit]: PROPAGATION_REQUIRES_NEW,ISOLATION_SERIALIZABLE
2025-10-15 19:20:15,647 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(382600670<open>)] for JPA transaction
2025-10-15 19:20:15,647 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@26e61f3d]
2025-10-15 19:20:15,647 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415647-1 for WalletUseCase.deposit
2025-10-15 19:20:15,647 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.deposit with args: [977b5104-916f-4fbc-ba5b-878e00b6e0ec, R$ 1.000,00, Initial deposit]
2025-10-15 19:20:15,647 [main] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic deposit #264 - Wallet: 977b5104-916f-4fbc-ba5b-878e00b6e0ec, Amount: R$ 1.000,00, Description: Initial deposit
2025-10-15 19:20:15,647 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(382600670<open>)] for JPA transaction
2025-10-15 19:20:15,647 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,647 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,648 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(382600670<open>)] for JPA transaction
2025-10-15 19:20:15,648 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,648 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(382600670<open>)] for JPA transaction
2025-10-15 19:20:15,648 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,648 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: 977b5104-916f-4fbc-ba5b-878e00b6e0ec - Balance: R$ 1.000,00, Version: 0
2025-10-15 19:20:15,648 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 977b5104-916f-4fbc-ba5b-878e00b6e0ec - New Version: 0
2025-10-15 19:20:15,648 [main] INFO  c.f.p.a.usecase.WalletUseCase - Atomic deposit processed successfully - Deposit #264, Wallet: 977b5104-916f-4fbc-ba5b-878e00b6e0ec, Amount: R$ 1.000,00, Balance: R$ 0,00 -> R$ 1.000,00
2025-10-15 19:20:15,648 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"ba5f040e-88b9-4ef0-b08b-5e6ed7ff4028","correlationId":"ba5f040e-88b9-4ef0-b08b-5e6ed7ff4028","event":"performance_metric","operation":"WalletUseCase.deposit","durationMs":1,"transactionId":"TX-1760570415647-1","timestamp":"2025-10-15T19:20:15.648340537"}
2025-10-15 19:20:15,648 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.deposit in 1ms
2025-10-15 19:20:15,648 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415647-1 for WalletUseCase.deposit in 1ms
2025-10-15 19:20:15,648 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,648 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(382600670<open>)]
2025-10-15 19:20:15,648 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,649 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,650 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(382600670<open>)] after transaction
2025-10-15 19:20:15,650 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.WalletUseCase.registerPixKey]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,650 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1663002925<open>)] for JPA transaction
2025-10-15 19:20:15,650 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2c3d6d78]
2025-10-15 19:20:15,650 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415650-1 for WalletUseCase.registerPixKey
2025-10-15 19:20:15,650 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: WalletUseCase.registerPixKey with args: [f98f5f78-ecde-406d-bca6-06468a8df92d, dest@example.com, EMAIL]
2025-10-15 19:20:15,650 [main] INFO  c.f.p.a.usecase.WalletUseCase - Registering Pix key #11 for wallet: f98f5f78-ecde-406d-bca6-06468a8df92d - Key: dest@example.com, Type: EMAIL
2025-10-15 19:20:15,651 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.id 
    from
        pix_keys pk1_0 
    where
        pk1_0.key_value=? 
        and pk1_0.key_type=? 
        and pk1_0.is_active=? 
    fetch
        first ? rows only
2025-10-15 19:20:15,651 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1663002925<open>)] for JPA transaction
2025-10-15 19:20:15,651 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,651 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1663002925<open>)] for JPA transaction
2025-10-15 19:20:15,651 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,651 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: f98f5f78-ecde-406d-bca6-06468a8df92d
2025-10-15 19:20:15,651 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,651 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: f98f5f78-ecde-406d-bca6-06468a8df92d - Balance: R$ 0,00
2025-10-15 19:20:15,651 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1663002925<open>)] for JPA transaction
2025-10-15 19:20:15,652 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,652 [main] INFO  c.f.p.a.usecase.WalletUseCase - Pix key #11 registered successfully - ID: 858fcb1a-7633-4715-a64c-4e4f8cc25897, Key: dest@example.com
2025-10-15 19:20:15,652 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"5cf64eb7-d02d-4214-aa7d-f0bfd2902f75","correlationId":"5cf64eb7-d02d-4214-aa7d-f0bfd2902f75","event":"performance_metric","operation":"WalletUseCase.registerPixKey","durationMs":2,"transactionId":"TX-1760570415650-1","timestamp":"2025-10-15T19:20:15.652139573"}
2025-10-15 19:20:15,652 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: WalletUseCase.registerPixKey in 2ms
2025-10-15 19:20:15,652 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415650-1 for WalletUseCase.registerPixKey in 2ms
2025-10-15 19:20:15,652 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,652 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1663002925<open>)]
2025-10-15 19:20:15,652 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        pix_keys
        (created_at, is_active, key_type, key_value, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,652 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1663002925<open>)] after transaction
2025-10-15 19:20:15,652 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.PixTransferUseCase.initiateTransfer]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,652 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1589849961<open>)] for JPA transaction
2025-10-15 19:20:15,653 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@74409dc9]
2025-10-15 19:20:15,653 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415653-1 for PixTransferUseCase.initiateTransfer
2025-10-15 19:20:15,653 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: PixTransferUseCase.initiateTransfer with args: [WEBHOOK-IDEMPOTENCY-c13d0320-6de7-45f7-9d04-096d24282e68, 977b5104-916f-4fbc-ba5b-878e00b6e0ec, dest@example.com, R$ 50,00]
2025-10-15 19:20:15,653 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Initiating Pix transfer with atomic operations - Idempotency Key: WEBHOOK-IDEMPOTENCY-c13d0320-6de7-45f7-9d04-096d24282e68, From: 977b5104-916f-4fbc-ba5b-878e00b6e0ec, To: dest@example.com, Amount: R$ 50,00
2025-10-15 19:20:15,653 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1589849961<open>)] for JPA transaction
2025-10-15 19:20:15,653 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,653 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1589849961<open>)] for JPA transaction
2025-10-15 19:20:15,653 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,653 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Finding transfer by idempotencyKey: WEBHOOK-IDEMPOTENCY-c13d0320-6de7-45f7-9d04-096d24282e68
2025-10-15 19:20:15,653 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.idempotency_key=?
2025-10-15 19:20:15,653 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - No transfer found for idempotencyKey: WEBHOOK-IDEMPOTENCY-c13d0320-6de7-45f7-9d04-096d24282e68
2025-10-15 19:20:15,653 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value,
        pk1_0.wallet_id 
    from
        pix_keys pk1_0 
    where
        pk1_0.key_value=? 
        and pk1_0.is_active=true
2025-10-15 19:20:15,654 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1589849961<open>)] for JPA transaction
2025-10-15 19:20:15,654 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Suspending current transaction, creating new transaction with name [com.finaya.pixwallet.domain.service.AtomicTransferService.createTransferAtomically]
2025-10-15 19:20:15,654 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(311103808<open>)] for JPA transaction
2025-10-15 19:20:15,654 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@6d78fd8d]
2025-10-15 19:20:15,654 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: AtomicTransferService.createTransferAtomically
2025-10-15 19:20:15,654 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415654-1 for AtomicTransferService.createTransferAtomically
2025-10-15 19:20:15,654 [main] INFO  c.f.p.d.s.AtomicTransferService - Starting atomic transfer creation - ID: 6, EndToEnd: E1760570415654779f532be09e4542b9, From: 977b5104-916f-4fbc-ba5b-878e00b6e0ec, Amount: R$ 50,00
2025-10-15 19:20:15,654 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(311103808<open>)] for JPA transaction
2025-10-15 19:20:15,654 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,654 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,654 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(311103808<open>)] for JPA transaction
2025-10-15 19:20:15,654 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,654 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(311103808<open>)] for JPA transaction
2025-10-15 19:20:15,654 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,654 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: 977b5104-916f-4fbc-ba5b-878e00b6e0ec - Balance: R$ 950,00, Version: 1
2025-10-15 19:20:15,655 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: 977b5104-916f-4fbc-ba5b-878e00b6e0ec - New Version: 1
2025-10-15 19:20:15,655 [main] DEBUG c.f.p.d.s.AtomicTransferService - Wallet debited atomically - ID: 977b5104-916f-4fbc-ba5b-878e00b6e0ec, Amount: R$ 50,00, NewBalance: R$ 950,00
2025-10-15 19:20:15,655 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(311103808<open>)] for JPA transaction
2025-10-15 19:20:15,655 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,655 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(311103808<open>)] for JPA transaction
2025-10-15 19:20:15,655 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,655 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Saving transfer: E1760570415654779f532be09e4542b9 - Status: PENDING, Version: null
2025-10-15 19:20:15,655 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Transfer saved successfully: E1760570415654779f532be09e4542b9 - New Version: 0
2025-10-15 19:20:15,655 [main] INFO  c.f.p.d.s.AtomicTransferService - Atomic transfer created successfully - ID: 6, EndToEnd: E1760570415654779f532be09e4542b9
2025-10-15 19:20:15,655 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415654-1 for AtomicTransferService.createTransferAtomically in 1ms
2025-10-15 19:20:15,655 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: AtomicTransferService.createTransferAtomically in 1ms
2025-10-15 19:20:15,655 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,655 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(311103808<open>)]
2025-10-15 19:20:15,655 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,655 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        pix_transfers
        (amount_cents, confirmed_at, created_at, end_to_end_id, from_wallet_id, idempotency_key, rejected_at, rejection_reason, status, to_pix_key, updated_at, version, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,655 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(311103808<open>)] after transaction
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Resuming suspended transaction after completion of inner transaction
2025-10-15 19:20:15,656 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Pix transfer initiated atomically - End-to-End ID: E1760570415654779f532be09e4542b9, Transfer ID: 2b4358c1-e5fb-4b42-934b-88c2fdac1cc9
2025-10-15 19:20:15,656 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"e26c8e53-7efa-4f4e-9372-d0518869ae4e","correlationId":"e26c8e53-7efa-4f4e-9372-d0518869ae4e","event":"performance_metric","operation":"PixTransferUseCase.initiateTransfer","durationMs":3,"transactionId":"TX-1760570415654-1","timestamp":"2025-10-15T19:20:15.656259375"}
2025-10-15 19:20:15,656 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: PixTransferUseCase.initiateTransfer in 3ms
2025-10-15 19:20:15,656 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415653-1 for PixTransferUseCase.initiateTransfer in 3ms
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1589849961<open>)]
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1589849961<open>)] after transaction
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.PixTransferUseCase.processWebhookEvent]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(235420001<open>)] for JPA transaction
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@1e5975db]
2025-10-15 19:20:15,656 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415656-1 for PixTransferUseCase.processWebhookEvent
2025-10-15 19:20:15,656 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: PixTransferUseCase.processWebhookEvent with args: [E1760570415654779f532be09e4542b9, EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8, CONFIRMED]
2025-10-15 19:20:15,656 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Processing webhook event atomically - End-to-End ID: E1760570415654779f532be09e4542b9, Event ID: EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8, Event Type: CONFIRMED
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(235420001<open>)] for JPA transaction
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,656 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: IdempotencyService.findExistingRecord
2025-10-15 19:20:15,656 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415656-1 for IdempotencyService.findExistingRecord
2025-10-15 19:20:15,656 [main] DEBUG c.f.p.d.service.IdempotencyService - Looking for existing idempotency record - scope: [REDACTED], key: [REDACTED]
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(235420001<open>)] for JPA transaction
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(235420001<open>)] for JPA transaction
2025-10-15 19:20:15,656 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,656 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Finding idempotency record by scope: webhook and key: EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8
2025-10-15 19:20:15,656 [main] DEBUG org.hibernate.SQL - 
    select
        ir1_0.id,
        ir1_0.created_at,
        ir1_0.expires_at,
        ir1_0.idempotency_key,
        ir1_0.request_hash,
        ir1_0.response_body,
        ir1_0.response_status,
        ir1_0.scope 
    from
        idempotency_records ir1_0 
    where
        ir1_0.scope=? 
        and ir1_0.idempotency_key=?
2025-10-15 19:20:15,657 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - No idempotency record found for scope: webhook and key: EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8
2025-10-15 19:20:15,657 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415656-1 for IdempotencyService.findExistingRecord in 1ms
2025-10-15 19:20:15,657 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: IdempotencyService.findExistingRecord in 1ms
2025-10-15 19:20:15,657 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(235420001<open>)] for JPA transaction
2025-10-15 19:20:15,657 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Suspending current transaction, creating new transaction with name [com.finaya.pixwallet.domain.service.AtomicTransferService.updateTransferStateAtomically]
2025-10-15 19:20:15,657 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1204190233<open>)] for JPA transaction
2025-10-15 19:20:15,657 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@12643e97]
2025-10-15 19:20:15,657 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: AtomicTransferService.updateTransferStateAtomically
2025-10-15 19:20:15,657 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415657-1 for AtomicTransferService.updateTransferStateAtomically
2025-10-15 19:20:15,657 [main] INFO  c.f.p.d.s.AtomicTransferService - Updating transfer state atomically - EndToEnd: E1760570415654779f532be09e4542b9, NewStatus: CONFIRMED
2025-10-15 19:20:15,657 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1204190233<open>)] for JPA transaction
2025-10-15 19:20:15,657 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,657 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.end_to_end_id=? for update
2025-10-15 19:20:15,657 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1204190233<open>)] for JPA transaction
2025-10-15 19:20:15,657 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,657 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1204190233<open>)] for JPA transaction
2025-10-15 19:20:15,657 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,657 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Saving transfer: E1760570415654779f532be09e4542b9 - Status: CONFIRMED, Version: 0
2025-10-15 19:20:15,657 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Transfer saved successfully: E1760570415654779f532be09e4542b9 - New Version: 0
2025-10-15 19:20:15,657 [main] INFO  c.f.p.d.s.AtomicTransferService - Transfer state updated successfully - EndToEnd: E1760570415654779f532be09e4542b9, Status: CONFIRMED
2025-10-15 19:20:15,657 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415657-1 for AtomicTransferService.updateTransferStateAtomically in 0ms
2025-10-15 19:20:15,657 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: AtomicTransferService.updateTransferStateAtomically in 0ms
2025-10-15 19:20:15,657 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,658 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1204190233<open>)]
2025-10-15 19:20:15,658 [main] DEBUG org.hibernate.SQL - 
    update
        pix_transfers 
    set
        amount_cents=?,
        confirmed_at=?,
        created_at=?,
        end_to_end_id=?,
        from_wallet_id=?,
        idempotency_key=?,
        rejected_at=?,
        rejection_reason=?,
        status=?,
        to_pix_key=?,
        updated_at=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,658 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1204190233<open>)] after transaction
2025-10-15 19:20:15,658 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Resuming suspended transaction after completion of inner transaction
2025-10-15 19:20:15,658 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(235420001<open>)] for JPA transaction
2025-10-15 19:20:15,658 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,658 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(235420001<open>)] for JPA transaction
2025-10-15 19:20:15,658 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,658 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Finding transfer by endToEndId: E1760570415654779f532be09e4542b9
2025-10-15 19:20:15,658 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.end_to_end_id=?
2025-10-15 19:20:15,658 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Found transfer for endToEndId: E1760570415654779f532be09e4542b9 - Status: CONFIRMED
2025-10-15 19:20:15,658 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Handling confirmed event atomically - End-to-End ID: E1760570415654779f532be09e4542b9
2025-10-15 19:20:15,659 [main] DEBUG org.hibernate.SQL - 
    select
        pk1_0.id,
        pk1_0.created_at,
        pk1_0.is_active,
        pk1_0.key_type,
        pk1_0.key_value,
        pk1_0.wallet_id 
    from
        pix_keys pk1_0 
    where
        pk1_0.key_value=? 
        and pk1_0.is_active=true
2025-10-15 19:20:15,659 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: AtomicTransferService.creditDestinationWalletAtomically
2025-10-15 19:20:15,659 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(235420001<open>)] for JPA transaction
2025-10-15 19:20:15,659 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,659 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=? for update
2025-10-15 19:20:15,659 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(235420001<open>)] for JPA transaction
2025-10-15 19:20:15,659 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,659 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(235420001<open>)] for JPA transaction
2025-10-15 19:20:15,659 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,659 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Saving wallet: f98f5f78-ecde-406d-bca6-06468a8df92d - Balance: R$ 50,00, Version: 0
2025-10-15 19:20:15,659 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Wallet saved successfully: f98f5f78-ecde-406d-bca6-06468a8df92d - New Version: 0
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.d.s.AtomicTransferService - Wallet credited atomically - ID: f98f5f78-ecde-406d-bca6-06468a8df92d, Amount: R$ 50,00, NewBalance: R$ 50,00
2025-10-15 19:20:15,660 [main] INFO  c.f.p.d.s.AtomicTransferService - Destination wallet credited atomically - Wallet: f98f5f78-ecde-406d-bca6-06468a8df92d, Amount: R$ 50,00
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: AtomicTransferService.creditDestinationWalletAtomically in 1ms
2025-10-15 19:20:15,660 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Transfer confirmed and credited atomically - End-to-End ID: E1760570415654779f532be09e4542b9, Destination Wallet: f98f5f78-ecde-406d-bca6-06468a8df92d
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(235420001<open>)] for JPA transaction
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Suspending current transaction, creating new transaction with name [com.finaya.pixwallet.domain.service.IdempotencyService.saveRecordAtomically]
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1450825838<open>)] for JPA transaction
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@785c5b78]
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: IdempotencyService.saveRecordAtomically
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415660-1 for IdempotencyService.saveRecordAtomically
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.d.service.IdempotencyService - Saving idempotency record atomically - scope: webhook, key: EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8, status: 200
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.d.service.IdempotencyService - Looking for existing idempotency record - scope: [REDACTED], key: [REDACTED]
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1450825838<open>)] for JPA transaction
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1450825838<open>)] for JPA transaction
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Finding idempotency record by scope: webhook and key: EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8
2025-10-15 19:20:15,660 [main] DEBUG org.hibernate.SQL - 
    select
        ir1_0.id,
        ir1_0.created_at,
        ir1_0.expires_at,
        ir1_0.idempotency_key,
        ir1_0.request_hash,
        ir1_0.response_body,
        ir1_0.response_status,
        ir1_0.scope 
    from
        idempotency_records ir1_0 
    where
        ir1_0.scope=? 
        and ir1_0.idempotency_key=?
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - No idempotency record found for scope: webhook and key: EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1450825838<open>)] for JPA transaction
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1450825838<open>)] for JPA transaction
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Saving idempotency record: scope=webhook, key=EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8, status=200
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.i.p.IdempotencyRepositoryImpl - Idempotency record saved successfully: scope=webhook, key=EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.d.service.IdempotencyService - Idempotency record saved successfully - scope: webhook, key: EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415660-1 for IdempotencyService.saveRecordAtomically in 0ms
2025-10-15 19:20:15,660 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: IdempotencyService.saveRecordAtomically in 0ms
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,660 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1450825838<open>)]
2025-10-15 19:20:15,660 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        idempotency_records
        (created_at, expires_at, idempotency_key, request_hash, response_body, response_status, scope, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,661 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1450825838<open>)] after transaction
2025-10-15 19:20:15,661 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Resuming suspended transaction after completion of inner transaction
2025-10-15 19:20:15,661 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Webhook event processed atomically - Event #45, End-to-End ID: E1760570415654779f532be09e4542b9, Event ID: EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8, Status: CONFIRMED
2025-10-15 19:20:15,661 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"cac9586f-e36e-45c3-8b02-9e05e900ffdc","correlationId":"cac9586f-e36e-45c3-8b02-9e05e900ffdc","event":"performance_metric","operation":"PixTransferUseCase.processWebhookEvent","durationMs":5,"transactionId":"TX-1760570415660-1","timestamp":"2025-10-15T19:20:15.661154113"}
2025-10-15 19:20:15,661 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: PixTransferUseCase.processWebhookEvent in 5ms
2025-10-15 19:20:15,661 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415656-1 for PixTransferUseCase.processWebhookEvent in 5ms
2025-10-15 19:20:15,661 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,661 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(235420001<open>)]
2025-10-15 19:20:15,661 [main] DEBUG org.hibernate.SQL - 
    insert 
    into
        ledger_entries
        (amount_centavos, balance_after_centavos, created_at, description, entry_type, transaction_id, wallet_id, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-10-15 19:20:15,661 [main] DEBUG org.hibernate.SQL - 
    update
        wallets 
    set
        balance_centavos=?,
        created_at=?,
        updated_at=?,
        user_id=?,
        version=? 
    where
        id=? 
        and version=?
2025-10-15 19:20:15,661 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(235420001<open>)] after transaction
2025-10-15 19:20:15,661 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,661 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1442393563<open>)] for JPA transaction
2025-10-15 19:20:15,661 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@720574a4]
2025-10-15 19:20:15,661 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1442393563<open>)] for JPA transaction
2025-10-15 19:20:15,661 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,661 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: f98f5f78-ecde-406d-bca6-06468a8df92d
2025-10-15 19:20:15,662 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: f98f5f78-ecde-406d-bca6-06468a8df92d - Balance: R$ 50,00
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1442393563<open>)]
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1442393563<open>)] after transaction
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [com.finaya.pixwallet.application.usecase.PixTransferUseCase.processWebhookEvent]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1788726996<open>)] for JPA transaction
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@4f6a501c]
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415662-1 for PixTransferUseCase.processWebhookEvent
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing use case: PixTransferUseCase.processWebhookEvent with args: [E1760570415654779f532be09e4542b9, EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8, CONFIRMED]
2025-10-15 19:20:15,662 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Processing webhook event atomically - End-to-End ID: E1760570415654779f532be09e4542b9, Event ID: EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8, Event Type: CONFIRMED
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1788726996<open>)] for JPA transaction
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.i.logging.LoggingAspect - Executing domain service: IdempotencyService.findExistingRecord
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.i.logging.LoggingAspect - Starting transaction: TX-1760570415662-1 for IdempotencyService.findExistingRecord
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.d.service.IdempotencyService - Looking for existing idempotency record - scope: [REDACTED], key: [REDACTED]
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.d.service.IdempotencyService - Found valid cached idempotency record
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415662-1 for IdempotencyService.findExistingRecord in 0ms
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.i.logging.LoggingAspect - Domain service executed successfully: IdempotencyService.findExistingRecord in 0ms
2025-10-15 19:20:15,662 [main] INFO  c.f.p.a.usecase.PixTransferUseCase - Webhook event already processed atomically - Event ID: EVENT-9a608f52-69d8-4852-aa46-44ecbb66b0f8
2025-10-15 19:20:15,662 [main] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"6c6693be-cd36-41b2-bb8a-8cfca07396fc","correlationId":"6c6693be-cd36-41b2-bb8a-8cfca07396fc","event":"performance_metric","operation":"PixTransferUseCase.processWebhookEvent","durationMs":0,"transactionId":"TX-1760570415662-1","timestamp":"2025-10-15T19:20:15.662525457"}
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.i.logging.LoggingAspect - Use case executed successfully: PixTransferUseCase.processWebhookEvent in 0ms
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.i.logging.LoggingAspect - Transaction completed: TX-1760570415662-1 for PixTransferUseCase.processWebhookEvent in 0ms
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1788726996<open>)]
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1788726996<open>)] after transaction
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(2089870741<open>)] for JPA transaction
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@2348e36]
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(2089870741<open>)] for JPA transaction
2025-10-15 19:20:15,662 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Finding wallet by ID: f98f5f78-ecde-406d-bca6-06468a8df92d
2025-10-15 19:20:15,662 [main] DEBUG org.hibernate.SQL - 
    select
        w1_0.id,
        w1_0.balance_centavos,
        w1_0.created_at,
        w1_0.updated_at,
        w1_0.user_id,
        w1_0.version 
    from
        wallets w1_0 
    where
        w1_0.id=?
2025-10-15 19:20:15,662 [main] DEBUG c.f.p.i.p.WalletRepositoryImpl - Found wallet: f98f5f78-ecde-406d-bca6-06468a8df92d - Balance: R$ 50,00
2025-10-15 19:20:15,663 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,663 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(2089870741<open>)]
2025-10-15 19:20:15,663 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(2089870741<open>)] after transaction
2025-10-15 19:20:15,663 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Creating new transaction with name [org.springframework.data.jpa.repository.support.SimpleJpaRepository.findByEndToEndId]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT,readOnly
2025-10-15 19:20:15,663 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Opened new EntityManager [SessionImpl(1636538715<open>)] for JPA transaction
2025-10-15 19:20:15,663 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Exposing JPA transaction as JDBC [org.springframework.orm.jpa.vendor.HibernateJpaDialect$HibernateConnectionHandle@5cc5c549]
2025-10-15 19:20:15,663 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Found thread-bound EntityManager [SessionImpl(1636538715<open>)] for JPA transaction
2025-10-15 19:20:15,663 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Participating in existing transaction
2025-10-15 19:20:15,663 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Finding transfer by endToEndId: E1760570415654779f532be09e4542b9
2025-10-15 19:20:15,663 [main] DEBUG org.hibernate.SQL - 
    select
        pt1_0.id,
        pt1_0.amount_cents,
        pt1_0.confirmed_at,
        pt1_0.created_at,
        pt1_0.end_to_end_id,
        pt1_0.from_wallet_id,
        pt1_0.idempotency_key,
        pt1_0.rejected_at,
        pt1_0.rejection_reason,
        pt1_0.status,
        pt1_0.to_pix_key,
        pt1_0.updated_at,
        pt1_0.version 
    from
        pix_transfers pt1_0 
    where
        pt1_0.end_to_end_id=?
2025-10-15 19:20:15,663 [main] DEBUG c.f.p.i.p.PixTransferRepositoryImpl - Found transfer for endToEndId: E1760570415654779f532be09e4542b9 - Status: CONFIRMED
2025-10-15 19:20:15,663 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Initiating transaction commit
2025-10-15 19:20:15,663 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Committing JPA transaction on EntityManager [SessionImpl(1636538715<open>)]
2025-10-15 19:20:15,663 [main] DEBUG o.s.orm.jpa.JpaTransactionManager - Closing JPA EntityManager [SessionImpl(1636538715<open>)] after transaction
2025-10-15 19:20:15,700 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:20:15,700 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    drop table if exists idempotency_records cascade 
2025-10-15 19:20:15,700 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    drop table if exists ledger_entries cascade 
2025-10-15 19:20:15,701 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    drop table if exists pix_keys cascade 
2025-10-15 19:20:15,701 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    drop table if exists pix_transfers cascade 
2025-10-15 19:20:15,701 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    drop table if exists wallets cascade 
2025-10-15 19:20:15,702 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-15 19:20:15,703 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-15 19:20:15,707 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:20:15,707 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    drop table if exists idempotency_records cascade 
2025-10-15 19:20:15,707 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    drop table if exists ledger_entries cascade 
2025-10-15 19:20:15,707 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    drop table if exists pix_keys cascade 
2025-10-15 19:20:15,707 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    drop table if exists pix_transfers cascade 
2025-10-15 19:20:15,707 [SpringApplicationShutdownHook] DEBUG org.hibernate.SQL - 
    drop table if exists wallets cascade 
2025-10-15 19:20:15,708 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Shutdown initiated...
2025-10-15 19:20:15,708 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-2 - Shutdown completed.
2025-10-15 19:26:56,580 [main] INFO  c.f.pixwallet.PixWalletApplication - Starting PixWalletApplication using Java 21.0.7 with PID 476848 (/home/ramon/Documentos/code/other/finaya/target/classes started by ramon in /home/ramon/Documentos/code/other/finaya)
2025-10-15 19:26:56,581 [main] INFO  c.f.pixwallet.PixWalletApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-15 19:26:56,894 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:26:56,894 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-10-15 19:26:56,957 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 59 ms. Found 4 JPA repository interfaces.
2025-10-15 19:26:57,109 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:26:57,109 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-15 19:26:57,123 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.IdempotencyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:26:57,123 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixKeyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:26:57,123 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixTransferRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:26:57,123 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.WalletRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:26:57,123 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-10-15 19:26:57,594 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-15 19:26:57,599 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-15 19:26:57,599 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-15 19:26:57,621 [main] INFO  o.a.c.c.C.[.[localhost].[/api/v1] - Initializing Spring embedded WebApplicationContext
2025-10-15 19:26:57,621 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1011 ms
2025-10-15 19:26:57,840 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-10-15 19:26:57,863 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-10-15 19:26:57,878 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-10-15 19:26:57,976 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-10-15 19:26:57,988 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-15 19:26:59,011 [main] ERROR com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Exception during pool initialization.
org.postgresql.util.PSQLException: Connection to localhost:5432 refused. Check that the hostname and port are correct and that the postmaster is accepting TCP/IP connections.
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:342)
	at org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:54)
	at org.postgresql.jdbc.PgConnection.<init>(PgConnection.java:263)
	at org.postgresql.Driver.makeConnection(Driver.java:443)
	at org.postgresql.Driver.connect(Driver.java:297)
	at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:138)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:359)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:201)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:470)
	at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:561)
	at com.zaxxer.hikari.pool.HikariPool.<init>(HikariPool.java:100)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:112)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator$ConnectionProviderJdbcConnectionAccess.obtainConnection(JdbcEnvironmentInitiator.java:424)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcIsolationDelegate.delegateWork(JdbcIsolationDelegate.java:61)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.getJdbcEnvironmentUsingJdbcMetadata(JdbcEnvironmentInitiator.java:273)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:105)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:66)
	at org.hibernate.boot.registry.internal.StandardServiceRegistryImpl.initiateService(StandardServiceRegistryImpl.java:129)
	at org.hibernate.service.internal.AbstractServiceRegistryImpl.createService(AbstractServiceRegistryImpl.java:263)
	at org.hibernate.service.internal.AbstractServiceRegistryImpl.initializeService(AbstractServiceRegistryImpl.java:238)
	at org.hibernate.service.internal.AbstractServiceRegistryImpl.getService(AbstractServiceRegistryImpl.java:215)
	at org.hibernate.boot.model.relational.Database.<init>(Database.java:45)
	at org.hibernate.boot.internal.InFlightMetadataCollectorImpl.getDatabase(InFlightMetadataCollectorImpl.java:223)
	at org.hibernate.boot.internal.InFlightMetadataCollectorImpl.<init>(InFlightMetadataCollectorImpl.java:191)
	at org.hibernate.boot.model.process.spi.MetadataBuildingProcess.complete(MetadataBuildingProcess.java:169)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.metadata(EntityManagerFactoryBuilderImpl.java:1432)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1503)
	at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:75)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:376)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1822)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1771)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1173)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:936)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.finaya.pixwallet.PixWalletApplication.main(PixWalletApplication.java:16)
Caused by: java.net.ConnectException: Conexão recusada
	at java.base/sun.nio.ch.Net.pollConnect(Native Method)
	at java.base/sun.nio.ch.Net.pollConnectNow(Net.java:682)
	at java.base/sun.nio.ch.NioSocketImpl.timedFinishConnect(NioSocketImpl.java:542)
	at java.base/sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:592)
	at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:327)
	at java.base/java.net.Socket.connect(Socket.java:751)
	at org.postgresql.core.PGStream.createSocket(PGStream.java:243)
	at org.postgresql.core.PGStream.<init>(PGStream.java:98)
	at org.postgresql.core.v3.ConnectionFactoryImpl.tryConnect(ConnectionFactoryImpl.java:132)
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:258)
	... 50 common frames omitted
2025-10-15 19:26:59,014 [main] WARN  o.h.e.j.e.i.JdbcEnvironmentInitiator - HHH000342: Could not obtain connection to query metadata
java.lang.NullPointerException: Cannot invoke "org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(java.sql.SQLException, String)" because the return value of "org.hibernate.resource.transaction.backend.jdbc.internal.JdbcIsolationDelegate.sqlExceptionHelper()" is null
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcIsolationDelegate.delegateWork(JdbcIsolationDelegate.java:116)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.getJdbcEnvironmentUsingJdbcMetadata(JdbcEnvironmentInitiator.java:273)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:105)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:66)
	at org.hibernate.boot.registry.internal.StandardServiceRegistryImpl.initiateService(StandardServiceRegistryImpl.java:129)
	at org.hibernate.service.internal.AbstractServiceRegistryImpl.createService(AbstractServiceRegistryImpl.java:263)
	at org.hibernate.service.internal.AbstractServiceRegistryImpl.initializeService(AbstractServiceRegistryImpl.java:238)
	at org.hibernate.service.internal.AbstractServiceRegistryImpl.getService(AbstractServiceRegistryImpl.java:215)
	at org.hibernate.boot.model.relational.Database.<init>(Database.java:45)
	at org.hibernate.boot.internal.InFlightMetadataCollectorImpl.getDatabase(InFlightMetadataCollectorImpl.java:223)
	at org.hibernate.boot.internal.InFlightMetadataCollectorImpl.<init>(InFlightMetadataCollectorImpl.java:191)
	at org.hibernate.boot.model.process.spi.MetadataBuildingProcess.complete(MetadataBuildingProcess.java:169)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.metadata(EntityManagerFactoryBuilderImpl.java:1432)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1503)
	at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:75)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:376)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1822)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1771)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1173)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:936)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.finaya.pixwallet.PixWalletApplication.main(PixWalletApplication.java:16)
2025-10-15 19:26:59,023 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-15 19:26:59,457 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-10-15 19:26:59,466 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-15 19:27:00,467 [main] ERROR com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Exception during pool initialization.
org.postgresql.util.PSQLException: Connection to localhost:5432 refused. Check that the hostname and port are correct and that the postmaster is accepting TCP/IP connections.
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:342)
	at org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:54)
	at org.postgresql.jdbc.PgConnection.<init>(PgConnection.java:263)
	at org.postgresql.Driver.makeConnection(Driver.java:443)
	at org.postgresql.Driver.connect(Driver.java:297)
	at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:138)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:359)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:201)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:470)
	at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:561)
	at com.zaxxer.hikari.pool.HikariPool.<init>(HikariPool.java:100)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:112)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator$ConnectionProviderJdbcConnectionAccess.obtainConnection(JdbcEnvironmentInitiator.java:424)
	at org.hibernate.resource.transaction.backend.jdbc.internal.DdlTransactionIsolatorNonJtaImpl.getIsolatedConnection(DdlTransactionIsolatorNonJtaImpl.java:46)
	at org.hibernate.resource.transaction.backend.jdbc.internal.DdlTransactionIsolatorNonJtaImpl.getIsolatedConnection(DdlTransactionIsolatorNonJtaImpl.java:39)
	at org.hibernate.tool.schema.internal.exec.ImprovedExtractionContextImpl.getJdbcConnection(ImprovedExtractionContextImpl.java:63)
	at org.hibernate.tool.schema.extract.spi.ExtractionContext.getQueryResults(ExtractionContext.java:43)
	at org.hibernate.tool.schema.extract.internal.SequenceInformationExtractorLegacyImpl.extractMetadata(SequenceInformationExtractorLegacyImpl.java:39)
	at org.hibernate.tool.schema.extract.internal.DatabaseInformationImpl.initializeSequences(DatabaseInformationImpl.java:66)
	at org.hibernate.tool.schema.extract.internal.DatabaseInformationImpl.<init>(DatabaseInformationImpl.java:60)
	at org.hibernate.tool.schema.internal.Helper.buildDatabaseInformation(Helper.java:185)
	at org.hibernate.tool.schema.internal.AbstractSchemaMigrator.doMigration(AbstractSchemaMigrator.java:98)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.performDatabaseAction(SchemaManagementToolCoordinator.java:286)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.lambda$process$5(SchemaManagementToolCoordinator.java:145)
	at java.base/java.util.HashMap.forEach(HashMap.java:1429)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.process(SchemaManagementToolCoordinator.java:142)
	at org.hibernate.boot.internal.SessionFactoryObserverForSchemaExport.sessionFactoryCreated(SessionFactoryObserverForSchemaExport.java:37)
	at org.hibernate.internal.SessionFactoryObserverChain.sessionFactoryCreated(SessionFactoryObserverChain.java:35)
	at org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:295)
	at org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:450)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1507)
	at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:75)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:376)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1822)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1771)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1173)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:936)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.finaya.pixwallet.PixWalletApplication.main(PixWalletApplication.java:16)
Caused by: java.net.ConnectException: Conexão recusada
	at java.base/sun.nio.ch.Net.pollConnect(Native Method)
	at java.base/sun.nio.ch.Net.pollConnectNow(Net.java:682)
	at java.base/sun.nio.ch.NioSocketImpl.timedFinishConnect(NioSocketImpl.java:542)
	at java.base/sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:592)
	at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:327)
	at java.base/java.net.Socket.connect(Socket.java:751)
	at org.postgresql.core.PGStream.createSocket(PGStream.java:243)
	at org.postgresql.core.PGStream.<init>(PGStream.java:98)
	at org.postgresql.core.v3.ConnectionFactoryImpl.tryConnect(ConnectionFactoryImpl.java:132)
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:258)
	... 54 common frames omitted
2025-10-15 19:27:00,469 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: 08001
2025-10-15 19:27:00,469 [main] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - Connection to localhost:5432 refused. Check that the hostname and port are correct and that the postmaster is accepting TCP/IP connections.
2025-10-15 19:27:00,472 [main] ERROR o.s.o.j.LocalContainerEntityManagerFactoryBean - Failed to initialize JPA EntityManagerFactory: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.exception.JDBCConnectionException: Unable to open JDBC Connection for DDL execution [Connection to localhost:5432 refused. Check that the hostname and port are correct and that the postmaster is accepting TCP/IP connections.] [n/a]
2025-10-15 19:27:00,472 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.exception.JDBCConnectionException: Unable to open JDBC Connection for DDL execution [Connection to localhost:5432 refused. Check that the hostname and port are correct and that the postmaster is accepting TCP/IP connections.] [n/a]
2025-10-15 19:27:00,473 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-10-15 19:27:00,481 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-15 19:27:00,488 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.exception.JDBCConnectionException: Unable to open JDBC Connection for DDL execution [Connection to localhost:5432 refused. Check that the hostname and port are correct and that the postmaster is accepting TCP/IP connections.] [n/a]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1775)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1173)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:936)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.finaya.pixwallet.PixWalletApplication.main(PixWalletApplication.java:16)
Caused by: jakarta.persistence.PersistenceException: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.exception.JDBCConnectionException: Unable to open JDBC Connection for DDL execution [Connection to localhost:5432 refused. Check that the hostname and port are correct and that the postmaster is accepting TCP/IP connections.] [n/a]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:421)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1822)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1771)
	... 16 common frames omitted
Caused by: org.hibernate.exception.JDBCConnectionException: Unable to open JDBC Connection for DDL execution [Connection to localhost:5432 refused. Check that the hostname and port are correct and that the postmaster is accepting TCP/IP connections.] [n/a]
	at org.hibernate.exception.internal.SQLStateConversionDelegate.convert(SQLStateConversionDelegate.java:100)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.resource.transaction.backend.jdbc.internal.DdlTransactionIsolatorNonJtaImpl.getIsolatedConnection(DdlTransactionIsolatorNonJtaImpl.java:74)
	at org.hibernate.resource.transaction.backend.jdbc.internal.DdlTransactionIsolatorNonJtaImpl.getIsolatedConnection(DdlTransactionIsolatorNonJtaImpl.java:39)
	at org.hibernate.tool.schema.internal.exec.ImprovedExtractionContextImpl.getJdbcConnection(ImprovedExtractionContextImpl.java:63)
	at org.hibernate.tool.schema.extract.spi.ExtractionContext.getQueryResults(ExtractionContext.java:43)
	at org.hibernate.tool.schema.extract.internal.SequenceInformationExtractorLegacyImpl.extractMetadata(SequenceInformationExtractorLegacyImpl.java:39)
	at org.hibernate.tool.schema.extract.internal.DatabaseInformationImpl.initializeSequences(DatabaseInformationImpl.java:66)
	at org.hibernate.tool.schema.extract.internal.DatabaseInformationImpl.<init>(DatabaseInformationImpl.java:60)
	at org.hibernate.tool.schema.internal.Helper.buildDatabaseInformation(Helper.java:185)
	at org.hibernate.tool.schema.internal.AbstractSchemaMigrator.doMigration(AbstractSchemaMigrator.java:98)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.performDatabaseAction(SchemaManagementToolCoordinator.java:286)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.lambda$process$5(SchemaManagementToolCoordinator.java:145)
	at java.base/java.util.HashMap.forEach(HashMap.java:1429)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.process(SchemaManagementToolCoordinator.java:142)
	at org.hibernate.boot.internal.SessionFactoryObserverForSchemaExport.sessionFactoryCreated(SessionFactoryObserverForSchemaExport.java:37)
	at org.hibernate.internal.SessionFactoryObserverChain.sessionFactoryCreated(SessionFactoryObserverChain.java:35)
	at org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:295)
	at org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:450)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1507)
	at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:75)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:376)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409)
	... 20 common frames omitted
Caused by: org.postgresql.util.PSQLException: Connection to localhost:5432 refused. Check that the hostname and port are correct and that the postmaster is accepting TCP/IP connections.
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:342)
	at org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:54)
	at org.postgresql.jdbc.PgConnection.<init>(PgConnection.java:263)
	at org.postgresql.Driver.makeConnection(Driver.java:443)
	at org.postgresql.Driver.connect(Driver.java:297)
	at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:138)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:359)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:201)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:470)
	at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:561)
	at com.zaxxer.hikari.pool.HikariPool.<init>(HikariPool.java:100)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:112)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator$ConnectionProviderJdbcConnectionAccess.obtainConnection(JdbcEnvironmentInitiator.java:424)
	at org.hibernate.resource.transaction.backend.jdbc.internal.DdlTransactionIsolatorNonJtaImpl.getIsolatedConnection(DdlTransactionIsolatorNonJtaImpl.java:46)
	... 40 common frames omitted
Caused by: java.net.ConnectException: Conexão recusada
	at java.base/sun.nio.ch.Net.pollConnect(Native Method)
	at java.base/sun.nio.ch.Net.pollConnectNow(Net.java:682)
	at java.base/sun.nio.ch.NioSocketImpl.timedFinishConnect(NioSocketImpl.java:542)
	at java.base/sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:592)
	at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:327)
	at java.base/java.net.Socket.connect(Socket.java:751)
	at org.postgresql.core.PGStream.createSocket(PGStream.java:243)
	at org.postgresql.core.PGStream.<init>(PGStream.java:98)
	at org.postgresql.core.v3.ConnectionFactoryImpl.tryConnect(ConnectionFactoryImpl.java:132)
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:258)
	... 54 common frames omitted
2025-10-15 19:27:15,841 [main] INFO  c.f.pixwallet.PixWalletApplication - Starting PixWalletApplication using Java 21.0.7 with PID 477550 (/home/ramon/Documentos/code/other/finaya/target/classes started by ramon in /home/ramon/Documentos/code/other/finaya)
2025-10-15 19:27:15,842 [main] INFO  c.f.pixwallet.PixWalletApplication - No active profile set, falling back to 1 default profile: "default"
2025-10-15 19:27:16,162 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:27:16,163 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-10-15 19:27:16,226 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 59 ms. Found 4 JPA repository interfaces.
2025-10-15 19:27:16,387 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:27:16,387 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-15 19:27:16,401 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.IdempotencyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:27:16,401 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixKeyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:27:16,401 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixTransferRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:27:16,401 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.WalletRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:27:16,401 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-10-15 19:27:16,879 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-15 19:27:16,883 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-15 19:27:16,883 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-15 19:27:16,907 [main] INFO  o.a.c.c.C.[.[localhost].[/api/v1] - Initializing Spring embedded WebApplicationContext
2025-10-15 19:27:16,907 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1040 ms
2025-10-15 19:27:17,134 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-10-15 19:27:17,157 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-10-15 19:27:17,172 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-10-15 19:27:17,269 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-10-15 19:27:17,281 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-15 19:27:18,336 [main] ERROR com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Exception during pool initialization.
org.postgresql.util.PSQLException: FATAL: password authentication failed for user "pixwallet"
	at org.postgresql.core.v3.ConnectionFactoryImpl.doAuthentication(ConnectionFactoryImpl.java:693)
	at org.postgresql.core.v3.ConnectionFactoryImpl.tryConnect(ConnectionFactoryImpl.java:203)
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:258)
	at org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:54)
	at org.postgresql.jdbc.PgConnection.<init>(PgConnection.java:263)
	at org.postgresql.Driver.makeConnection(Driver.java:443)
	at org.postgresql.Driver.connect(Driver.java:297)
	at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:138)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:359)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:201)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:470)
	at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:561)
	at com.zaxxer.hikari.pool.HikariPool.<init>(HikariPool.java:100)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:112)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator$ConnectionProviderJdbcConnectionAccess.obtainConnection(JdbcEnvironmentInitiator.java:424)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcIsolationDelegate.delegateWork(JdbcIsolationDelegate.java:61)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.getJdbcEnvironmentUsingJdbcMetadata(JdbcEnvironmentInitiator.java:273)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:105)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:66)
	at org.hibernate.boot.registry.internal.StandardServiceRegistryImpl.initiateService(StandardServiceRegistryImpl.java:129)
	at org.hibernate.service.internal.AbstractServiceRegistryImpl.createService(AbstractServiceRegistryImpl.java:263)
	at org.hibernate.service.internal.AbstractServiceRegistryImpl.initializeService(AbstractServiceRegistryImpl.java:238)
	at org.hibernate.service.internal.AbstractServiceRegistryImpl.getService(AbstractServiceRegistryImpl.java:215)
	at org.hibernate.boot.model.relational.Database.<init>(Database.java:45)
	at org.hibernate.boot.internal.InFlightMetadataCollectorImpl.getDatabase(InFlightMetadataCollectorImpl.java:223)
	at org.hibernate.boot.internal.InFlightMetadataCollectorImpl.<init>(InFlightMetadataCollectorImpl.java:191)
	at org.hibernate.boot.model.process.spi.MetadataBuildingProcess.complete(MetadataBuildingProcess.java:169)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.metadata(EntityManagerFactoryBuilderImpl.java:1432)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1503)
	at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:75)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:376)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1822)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1771)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1173)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:936)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.finaya.pixwallet.PixWalletApplication.main(PixWalletApplication.java:16)
2025-10-15 19:27:18,339 [main] WARN  o.h.e.j.e.i.JdbcEnvironmentInitiator - HHH000342: Could not obtain connection to query metadata
java.lang.NullPointerException: Cannot invoke "org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(java.sql.SQLException, String)" because the return value of "org.hibernate.resource.transaction.backend.jdbc.internal.JdbcIsolationDelegate.sqlExceptionHelper()" is null
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcIsolationDelegate.delegateWork(JdbcIsolationDelegate.java:116)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.getJdbcEnvironmentUsingJdbcMetadata(JdbcEnvironmentInitiator.java:273)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:105)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator.initiateService(JdbcEnvironmentInitiator.java:66)
	at org.hibernate.boot.registry.internal.StandardServiceRegistryImpl.initiateService(StandardServiceRegistryImpl.java:129)
	at org.hibernate.service.internal.AbstractServiceRegistryImpl.createService(AbstractServiceRegistryImpl.java:263)
	at org.hibernate.service.internal.AbstractServiceRegistryImpl.initializeService(AbstractServiceRegistryImpl.java:238)
	at org.hibernate.service.internal.AbstractServiceRegistryImpl.getService(AbstractServiceRegistryImpl.java:215)
	at org.hibernate.boot.model.relational.Database.<init>(Database.java:45)
	at org.hibernate.boot.internal.InFlightMetadataCollectorImpl.getDatabase(InFlightMetadataCollectorImpl.java:223)
	at org.hibernate.boot.internal.InFlightMetadataCollectorImpl.<init>(InFlightMetadataCollectorImpl.java:191)
	at org.hibernate.boot.model.process.spi.MetadataBuildingProcess.complete(MetadataBuildingProcess.java:169)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.metadata(EntityManagerFactoryBuilderImpl.java:1432)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1503)
	at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:75)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:376)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1822)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1771)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1173)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:936)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.finaya.pixwallet.PixWalletApplication.main(PixWalletApplication.java:16)
2025-10-15 19:27:18,348 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-15 19:27:18,776 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-10-15 19:27:18,785 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-15 19:27:19,795 [main] ERROR com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Exception during pool initialization.
org.postgresql.util.PSQLException: FATAL: password authentication failed for user "pixwallet"
	at org.postgresql.core.v3.ConnectionFactoryImpl.doAuthentication(ConnectionFactoryImpl.java:693)
	at org.postgresql.core.v3.ConnectionFactoryImpl.tryConnect(ConnectionFactoryImpl.java:203)
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:258)
	at org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:54)
	at org.postgresql.jdbc.PgConnection.<init>(PgConnection.java:263)
	at org.postgresql.Driver.makeConnection(Driver.java:443)
	at org.postgresql.Driver.connect(Driver.java:297)
	at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:138)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:359)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:201)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:470)
	at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:561)
	at com.zaxxer.hikari.pool.HikariPool.<init>(HikariPool.java:100)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:112)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator$ConnectionProviderJdbcConnectionAccess.obtainConnection(JdbcEnvironmentInitiator.java:424)
	at org.hibernate.resource.transaction.backend.jdbc.internal.DdlTransactionIsolatorNonJtaImpl.getIsolatedConnection(DdlTransactionIsolatorNonJtaImpl.java:46)
	at org.hibernate.resource.transaction.backend.jdbc.internal.DdlTransactionIsolatorNonJtaImpl.getIsolatedConnection(DdlTransactionIsolatorNonJtaImpl.java:39)
	at org.hibernate.tool.schema.internal.exec.ImprovedExtractionContextImpl.getJdbcConnection(ImprovedExtractionContextImpl.java:63)
	at org.hibernate.tool.schema.extract.spi.ExtractionContext.getQueryResults(ExtractionContext.java:43)
	at org.hibernate.tool.schema.extract.internal.SequenceInformationExtractorLegacyImpl.extractMetadata(SequenceInformationExtractorLegacyImpl.java:39)
	at org.hibernate.tool.schema.extract.internal.DatabaseInformationImpl.initializeSequences(DatabaseInformationImpl.java:66)
	at org.hibernate.tool.schema.extract.internal.DatabaseInformationImpl.<init>(DatabaseInformationImpl.java:60)
	at org.hibernate.tool.schema.internal.Helper.buildDatabaseInformation(Helper.java:185)
	at org.hibernate.tool.schema.internal.AbstractSchemaMigrator.doMigration(AbstractSchemaMigrator.java:98)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.performDatabaseAction(SchemaManagementToolCoordinator.java:286)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.lambda$process$5(SchemaManagementToolCoordinator.java:145)
	at java.base/java.util.HashMap.forEach(HashMap.java:1429)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.process(SchemaManagementToolCoordinator.java:142)
	at org.hibernate.boot.internal.SessionFactoryObserverForSchemaExport.sessionFactoryCreated(SessionFactoryObserverForSchemaExport.java:37)
	at org.hibernate.internal.SessionFactoryObserverChain.sessionFactoryCreated(SessionFactoryObserverChain.java:35)
	at org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:295)
	at org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:450)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1507)
	at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:75)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:376)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1822)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1771)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1173)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:936)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.finaya.pixwallet.PixWalletApplication.main(PixWalletApplication.java:16)
2025-10-15 19:27:19,798 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 0, SQLState: 28P01
2025-10-15 19:27:19,798 [main] ERROR o.h.e.jdbc.spi.SqlExceptionHelper - FATAL: password authentication failed for user "pixwallet"
2025-10-15 19:27:19,800 [main] ERROR o.s.o.j.LocalContainerEntityManagerFactoryBean - Failed to initialize JPA EntityManagerFactory: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.exception.GenericJDBCException: Unable to open JDBC Connection for DDL execution [FATAL: password authentication failed for user "pixwallet"] [n/a]
2025-10-15 19:27:19,801 [main] WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.exception.GenericJDBCException: Unable to open JDBC Connection for DDL execution [FATAL: password authentication failed for user "pixwallet"] [n/a]
2025-10-15 19:27:19,802 [main] INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-10-15 19:27:19,810 [main] INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-10-15 19:27:19,818 [main] ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.exception.GenericJDBCException: Unable to open JDBC Connection for DDL execution [FATAL: password authentication failed for user "pixwallet"] [n/a]
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1775)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:601)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:523)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:325)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:323)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1173)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:936)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:616)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:455)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:323)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.finaya.pixwallet.PixWalletApplication.main(PixWalletApplication.java:16)
Caused by: jakarta.persistence.PersistenceException: [PersistenceUnit: default] Unable to build Hibernate SessionFactory; nested exception is org.hibernate.exception.GenericJDBCException: Unable to open JDBC Connection for DDL execution [FATAL: password authentication failed for user "pixwallet"] [n/a]
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:421)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:352)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1822)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1771)
	... 16 common frames omitted
Caused by: org.hibernate.exception.GenericJDBCException: Unable to open JDBC Connection for DDL execution [FATAL: password authentication failed for user "pixwallet"] [n/a]
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:63)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:94)
	at org.hibernate.resource.transaction.backend.jdbc.internal.DdlTransactionIsolatorNonJtaImpl.getIsolatedConnection(DdlTransactionIsolatorNonJtaImpl.java:74)
	at org.hibernate.resource.transaction.backend.jdbc.internal.DdlTransactionIsolatorNonJtaImpl.getIsolatedConnection(DdlTransactionIsolatorNonJtaImpl.java:39)
	at org.hibernate.tool.schema.internal.exec.ImprovedExtractionContextImpl.getJdbcConnection(ImprovedExtractionContextImpl.java:63)
	at org.hibernate.tool.schema.extract.spi.ExtractionContext.getQueryResults(ExtractionContext.java:43)
	at org.hibernate.tool.schema.extract.internal.SequenceInformationExtractorLegacyImpl.extractMetadata(SequenceInformationExtractorLegacyImpl.java:39)
	at org.hibernate.tool.schema.extract.internal.DatabaseInformationImpl.initializeSequences(DatabaseInformationImpl.java:66)
	at org.hibernate.tool.schema.extract.internal.DatabaseInformationImpl.<init>(DatabaseInformationImpl.java:60)
	at org.hibernate.tool.schema.internal.Helper.buildDatabaseInformation(Helper.java:185)
	at org.hibernate.tool.schema.internal.AbstractSchemaMigrator.doMigration(AbstractSchemaMigrator.java:98)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.performDatabaseAction(SchemaManagementToolCoordinator.java:286)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.lambda$process$5(SchemaManagementToolCoordinator.java:145)
	at java.base/java.util.HashMap.forEach(HashMap.java:1429)
	at org.hibernate.tool.schema.spi.SchemaManagementToolCoordinator.process(SchemaManagementToolCoordinator.java:142)
	at org.hibernate.boot.internal.SessionFactoryObserverForSchemaExport.sessionFactoryCreated(SessionFactoryObserverForSchemaExport.java:37)
	at org.hibernate.internal.SessionFactoryObserverChain.sessionFactoryCreated(SessionFactoryObserverChain.java:35)
	at org.hibernate.internal.SessionFactoryImpl.<init>(SessionFactoryImpl.java:295)
	at org.hibernate.boot.internal.SessionFactoryBuilderImpl.build(SessionFactoryBuilderImpl.java:450)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1507)
	at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:75)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:376)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409)
	... 20 common frames omitted
Caused by: org.postgresql.util.PSQLException: FATAL: password authentication failed for user "pixwallet"
	at org.postgresql.core.v3.ConnectionFactoryImpl.doAuthentication(ConnectionFactoryImpl.java:693)
	at org.postgresql.core.v3.ConnectionFactoryImpl.tryConnect(ConnectionFactoryImpl.java:203)
	at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:258)
	at org.postgresql.core.ConnectionFactory.openConnection(ConnectionFactory.java:54)
	at org.postgresql.jdbc.PgConnection.<init>(PgConnection.java:263)
	at org.postgresql.Driver.makeConnection(Driver.java:443)
	at org.postgresql.Driver.connect(Driver.java:297)
	at com.zaxxer.hikari.util.DriverDataSource.getConnection(DriverDataSource.java:138)
	at com.zaxxer.hikari.pool.PoolBase.newConnection(PoolBase.java:359)
	at com.zaxxer.hikari.pool.PoolBase.newPoolEntry(PoolBase.java:201)
	at com.zaxxer.hikari.pool.HikariPool.createPoolEntry(HikariPool.java:470)
	at com.zaxxer.hikari.pool.HikariPool.checkFailFast(HikariPool.java:561)
	at com.zaxxer.hikari.pool.HikariPool.<init>(HikariPool.java:100)
	at com.zaxxer.hikari.HikariDataSource.getConnection(HikariDataSource.java:112)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.getConnection(DatasourceConnectionProviderImpl.java:122)
	at org.hibernate.engine.jdbc.env.internal.JdbcEnvironmentInitiator$ConnectionProviderJdbcConnectionAccess.obtainConnection(JdbcEnvironmentInitiator.java:424)
	at org.hibernate.resource.transaction.backend.jdbc.internal.DdlTransactionIsolatorNonJtaImpl.getIsolatedConnection(DdlTransactionIsolatorNonJtaImpl.java:46)
	... 40 common frames omitted
2025-10-15 19:33:01,159 [main] INFO  c.f.pixwallet.PixWalletApplication - Starting PixWalletApplication using Java 21.0.7 with PID 481656 (/home/ramon/Documentos/code/other/finaya/target/classes started by ramon in /home/ramon/Documentos/code/other/finaya)
2025-10-15 19:33:01,160 [main] INFO  c.f.pixwallet.PixWalletApplication - The following 1 profile is active: "docker"
2025-10-15 19:33:01,485 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:33:01,485 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-10-15 19:33:01,551 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 61 ms. Found 4 JPA repository interfaces.
2025-10-15 19:33:01,700 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:33:01,700 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-15 19:33:01,713 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.IdempotencyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:33:01,713 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixKeyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:33:01,714 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixTransferRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:33:01,714 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.WalletRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:33:01,714 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-10-15 19:33:02,193 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-15 19:33:02,198 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-15 19:33:02,198 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-15 19:33:02,224 [main] INFO  o.a.c.c.C.[.[localhost].[/api/v1] - Initializing Spring embedded WebApplicationContext
2025-10-15 19:33:02,224 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1039 ms
2025-10-15 19:33:02,461 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-10-15 19:33:02,485 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-10-15 19:33:02,499 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-10-15 19:33:02,596 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-10-15 19:33:02,607 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-15 19:33:02,688 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@c697186
2025-10-15 19:33:02,689 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-15 19:33:02,713 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-15 19:33:03,157 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-10-15 19:33:03,228 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-10-15 19:33:03,228 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "idx_transfer_end_to_end_id" of relation "pix_transfers" does not exist, skipping
2025-10-15 19:33:03,246 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Warning Code: 0, SQLState: 00000
2025-10-15 19:33:03,246 [main] WARN  o.h.e.jdbc.spi.SqlExceptionHelper - constraint "idx_transfer_idempotency_key" of relation "pix_transfers" does not exist, skipping
2025-10-15 19:33:03,282 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:33:03,601 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-10-15 19:33:04,533 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-15 19:33:05,233 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 4 endpoint(s) beneath base path '/actuator'
2025-10-15 19:33:05,284 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api/v1'
2025-10-15 19:33:05,290 [main] INFO  c.f.pixwallet.PixWalletApplication - Started PixWalletApplication in 4.363 seconds (process running for 4.523)
2025-10-15 19:33:39,399 [http-nio-8080-exec-2] INFO  o.a.c.c.C.[.[localhost].[/api/v1] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-15 19:33:39,399 [http-nio-8080-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-15 19:33:39,400 [http-nio-8080-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-10-15 19:35:37,310 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:35:37,312 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-15 19:35:37,314 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-15 19:35:43,576 [main] INFO  c.f.pixwallet.PixWalletApplication - Starting PixWalletApplication using Java 21.0.7 with PID 483017 (/home/ramon/Documentos/code/other/finaya/target/classes started by ramon in /home/ramon/Documentos/code/other/finaya)
2025-10-15 19:35:43,577 [main] INFO  c.f.pixwallet.PixWalletApplication - The following 1 profile is active: "docker"
2025-10-15 19:35:43,867 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:35:43,868 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-10-15 19:35:43,931 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 59 ms. Found 4 JPA repository interfaces.
2025-10-15 19:35:44,083 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:35:44,084 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-15 19:35:44,096 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.IdempotencyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:35:44,097 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixKeyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:35:44,097 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixTransferRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:35:44,097 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.WalletRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:35:44,097 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-10-15 19:35:44,597 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-15 19:35:44,602 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-15 19:35:44,602 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-15 19:35:44,627 [main] INFO  o.a.c.c.C.[.[localhost].[/api/v1] - Initializing Spring embedded WebApplicationContext
2025-10-15 19:35:44,628 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 1026 ms
2025-10-15 19:35:44,856 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-10-15 19:35:44,879 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-10-15 19:35:44,895 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-10-15 19:35:45,009 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-10-15 19:35:45,022 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-15 19:35:45,101 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@29ba63f0
2025-10-15 19:35:45,102 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-15 19:35:45,117 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-15 19:35:45,621 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-10-15 19:35:45,691 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:35:46,020 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-10-15 19:35:46,977 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-15 19:35:47,674 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 4 endpoint(s) beneath base path '/actuator'
2025-10-15 19:35:47,725 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api/v1'
2025-10-15 19:35:47,731 [main] INFO  c.f.pixwallet.PixWalletApplication - Started PixWalletApplication in 4.386 seconds (process running for 4.552)
2025-10-15 19:35:49,611 [http-nio-8080-exec-2] INFO  o.a.c.c.C.[.[localhost].[/api/v1] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-15 19:35:49,612 [http-nio-8080-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-15 19:35:49,613 [http-nio-8080-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-10-15 19:35:58,990 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:35:58,992 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-15 19:35:58,993 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-15 19:36:19,129 [main] INFO  c.f.pixwallet.PixWalletApplication - Starting PixWalletApplication using Java 21.0.7 with PID 484099 (/home/ramon/Documentos/code/other/finaya/target/classes started by ramon in /home/ramon/Documentos/code/other/finaya)
2025-10-15 19:36:19,130 [main] INFO  c.f.pixwallet.PixWalletApplication - The following 1 profile is active: "docker"
2025-10-15 19:36:19,420 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:36:19,420 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-10-15 19:36:19,481 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 57 ms. Found 4 JPA repository interfaces.
2025-10-15 19:36:19,626 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:36:19,627 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-15 19:36:19,639 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.IdempotencyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:36:19,639 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixKeyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:36:19,640 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixTransferRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:36:19,640 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.WalletRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:36:19,640 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-10-15 19:36:20,116 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-15 19:36:20,120 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-15 19:36:20,121 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-15 19:36:20,145 [main] INFO  o.a.c.c.C.[.[localhost].[/api/v1] - Initializing Spring embedded WebApplicationContext
2025-10-15 19:36:20,145 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 992 ms
2025-10-15 19:36:20,382 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-10-15 19:36:20,405 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-10-15 19:36:20,420 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-10-15 19:36:20,517 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-10-15 19:36:20,529 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-15 19:36:20,608 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3cc74fc4
2025-10-15 19:36:20,609 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-15 19:36:20,624 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: PostgreSQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-15 19:36:21,091 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-10-15 19:36:21,155 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:36:21,481 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-10-15 19:36:22,420 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-15 19:36:23,081 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 4 endpoint(s) beneath base path '/actuator'
2025-10-15 19:36:23,131 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api/v1'
2025-10-15 19:36:23,136 [main] INFO  c.f.pixwallet.PixWalletApplication - Started PixWalletApplication in 4.246 seconds (process running for 4.411)
2025-10-15 19:36:26,835 [http-nio-8080-exec-2] INFO  o.a.c.c.C.[.[localhost].[/api/v1] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-15 19:36:26,835 [http-nio-8080-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-15 19:36:26,836 [http-nio-8080-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-10-15 19:37:41,890 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:37:41,891 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-15 19:37:41,893 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-15 19:38:00,487 [main] INFO  c.f.pixwallet.PixWalletApplication - Starting PixWalletApplication using Java 21.0.7 with PID 485271 (/home/ramon/Documentos/code/other/finaya/target/classes started by ramon in /home/ramon/Documentos/code/other/finaya)
2025-10-15 19:38:00,488 [main] INFO  c.f.pixwallet.PixWalletApplication - The following 1 profile is active: "local"
2025-10-15 19:38:00,780 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:38:00,780 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-10-15 19:38:00,841 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 57 ms. Found 4 JPA repository interfaces.
2025-10-15 19:38:00,987 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:38:00,988 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-15 19:38:01,002 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.IdempotencyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:38:01,002 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixKeyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:38:01,002 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixTransferRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:38:01,002 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.WalletRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:38:01,003 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2025-10-15 19:38:01,479 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-15 19:38:01,483 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-15 19:38:01,484 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-15 19:38:01,508 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-15 19:38:01,508 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 994 ms
2025-10-15 19:38:01,728 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-10-15 19:38:01,751 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-10-15 19:38:01,766 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-10-15 19:38:01,863 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-10-15 19:38:01,875 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-15 19:38:01,963 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:pixwallet user=SA
2025-10-15 19:38:01,964 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-15 19:38:01,975 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-15 19:38:02,417 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-10-15 19:38:02,444 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:38:02,763 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-10-15 19:38:03,678 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-15 19:38:04,382 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-15 19:38:04,435 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-15 19:38:04,441 [main] INFO  c.f.pixwallet.PixWalletApplication - Started PixWalletApplication in 4.182 seconds (process running for 4.343)
2025-10-15 19:38:06,983 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-15 19:38:06,983 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-15 19:38:06,984 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-10-15 19:38:20,372 [http-nio-8080-exec-3] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.createWallet
2025-10-15 19:38:20,372 [http-nio-8080-exec-3] INFO  c.f.p.a.controller.WalletController - Creating wallet for user: user123
2025-10-15 19:38:20,378 [http-nio-8080-exec-3] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #1 for user: user123
2025-10-15 19:38:20,440 [http-nio-8080-exec-3] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #1 created successfully - ID: ba752447-e1c8-4e84-9d85-5f1dfb784a60, User: user123
2025-10-15 19:38:20,441 [http-nio-8080-exec-3] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"1c0533ad-725c-46a1-9578-0ed3d4ebe2c4","correlationId":"1c0533ad-725c-46a1-9578-0ed3d4ebe2c4","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":62,"transactionId":"TX-1760571500377-62","timestamp":"2025-10-15T19:38:20.440903037"}
2025-10-15 19:38:20,458 [http-nio-8080-exec-3] INFO  c.f.p.a.controller.WalletController - Wallet created successfully - ID: ba752447-e1c8-4e84-9d85-5f1dfb784a60, User: user123
2025-10-15 19:38:20,459 [http-nio-8080-exec-3] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"850cca3a-eae0-43e1-9c97-ad2d4b78c19f","event":"performance_metric","operation":"HTTP.WalletController.createWallet","durationMs":87,"timestamp":"2025-10-15T19:38:20.459367346"}
2025-10-15 19:38:20,459 [http-nio-8080-exec-3] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.createWallet in 87ms
2025-10-15 19:38:36,970 [http-nio-8080-exec-4] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.getBalance
2025-10-15 19:38:36,980 [http-nio-8080-exec-4] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"6d785d16-d004-4242-844e-4fb51e758326","correlationId":"6d785d16-d004-4242-844e-4fb51e758326","event":"performance_metric","operation":"WalletUseCase.getBalance","durationMs":10,"transactionId":"TX-1760571516970-63","timestamp":"2025-10-15T19:38:36.980326055"}
2025-10-15 19:38:36,981 [http-nio-8080-exec-4] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"8558d442-39b1-4ebd-9e46-cbc19e602dae","event":"performance_metric","operation":"HTTP.WalletController.getBalance","durationMs":10,"timestamp":"2025-10-15T19:38:36.980995632"}
2025-10-15 19:38:36,981 [http-nio-8080-exec-4] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.getBalance in 10ms
2025-10-15 19:38:48,551 [http-nio-8080-exec-5] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.deposit
2025-10-15 19:38:48,551 [http-nio-8080-exec-5] INFO  c.f.p.a.controller.WalletController - Processing deposit for wallet: ba752447-e1c8-4e84-9d85-5f1dfb784a60 - Amount: 100.50
2025-10-15 19:38:48,559 [http-nio-8080-exec-5] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic deposit #1 - Wallet: ba752447-e1c8-4e84-9d85-5f1dfb784a60, Amount: R$ 100,50, Description: Initial deposit
2025-10-15 19:38:48,571 [http-nio-8080-exec-5] INFO  c.f.p.a.usecase.WalletUseCase - Atomic deposit processed successfully - Deposit #1, Wallet: ba752447-e1c8-4e84-9d85-5f1dfb784a60, Amount: R$ 100,50, Balance: R$ 0,00 -> R$ 100,50
2025-10-15 19:38:48,571 [http-nio-8080-exec-5] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"5fd8b346-602b-477a-9f9e-5845f08e0262","correlationId":"5fd8b346-602b-477a-9f9e-5845f08e0262","event":"performance_metric","operation":"WalletUseCase.deposit","durationMs":13,"transactionId":"TX-1760571528558-64","timestamp":"2025-10-15T19:38:48.571522334"}
2025-10-15 19:38:48,579 [http-nio-8080-exec-5] INFO  c.f.p.a.controller.WalletController - Deposit processed successfully for wallet: ba752447-e1c8-4e84-9d85-5f1dfb784a60 - Amount: 100.50
2025-10-15 19:38:48,579 [http-nio-8080-exec-5] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"552bb5c3-cdd6-4cf7-8a43-b2782522d71f","event":"performance_metric","operation":"HTTP.WalletController.deposit","durationMs":28,"timestamp":"2025-10-15T19:38:48.579623827"}
2025-10-15 19:38:48,579 [http-nio-8080-exec-5] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.deposit in 28ms
2025-10-15 19:38:51,207 [http-nio-8080-exec-6] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.getBalance
2025-10-15 19:38:51,209 [http-nio-8080-exec-6] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"5c10780c-76b8-40eb-ad50-9bb7cebb93b5","correlationId":"5c10780c-76b8-40eb-ad50-9bb7cebb93b5","event":"performance_metric","operation":"WalletUseCase.getBalance","durationMs":1,"transactionId":"TX-1760571531207-65","timestamp":"2025-10-15T19:38:51.208921529"}
2025-10-15 19:38:51,209 [http-nio-8080-exec-6] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"5c8e98d7-ee47-4b79-b0ab-d2d6ea3cce9d","event":"performance_metric","operation":"HTTP.WalletController.getBalance","durationMs":2,"timestamp":"2025-10-15T19:38:51.209491147"}
2025-10-15 19:38:51,209 [http-nio-8080-exec-6] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.getBalance in 2ms
2025-10-15 19:39:01,863 [http-nio-8080-exec-7] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.registerPixKey
2025-10-15 19:39:01,863 [http-nio-8080-exec-7] INFO  c.f.p.a.controller.WalletController - Registering Pix key for wallet: ba752447-e1c8-4e84-9d85-5f1dfb784a60 - Key: user@example.com, Type: EMAIL
2025-10-15 19:39:01,864 [http-nio-8080-exec-7] INFO  c.f.p.a.usecase.WalletUseCase - Registering Pix key #1 for wallet: ba752447-e1c8-4e84-9d85-5f1dfb784a60 - Key: user@example.com, Type: EMAIL
2025-10-15 19:39:01,874 [http-nio-8080-exec-7] INFO  c.f.p.a.usecase.WalletUseCase - Pix key #1 registered successfully - ID: 87c2a473-89cc-4a99-8e49-474fec36311d, Key: user@example.com
2025-10-15 19:39:01,874 [http-nio-8080-exec-7] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"2ccc868a-1bfb-469f-9e59-24dc6b0f0c6a","correlationId":"2ccc868a-1bfb-469f-9e59-24dc6b0f0c6a","event":"performance_metric","operation":"WalletUseCase.registerPixKey","durationMs":11,"transactionId":"TX-1760571541863-66","timestamp":"2025-10-15T19:39:01.874172085"}
2025-10-15 19:39:01,876 [http-nio-8080-exec-7] INFO  c.f.p.a.controller.WalletController - Pix key registered successfully - ID: 87c2a473-89cc-4a99-8e49-474fec36311d, Key: user@example.com
2025-10-15 19:39:01,876 [http-nio-8080-exec-7] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"15f22220-6b44-4480-8bbe-d35e8a669d5a","event":"performance_metric","operation":"HTTP.WalletController.registerPixKey","durationMs":13,"timestamp":"2025-10-15T19:39:01.876867387"}
2025-10-15 19:39:01,877 [http-nio-8080-exec-7] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.registerPixKey in 13ms
2025-10-15 19:39:59,549 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:39:59,554 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-15 19:39:59,555 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-15 19:40:49,892 [main] INFO  c.f.pixwallet.PixWalletApplication - Starting PixWalletApplication using Java 21.0.7 with PID 486901 (/home/ramon/Documentos/code/other/finaya/target/classes started by ramon in /home/ramon/Documentos/code/other/finaya)
2025-10-15 19:40:49,894 [main] INFO  c.f.pixwallet.PixWalletApplication - The following 1 profile is active: "local"
2025-10-15 19:40:50,193 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:40:50,193 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-10-15 19:40:50,254 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 57 ms. Found 4 JPA repository interfaces.
2025-10-15 19:40:50,403 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:40:50,404 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-15 19:40:50,416 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.IdempotencyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:40:50,416 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixKeyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:40:50,416 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixTransferRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:40:50,416 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.WalletRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:40:50,417 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-10-15 19:40:50,877 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-15 19:40:50,881 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-15 19:40:50,882 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-15 19:40:50,906 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-15 19:40:50,906 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 987 ms
2025-10-15 19:40:51,152 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-10-15 19:40:51,175 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-10-15 19:40:51,190 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-10-15 19:40:51,289 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-10-15 19:40:51,308 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-15 19:40:51,417 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:pixwallet user=SA
2025-10-15 19:40:51,418 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-15 19:40:51,433 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-15 19:40:51,874 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-10-15 19:40:51,903 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:40:52,236 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-10-15 19:40:53,163 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-15 19:40:53,874 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-15 19:40:53,933 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-15 19:40:53,939 [main] INFO  c.f.pixwallet.PixWalletApplication - Started PixWalletApplication in 4.275 seconds (process running for 4.438)
2025-10-15 19:40:59,598 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-15 19:40:59,598 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-15 19:40:59,600 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-10-15 19:40:59,691 [http-nio-8080-exec-1] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.registerPixKey
2025-10-15 19:40:59,692 [http-nio-8080-exec-1] INFO  c.f.p.a.controller.WalletController - Registering Pix key for wallet: ba752447-e1c8-4e84-9d85-5f1dfb784a60 - Key: destination@example.com, Type: EMAIL
2025-10-15 19:40:59,698 [http-nio-8080-exec-1] INFO  c.f.p.a.usecase.WalletUseCase - Registering Pix key #1 for wallet: ba752447-e1c8-4e84-9d85-5f1dfb784a60 - Key: destination@example.com, Type: EMAIL
2025-10-15 19:40:59,766 [http-nio-8080-exec-1] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"IllegalArgumentException","errorMessage":"Wallet not found: ba752447-e1c8-4e84-9d85-5f1dfb784a60","context":{"duration":"61","args":"[ba752447-e1c8-4e84-9d85-5f1dfb784a60, destination@example.com, EMAIL]","methodName":"registerPixKey","className":"WalletUseCase"},"correlationId":"07186e08-7a75-4059-832b-2dcd4218c985","event":"error","operation":"WalletUseCase.registerPixKey","transactionId":"TX-1760571659697-60","timestamp":"2025-10-15T19:40:59.759883968"}
2025-10-15 19:40:59,766 [http-nio-8080-exec-1] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: WalletUseCase.registerPixKey after 61ms
java.lang.IllegalArgumentException: Wallet not found: ba752447-e1c8-4e84-9d85-5f1dfb784a60
	at com.finaya.pixwallet.application.usecase.WalletUseCase.lambda$registerPixKey$0(WalletUseCase.java:73)
	at java.base/java.util.Optional.orElseThrow(Optional.java:403)
	at com.finaya.pixwallet.application.usecase.WalletUseCase.registerPixKey(WalletUseCase.java:73)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:163)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.WalletUseCase$$SpringCGLIB$$0.registerPixKey(<generated>)
	at com.finaya.pixwallet.application.controller.WalletController.registerPixKey(WalletController.java:75)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at io.micrometer.core.aop.TimedAspect.processWithTimer(TimedAspect.java:227)
	at io.micrometer.core.aop.TimedAspect.perform(TimedAspect.java:202)
	at io.micrometer.core.aop.TimedAspect.timedMethod(TimedAspect.java:194)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logControllerExecution(LoggingAspect.java:120)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.controller.WalletController$$SpringCGLIB$$0.registerPixKey(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-15 19:40:59,768 [http-nio-8080-exec-1] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760571659697-60 for WalletUseCase.registerPixKey after 70ms - Wallet not found: ba752447-e1c8-4e84-9d85-5f1dfb784a60
2025-10-15 19:40:59,770 [http-nio-8080-exec-1] ERROR c.f.p.a.controller.WalletController - Failed to register Pix key for wallet ba752447-e1c8-4e84-9d85-5f1dfb784a60: Wallet not found: ba752447-e1c8-4e84-9d85-5f1dfb784a60
2025-10-15 19:40:59,772 [http-nio-8080-exec-1] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"b170fd23-f04b-4c4a-b8de-bbf4d464c36f","event":"performance_metric","operation":"HTTP.WalletController.registerPixKey","durationMs":79,"timestamp":"2025-10-15T19:40:59.771067423"}
2025-10-15 19:40:59,772 [http-nio-8080-exec-1] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.registerPixKey in 79ms
2025-10-15 19:41:08,736 [http-nio-8080-exec-4] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.getBalance
2025-10-15 19:41:08,738 [http-nio-8080-exec-4] ERROR com.finaya.pixwallet.error - Operation failed - {"errorType":"IllegalArgumentException","errorMessage":"Wallet not found: ba752447-e1c8-4e84-9d85-5f1dfb784a60","context":{"duration":"1","args":"[ba752447-e1c8-4e84-9d85-5f1dfb784a60]","methodName":"getBalance","className":"WalletUseCase"},"correlationId":"c1580cc7-246c-4f81-a054-d6a69890ed1e","event":"error","operation":"WalletUseCase.getBalance","transactionId":"TX-1760571668737-63","timestamp":"2025-10-15T19:41:08.738595532"}
2025-10-15 19:41:08,738 [http-nio-8080-exec-4] ERROR c.f.p.i.logging.LoggingAspect - Use case failed: WalletUseCase.getBalance after 1ms
java.lang.IllegalArgumentException: Wallet not found: ba752447-e1c8-4e84-9d85-5f1dfb784a60
	at com.finaya.pixwallet.application.usecase.WalletUseCase.lambda$getBalance$1(WalletUseCase.java:89)
	at java.base/java.util.Optional.orElseThrow(Optional.java:403)
	at com.finaya.pixwallet.application.usecase.WalletUseCase.getBalance(WalletUseCase.java:89)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logUseCaseExecution(LoggingAspect.java:38)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logTransactionalMethods(LoggingAspect.java:165)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:173)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:163)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.usecase.WalletUseCase$$SpringCGLIB$$0.getBalance(<generated>)
	at com.finaya.pixwallet.application.controller.WalletController.getBalance(WalletController.java:98)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at io.micrometer.core.aop.TimedAspect.processWithTimer(TimedAspect.java:227)
	at io.micrometer.core.aop.TimedAspect.perform(TimedAspect.java:202)
	at io.micrometer.core.aop.TimedAspect.timedMethod(TimedAspect.java:194)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:89)
	at com.finaya.pixwallet.infrastructure.logging.LoggingAspect.logControllerExecution(LoggingAspect.java:120)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:637)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:627)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:71)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.finaya.pixwallet.application.controller.WalletController$$SpringCGLIB$$0.getBalance(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:254)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:182)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-10-15 19:41:08,739 [http-nio-8080-exec-4] ERROR c.f.p.i.logging.LoggingAspect - Transaction failed: TX-1760571668737-63 for WalletUseCase.getBalance after 2ms - Wallet not found: ba752447-e1c8-4e84-9d85-5f1dfb784a60
2025-10-15 19:41:08,739 [http-nio-8080-exec-4] ERROR c.f.p.a.controller.WalletController - Failed to get balance for wallet ba752447-e1c8-4e84-9d85-5f1dfb784a60: Wallet not found: ba752447-e1c8-4e84-9d85-5f1dfb784a60
2025-10-15 19:41:08,740 [http-nio-8080-exec-4] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"63be171a-c869-45ca-be26-f83dfbad9c9e","event":"performance_metric","operation":"HTTP.WalletController.getBalance","durationMs":4,"timestamp":"2025-10-15T19:41:08.740127391"}
2025-10-15 19:41:08,740 [http-nio-8080-exec-4] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.getBalance in 4ms
2025-10-15 19:41:14,739 [http-nio-8080-exec-5] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.createWallet
2025-10-15 19:41:14,739 [http-nio-8080-exec-5] INFO  c.f.p.a.controller.WalletController - Creating wallet for user: user123
2025-10-15 19:41:14,739 [http-nio-8080-exec-5] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #1 for user: user123
2025-10-15 19:41:14,769 [http-nio-8080-exec-5] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #1 created successfully - ID: 4386cd82-917a-4b34-a1fe-03e323b472db, User: user123
2025-10-15 19:41:14,769 [http-nio-8080-exec-5] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"61ea8d08-7662-421c-9f49-af5ce21c5b5b","correlationId":"61ea8d08-7662-421c-9f49-af5ce21c5b5b","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":30,"transactionId":"TX-1760571674739-64","timestamp":"2025-10-15T19:41:14.769551843"}
2025-10-15 19:41:14,786 [http-nio-8080-exec-5] INFO  c.f.p.a.controller.WalletController - Wallet created successfully - ID: 4386cd82-917a-4b34-a1fe-03e323b472db, User: user123
2025-10-15 19:41:14,786 [http-nio-8080-exec-5] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"4e311c78-e2e6-4891-a6fe-5bf711fa50b2","event":"performance_metric","operation":"HTTP.WalletController.createWallet","durationMs":47,"timestamp":"2025-10-15T19:41:14.786863195"}
2025-10-15 19:41:14,787 [http-nio-8080-exec-5] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.createWallet in 47ms
2025-10-15 19:41:24,345 [http-nio-8080-exec-6] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.deposit
2025-10-15 19:41:24,345 [http-nio-8080-exec-6] INFO  c.f.p.a.controller.WalletController - Processing deposit for wallet: 4386cd82-917a-4b34-a1fe-03e323b472db - Amount: 100.50
2025-10-15 19:41:24,352 [http-nio-8080-exec-6] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic deposit #1 - Wallet: 4386cd82-917a-4b34-a1fe-03e323b472db, Amount: R$ 100,50, Description: Initial deposit
2025-10-15 19:41:24,367 [http-nio-8080-exec-6] INFO  c.f.p.a.usecase.WalletUseCase - Atomic deposit processed successfully - Deposit #1, Wallet: 4386cd82-917a-4b34-a1fe-03e323b472db, Amount: R$ 100,50, Balance: R$ 0,00 -> R$ 100,50
2025-10-15 19:41:24,367 [http-nio-8080-exec-6] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"0f50a0cc-3878-4fff-83ee-989d02f5c8f0","correlationId":"0f50a0cc-3878-4fff-83ee-989d02f5c8f0","event":"performance_metric","operation":"WalletUseCase.deposit","durationMs":15,"transactionId":"TX-1760571684351-65","timestamp":"2025-10-15T19:41:24.367733573"}
2025-10-15 19:41:24,376 [http-nio-8080-exec-6] INFO  c.f.p.a.controller.WalletController - Deposit processed successfully for wallet: 4386cd82-917a-4b34-a1fe-03e323b472db - Amount: 100.50
2025-10-15 19:41:24,377 [http-nio-8080-exec-6] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"2d814b05-b761-4370-ac4d-a4617aa81091","event":"performance_metric","operation":"HTTP.WalletController.deposit","durationMs":32,"timestamp":"2025-10-15T19:41:24.377054883"}
2025-10-15 19:41:24,377 [http-nio-8080-exec-6] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.deposit in 32ms
2025-10-15 19:41:30,573 [http-nio-8080-exec-7] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.registerPixKey
2025-10-15 19:41:30,574 [http-nio-8080-exec-7] INFO  c.f.p.a.controller.WalletController - Registering Pix key for wallet: 4386cd82-917a-4b34-a1fe-03e323b472db - Key: user@example.com, Type: EMAIL
2025-10-15 19:41:30,574 [http-nio-8080-exec-7] INFO  c.f.p.a.usecase.WalletUseCase - Registering Pix key #2 for wallet: 4386cd82-917a-4b34-a1fe-03e323b472db - Key: user@example.com, Type: EMAIL
2025-10-15 19:41:30,578 [http-nio-8080-exec-7] INFO  c.f.p.a.usecase.WalletUseCase - Pix key #2 registered successfully - ID: 7c01e993-7341-49c2-b324-fad31f8583c5, Key: user@example.com
2025-10-15 19:41:30,578 [http-nio-8080-exec-7] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"cb972bcf-4fb6-4748-9afe-435836ca199d","correlationId":"cb972bcf-4fb6-4748-9afe-435836ca199d","event":"performance_metric","operation":"WalletUseCase.registerPixKey","durationMs":4,"transactionId":"TX-1760571690574-66","timestamp":"2025-10-15T19:41:30.578153646"}
2025-10-15 19:41:30,580 [http-nio-8080-exec-7] INFO  c.f.p.a.controller.WalletController - Pix key registered successfully - ID: 7c01e993-7341-49c2-b324-fad31f8583c5, Key: user@example.com
2025-10-15 19:41:30,580 [http-nio-8080-exec-7] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"addb8961-8b7d-40b7-ade4-0166fa45eea9","event":"performance_metric","operation":"HTTP.WalletController.registerPixKey","durationMs":7,"timestamp":"2025-10-15T19:41:30.580847654"}
2025-10-15 19:41:30,580 [http-nio-8080-exec-7] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.registerPixKey in 7ms
2025-10-15 19:41:36,524 [http-nio-8080-exec-8] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.registerPixKey
2025-10-15 19:41:36,525 [http-nio-8080-exec-8] INFO  c.f.p.a.controller.WalletController - Registering Pix key for wallet: 4386cd82-917a-4b34-a1fe-03e323b472db - Key: user2@example.com, Type: EMAIL
2025-10-15 19:41:36,525 [http-nio-8080-exec-8] INFO  c.f.p.a.usecase.WalletUseCase - Registering Pix key #3 for wallet: 4386cd82-917a-4b34-a1fe-03e323b472db - Key: user2@example.com, Type: EMAIL
2025-10-15 19:41:36,527 [http-nio-8080-exec-8] INFO  c.f.p.a.usecase.WalletUseCase - Pix key #3 registered successfully - ID: d0f1c518-0634-47de-9d56-40787f7936ef, Key: user2@example.com
2025-10-15 19:41:36,528 [http-nio-8080-exec-8] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"9f600516-5521-443b-99a0-b1a21a78247f","correlationId":"9f600516-5521-443b-99a0-b1a21a78247f","event":"performance_metric","operation":"WalletUseCase.registerPixKey","durationMs":3,"transactionId":"TX-1760571696525-67","timestamp":"2025-10-15T19:41:36.528050293"}
2025-10-15 19:41:36,529 [http-nio-8080-exec-8] INFO  c.f.p.a.controller.WalletController - Pix key registered successfully - ID: d0f1c518-0634-47de-9d56-40787f7936ef, Key: user2@example.com
2025-10-15 19:41:36,529 [http-nio-8080-exec-8] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"eb0c12d2-9d22-45b3-a4c6-cbf204fd2357","event":"performance_metric","operation":"HTTP.WalletController.registerPixKey","durationMs":5,"timestamp":"2025-10-15T19:41:36.529265532"}
2025-10-15 19:41:36,529 [http-nio-8080-exec-8] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.registerPixKey in 5ms
2025-10-15 19:42:07,092 [http-nio-8080-exec-2] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.withdraw
2025-10-15 19:42:07,093 [http-nio-8080-exec-2] INFO  c.f.p.a.controller.WalletController - Processing withdrawal for wallet: 4386cd82-917a-4b34-a1fe-03e323b472db - Amount: 50.25
2025-10-15 19:42:07,093 [http-nio-8080-exec-2] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic withdrawal #1 - Wallet: 4386cd82-917a-4b34-a1fe-03e323b472db, Amount: R$ 50,25, Description: Emergency withdrawal
2025-10-15 19:42:07,096 [http-nio-8080-exec-2] INFO  c.f.p.a.usecase.WalletUseCase - Atomic withdrawal processed successfully - Withdrawal #1, Wallet: 4386cd82-917a-4b34-a1fe-03e323b472db, Amount: R$ 50,25, Balance: R$ 100,50 -> R$ 50,25
2025-10-15 19:42:07,097 [http-nio-8080-exec-2] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"9bdc154e-1c82-4ca8-9819-b46ffb64761c","correlationId":"9bdc154e-1c82-4ca8-9819-b46ffb64761c","event":"performance_metric","operation":"WalletUseCase.withdraw","durationMs":4,"transactionId":"TX-1760571727093-61","timestamp":"2025-10-15T19:42:07.09709292"}
2025-10-15 19:42:07,098 [http-nio-8080-exec-2] INFO  c.f.p.a.controller.WalletController - Withdrawal processed successfully for wallet: 4386cd82-917a-4b34-a1fe-03e323b472db - Amount: 50.25
2025-10-15 19:42:07,099 [http-nio-8080-exec-2] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"7d3d934f-8491-4de3-a2c0-83732f16b8e5","event":"performance_metric","operation":"HTTP.WalletController.withdraw","durationMs":7,"timestamp":"2025-10-15T19:42:07.099086593"}
2025-10-15 19:42:07,099 [http-nio-8080-exec-2] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.withdraw in 7ms
2025-10-15 19:42:10,888 [http-nio-8080-exec-1] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.getBalance
2025-10-15 19:42:10,889 [http-nio-8080-exec-1] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"85e55770-ce0f-4cd8-961c-f18eecac4569","correlationId":"85e55770-ce0f-4cd8-961c-f18eecac4569","event":"performance_metric","operation":"WalletUseCase.getBalance","durationMs":1,"transactionId":"TX-1760571730888-60","timestamp":"2025-10-15T19:42:10.889662128"}
2025-10-15 19:42:10,890 [http-nio-8080-exec-1] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"85b35cae-fdbe-4e88-bf21-fa7920710461","event":"performance_metric","operation":"HTTP.WalletController.getBalance","durationMs":3,"timestamp":"2025-10-15T19:42:10.890090108"}
2025-10-15 19:42:10,890 [http-nio-8080-exec-1] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.getBalance in 3ms
2025-10-15 19:44:02,437 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:44:02,441 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-15 19:44:02,442 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-10-15 19:44:06,706 [main] INFO  c.f.pixwallet.PixWalletApplication - Starting PixWalletApplication using Java 21.0.7 with PID 488599 (/home/ramon/Documentos/code/other/finaya/target/classes started by ramon in /home/ramon/Documentos/code/other/finaya)
2025-10-15 19:44:06,707 [main] INFO  c.f.pixwallet.PixWalletApplication - The following 1 profile is active: "local"
2025-10-15 19:44:07,002 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:44:07,002 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-10-15 19:44:07,064 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 58 ms. Found 4 JPA repository interfaces.
2025-10-15 19:44:07,211 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-10-15 19:44:07,212 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-10-15 19:44:07,224 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.IdempotencyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:44:07,224 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixKeyRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:44:07,225 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.PixTransferRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:44:07,225 [main] INFO  o.s.d.r.c.RepositoryConfigurationExtensionSupport - Spring Data Redis - Could not safely identify store assignment for repository candidate interface com.finaya.pixwallet.domain.repository.WalletRepository; If you want this repository to be a Redis repository, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (preferred), or consider extending one of the following types with your repository: org.springframework.data.keyvalue.repository.KeyValueRepository
2025-10-15 19:44:07,225 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-10-15 19:44:07,694 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-10-15 19:44:07,698 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-10-15 19:44:07,698 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-10-15 19:44:07,721 [main] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-10-15 19:44:07,721 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 990 ms
2025-10-15 19:44:07,937 [main] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-10-15 19:44:07,960 [main] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.3.1.Final
2025-10-15 19:44:07,975 [main] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-10-15 19:44:08,072 [main] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-10-15 19:44:08,083 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-10-15 19:44:08,170 [main] INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:pixwallet user=SA
2025-10-15 19:44:08,171 [main] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-10-15 19:44:08,182 [main] WARN  org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-10-15 19:44:08,633 [main] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-10-15 19:44:08,662 [main] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:44:08,977 [main] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2025-10-15 19:44:09,887 [main] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-10-15 19:44:10,573 [main] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-10-15 19:44:10,627 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path ''
2025-10-15 19:44:10,632 [main] INFO  c.f.pixwallet.PixWalletApplication - Started PixWalletApplication in 4.153 seconds (process running for 4.318)
2025-10-15 19:44:17,434 [http-nio-8080-exec-1] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-10-15 19:44:17,435 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-10-15 19:44:17,436 [http-nio-8080-exec-1] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-10-15 19:44:17,516 [http-nio-8080-exec-1] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.createWallet
2025-10-15 19:44:17,516 [http-nio-8080-exec-1] INFO  c.f.p.a.controller.WalletController - Creating wallet for user: user123
2025-10-15 19:44:17,522 [http-nio-8080-exec-1] INFO  c.f.p.a.usecase.WalletUseCase - Creating wallet #1 for user: user123
2025-10-15 19:44:17,580 [http-nio-8080-exec-1] INFO  c.f.p.a.usecase.WalletUseCase - Wallet #1 created successfully - ID: 5a93ffbb-7190-43be-b882-def03141fbb0, User: user123
2025-10-15 19:44:17,586 [http-nio-8080-exec-1] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"277e58a8-f268-4037-9a79-27af2d3fe038","correlationId":"277e58a8-f268-4037-9a79-27af2d3fe038","event":"performance_metric","operation":"WalletUseCase.createWallet","durationMs":58,"transactionId":"TX-1760571857521-60","timestamp":"2025-10-15T19:44:17.580503882"}
2025-10-15 19:44:17,603 [http-nio-8080-exec-1] INFO  c.f.p.a.controller.WalletController - Wallet created successfully - ID: 5a93ffbb-7190-43be-b882-def03141fbb0, User: user123
2025-10-15 19:44:17,604 [http-nio-8080-exec-1] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"2864e721-27e4-4aec-8909-05e2f3517248","event":"performance_metric","operation":"HTTP.WalletController.createWallet","durationMs":88,"timestamp":"2025-10-15T19:44:17.60457947"}
2025-10-15 19:44:17,604 [http-nio-8080-exec-1] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.createWallet in 88ms
2025-10-15 19:44:26,062 [http-nio-8080-exec-3] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.getBalance
2025-10-15 19:44:26,073 [http-nio-8080-exec-3] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"61189568-95b2-4f14-8608-9f8bf7ac0466","correlationId":"61189568-95b2-4f14-8608-9f8bf7ac0466","event":"performance_metric","operation":"WalletUseCase.getBalance","durationMs":10,"transactionId":"TX-1760571866063-62","timestamp":"2025-10-15T19:44:26.073805827"}
2025-10-15 19:44:26,074 [http-nio-8080-exec-3] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"76dd40a9-d0a6-45eb-bf67-7510be751915","event":"performance_metric","operation":"HTTP.WalletController.getBalance","durationMs":12,"timestamp":"2025-10-15T19:44:26.074559864"}
2025-10-15 19:44:26,074 [http-nio-8080-exec-3] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.getBalance in 12ms
2025-10-15 19:44:28,264 [http-nio-8080-exec-4] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.deposit
2025-10-15 19:44:28,264 [http-nio-8080-exec-4] INFO  c.f.p.a.controller.WalletController - Processing deposit for wallet: 5a93ffbb-7190-43be-b882-def03141fbb0 - Amount: 100.50
2025-10-15 19:44:28,271 [http-nio-8080-exec-4] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic deposit #1 - Wallet: 5a93ffbb-7190-43be-b882-def03141fbb0, Amount: R$ 100,50, Description: Initial deposit
2025-10-15 19:44:28,284 [http-nio-8080-exec-4] INFO  c.f.p.a.usecase.WalletUseCase - Atomic deposit processed successfully - Deposit #1, Wallet: 5a93ffbb-7190-43be-b882-def03141fbb0, Amount: R$ 100,50, Balance: R$ 0,00 -> R$ 100,50
2025-10-15 19:44:28,285 [http-nio-8080-exec-4] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"8a8155ca-e6b2-4e8b-93aa-b5bca4732446","correlationId":"8a8155ca-e6b2-4e8b-93aa-b5bca4732446","event":"performance_metric","operation":"WalletUseCase.deposit","durationMs":14,"transactionId":"TX-1760571868270-63","timestamp":"2025-10-15T19:44:28.284958316"}
2025-10-15 19:44:28,293 [http-nio-8080-exec-4] INFO  c.f.p.a.controller.WalletController - Deposit processed successfully for wallet: 5a93ffbb-7190-43be-b882-def03141fbb0 - Amount: 100.50
2025-10-15 19:44:28,293 [http-nio-8080-exec-4] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"08992d11-58a8-4f72-97a7-2ccb4b35cc7b","event":"performance_metric","operation":"HTTP.WalletController.deposit","durationMs":29,"timestamp":"2025-10-15T19:44:28.293451507"}
2025-10-15 19:44:28,293 [http-nio-8080-exec-4] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.deposit in 29ms
2025-10-15 19:44:33,595 [http-nio-8080-exec-5] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.registerPixKey
2025-10-15 19:44:33,595 [http-nio-8080-exec-5] INFO  c.f.p.a.controller.WalletController - Registering Pix key for wallet: 5a93ffbb-7190-43be-b882-def03141fbb0 - Key: user2@example.com, Type: EMAIL
2025-10-15 19:44:33,596 [http-nio-8080-exec-5] INFO  c.f.p.a.usecase.WalletUseCase - Registering Pix key #1 for wallet: 5a93ffbb-7190-43be-b882-def03141fbb0 - Key: user2@example.com, Type: EMAIL
2025-10-15 19:44:33,606 [http-nio-8080-exec-5] INFO  c.f.p.a.usecase.WalletUseCase - Pix key #1 registered successfully - ID: c3221112-4463-4f08-97bf-a490e89f7553, Key: user2@example.com
2025-10-15 19:44:33,606 [http-nio-8080-exec-5] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"650b571c-7663-48db-bb7e-aaa8f2d34aea","correlationId":"650b571c-7663-48db-bb7e-aaa8f2d34aea","event":"performance_metric","operation":"WalletUseCase.registerPixKey","durationMs":10,"transactionId":"TX-1760571873596-64","timestamp":"2025-10-15T19:44:33.606655795"}
2025-10-15 19:44:33,609 [http-nio-8080-exec-5] INFO  c.f.p.a.controller.WalletController - Pix key registered successfully - ID: c3221112-4463-4f08-97bf-a490e89f7553, Key: user2@example.com
2025-10-15 19:44:33,609 [http-nio-8080-exec-5] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"9ade01b1-33dd-4bfa-bb31-d7ac0112cb73","event":"performance_metric","operation":"HTTP.WalletController.registerPixKey","durationMs":14,"timestamp":"2025-10-15T19:44:33.609303596"}
2025-10-15 19:44:33,609 [http-nio-8080-exec-5] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.registerPixKey in 14ms
2025-10-15 19:44:36,492 [http-nio-8080-exec-6] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.registerPixKey
2025-10-15 19:44:36,492 [http-nio-8080-exec-6] INFO  c.f.p.a.controller.WalletController - Registering Pix key for wallet: 5a93ffbb-7190-43be-b882-def03141fbb0 - Key: user@example.com, Type: EMAIL
2025-10-15 19:44:36,492 [http-nio-8080-exec-6] INFO  c.f.p.a.usecase.WalletUseCase - Registering Pix key #2 for wallet: 5a93ffbb-7190-43be-b882-def03141fbb0 - Key: user@example.com, Type: EMAIL
2025-10-15 19:44:36,495 [http-nio-8080-exec-6] INFO  c.f.p.a.usecase.WalletUseCase - Pix key #2 registered successfully - ID: 35e01bc3-b85e-47df-ae31-0299a4de3ac6, Key: user@example.com
2025-10-15 19:44:36,496 [http-nio-8080-exec-6] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"83b3e0c1-95ab-4b25-bfa4-234cbb0f493a","correlationId":"83b3e0c1-95ab-4b25-bfa4-234cbb0f493a","event":"performance_metric","operation":"WalletUseCase.registerPixKey","durationMs":3,"transactionId":"TX-1760571876492-65","timestamp":"2025-10-15T19:44:36.495992216"}
2025-10-15 19:44:36,497 [http-nio-8080-exec-6] INFO  c.f.p.a.controller.WalletController - Pix key registered successfully - ID: 35e01bc3-b85e-47df-ae31-0299a4de3ac6, Key: user@example.com
2025-10-15 19:44:36,497 [http-nio-8080-exec-6] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"36c97ccd-6702-4cd4-baf0-de6dbbed899f","event":"performance_metric","operation":"HTTP.WalletController.registerPixKey","durationMs":5,"timestamp":"2025-10-15T19:44:36.497465604"}
2025-10-15 19:44:36,497 [http-nio-8080-exec-6] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.registerPixKey in 5ms
2025-10-15 19:44:39,228 [http-nio-8080-exec-7] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: PixController.initiateTransfer
2025-10-15 19:44:39,228 [http-nio-8080-exec-7] INFO  c.f.p.a.controller.PixController - Initiating Pix transfer - Idempotency Key: 667c765a-2f69-4f0a-abe6-f5806aee149b, From: 5a93ffbb-7190-43be-b882-def03141fbb0, To: user@example.com, Amount: 10.00
2025-10-15 19:44:39,229 [http-nio-8080-exec-7] INFO  c.f.p.a.usecase.PixTransferUseCase - Initiating Pix transfer with atomic operations - Idempotency Key: 667c765a-2f69-4f0a-abe6-f5806aee149b, From: 5a93ffbb-7190-43be-b882-def03141fbb0, To: user@example.com, Amount: R$ 10,00
2025-10-15 19:44:39,239 [http-nio-8080-exec-7] INFO  c.f.p.d.s.AtomicTransferService - Starting atomic transfer creation - ID: 1, EndToEnd: E176057187923833b34c0dc6b841318d, From: 5a93ffbb-7190-43be-b882-def03141fbb0, Amount: R$ 10,00
2025-10-15 19:44:39,243 [http-nio-8080-exec-7] INFO  c.f.p.d.s.AtomicTransferService - Atomic transfer created successfully - ID: 1, EndToEnd: E176057187923833b34c0dc6b841318d
2025-10-15 19:44:39,247 [http-nio-8080-exec-7] INFO  c.f.p.a.usecase.PixTransferUseCase - Pix transfer initiated atomically - End-to-End ID: E176057187923833b34c0dc6b841318d, Transfer ID: 92efb58b-b6ad-4c62-86db-a41d5ef6e2fb
2025-10-15 19:44:39,247 [http-nio-8080-exec-7] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"6bffd668-4e6e-4fbd-b2bb-57c92ad30f96","correlationId":"6bffd668-4e6e-4fbd-b2bb-57c92ad30f96","event":"performance_metric","operation":"PixTransferUseCase.initiateTransfer","durationMs":18,"transactionId":"TX-1760571879239-66","timestamp":"2025-10-15T19:44:39.247242472"}
2025-10-15 19:44:39,247 [http-nio-8080-exec-7] INFO  c.f.p.a.controller.PixController - Pix transfer initiated successfully - End-to-End ID: E176057187923833b34c0dc6b841318d, Transfer ID: 92efb58b-b6ad-4c62-86db-a41d5ef6e2fb
2025-10-15 19:44:39,248 [http-nio-8080-exec-7] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"ec404344-a3e4-462c-85f1-d1ed156ba57a","event":"performance_metric","operation":"HTTP.PixController.initiateTransfer","durationMs":20,"timestamp":"2025-10-15T19:44:39.248068956"}
2025-10-15 19:44:39,248 [http-nio-8080-exec-7] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: PixController.initiateTransfer in 20ms
2025-10-15 19:44:44,412 [http-nio-8080-exec-8] INFO  c.f.p.i.logging.LoggingAspect - Processing HTTP request: WalletController.withdraw
2025-10-15 19:44:44,412 [http-nio-8080-exec-8] INFO  c.f.p.a.controller.WalletController - Processing withdrawal for wallet: 5a93ffbb-7190-43be-b882-def03141fbb0 - Amount: 50.25
2025-10-15 19:44:44,412 [http-nio-8080-exec-8] INFO  c.f.p.a.usecase.WalletUseCase - Processing atomic withdrawal #1 - Wallet: 5a93ffbb-7190-43be-b882-def03141fbb0, Amount: R$ 50,25, Description: Emergency withdrawal
2025-10-15 19:44:44,415 [http-nio-8080-exec-8] INFO  c.f.p.a.usecase.WalletUseCase - Atomic withdrawal processed successfully - Withdrawal #1, Wallet: 5a93ffbb-7190-43be-b882-def03141fbb0, Amount: R$ 50,25, Balance: R$ 90,50 -> R$ 40,25
2025-10-15 19:44:44,415 [http-nio-8080-exec-8] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"7ad36eb7-648d-48b1-bf10-c09e9c7358db","correlationId":"7ad36eb7-648d-48b1-bf10-c09e9c7358db","event":"performance_metric","operation":"WalletUseCase.withdraw","durationMs":3,"transactionId":"TX-1760571884412-67","timestamp":"2025-10-15T19:44:44.415761924"}
2025-10-15 19:44:44,417 [http-nio-8080-exec-8] INFO  c.f.p.a.controller.WalletController - Withdrawal processed successfully for wallet: 5a93ffbb-7190-43be-b882-def03141fbb0 - Amount: 50.25
2025-10-15 19:44:44,418 [http-nio-8080-exec-8] INFO  com.finaya.pixwallet.performance - Performance metric - {"resourceId":"54cad2f8-c0a6-4162-9470-88e7dadd8585","event":"performance_metric","operation":"HTTP.WalletController.withdraw","durationMs":7,"timestamp":"2025-10-15T19:44:44.418078998"}
2025-10-15 19:44:44,418 [http-nio-8080-exec-8] INFO  c.f.p.i.logging.LoggingAspect - HTTP request processed successfully: WalletController.withdraw in 7ms
2025-10-15 19:45:15,086 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-10-15 19:45:15,090 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-10-15 19:45:15,091 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
